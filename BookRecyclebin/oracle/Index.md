# index 索引 

- 创建索引就是对某些特定列中的数据排序，生成独立的索引表。在某列上创建索引后，如果该列出现在查询条件中，Oracle会自动的引用该索引，先从索引表中查询出符合条件记录的rowid（字段物理地址），根据rowid快速的定位到具体的记录。

1. 索引是独立于表的模糊对象，可以存储在与表不同的磁盘/表空间。
2. 索引被删除/破坏，不会对表产生影响，其影响的只是查询的速度。
3. 索引一旦建立，Oracle管理系统会对其进行自动维护，且由Oracle管理系统决定何时引用索引，用户不用在查询语句中指定使用哪个索引。
4. 删除表时，所有基于该表的索引会自动被删除。
5. 表中的数据非常多时，引用索引带来的查询效率非常可观。但索引会减慢数据插入表的速度（插入数据时也要维护索引）。

# create index 创建索引

| 创建时机 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 创建     | 1. 列中的数据分布范围很广<br/>2. 列经常在where子句或连接条件中出现<br/>3. 表经常被访问而且数据量很大，访问数据大概占数据总量的2%-4% |
| 不要创建 | 1. 表很小<br/>2. 列不经常作为连接条件出现在where子句<br/>3. 查询的数据大于2%-4%<br/>4. 表经常更新 |

> 当任何单个查询要检索的行少于或者等于整个表行数的10%时，索引就非常有用。

| 创建索引 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 自动创建 | 定义primary key、unique约束后系统自动在相应的列上创建唯一性索引。 |
| 手动创建 | 用户可以在其他列上创建非唯一性索引。                         |

```sql
create [unique] [bitmap] index 索引名 on 表(列1[,列2…]);
[tablespace 表空间名]
[sctfree n1]
[storage
 (
    initial 64K
    next 1M
    minextents 1
    maxextents unlimited
)];
```

| 选项       | 说明             |
| ---------- | ---------------- |
| tablespace | 存储索引的表空间 |
| sctfree    | 索引块的空闲空间 |
| storage    | 存储块的空间     |

```sql
-- 在一个或多个列上创建索引
create index emp_last_name_index on employees(last_name);
```

| 索引的类型                     | 说明                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| b-tree索引                     | create index创建的普通索引就是b-tree索引，没有特殊的必须应用在哪些数据上。 |
| bitmap位图索引                 | 位图索引经常应用于列数据只有几个枚举值的情况，查询效率将会最快。 |
| 函数索引                       | 适合对某个字段做查询的时候经常是带函数操作的。               |
| hash索引                       | 创建hash索引必须使用hash集群，需要在创建hash集群的时候指定这个集群键值。<br />存储数据时，所有相关集群键的行都存储在一个数据块当中，只要定位到hash键，就能快速定位查询到数据的物理位置。 |
| reverse反向索引                |                                                              |
| 分区索引<br />分区表的全局索引 | 应用在分区表上面的索引。<br />分区索引是对分区表内的单个分区进行数据索引。<br />分区表的全局索引对分区表的全表进行全局索引。 |

# drop index 删除索引

- drop index不可回滚，只有索引的拥有者或拥有drop anyindex权限的用户才可以删除。

```sql
drop index emp_last_name_index;
```

# alter index 修改索引

## rename to 重命名索引

```sql
alter index 旧索引名 rename to 新索引名;
```

## coalesce 合并索引、rebuild 重新构造索引

- 索引建好后，经过很长一段时间的使用，索引表中存储的空间会产生一些碎片，导致索引的查询效率会有所下降，此时考虑合并索引、按照索引规则重新分类存储、或选择删除索引重新构造索引。

```sql
-- 合并索引
alter index 索引名 coalesce;

-- 重新构造
alter index 索引名 rebuild;
```
