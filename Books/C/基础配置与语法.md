# C介绍

## C的标准

<table>
    <tr>
        <td width="10%">ANSI C</td>
        <td width="90%"></td>
    </tr>
    <tr>
        <td>C90</td>
        <td></td>
    </tr>
    <tr>
        <td>C99</td>
        <td></td>
    </tr>
    <tr>
        <td>C11</td>
        <td></td>
    </tr>
<tr>
<td>C17</td>
<td></td>
</tr>
    <tr>
        <td>C23</td>
        <td></td>
    </tr>
</table>

## C的编程机制

### 目标代码文件、可执行文件、库

- C编程的基本策略是，将源代码文件转换为可执行文件（包含可直接执行的机器语言代码）。典型的C通过编译和链接来完成这一过程，也就是采取“分而治之”的方法对程序进行模块化，可以独立编译单独的模块，之后再用链接器合并已编译的模块。此外，链接器还会将编写的程序和预编译的库代码合并。
1. <b>编译器</b>把源代码转换成中间代码（<b>目标代码</b>），例如机器语言代码，并把结果放到目标文件中。此时，还缺少启动代码以及库函数。
2. <b>链接器</b>把中间代码和其他代码合并，生成可执行文件。也就是，将<b>目标代码、系统的标准启动代码、库代码</b>这三个部分合并为一个可执行文件。对于库代码，链接器只会把程序中要用到的库函数代码提取出来。
- 大部分C系统要求C语言的<b>源代码文件（source code file）</b>以<code>.c</code>为扩展名。
- <b>启动代码（startup code）</b>充当程序和系统之间的接口，尽管目标代码相同，但不同系统的启动代码不一定相同。

<img src="../../pictures/C-编译器和链接器.drawio.svg" width="400"/> 

### 操作系统与编译器

1. 大部分系统的编译器在编译完成后会自动运行链接器。
2. 通常情况下，C编译器生成的中间目标代码文件的扩展名是<code>.obj</code>。不同的编译器生成的中间目标代码文件的扩展名可能不同。

<table>
    <tr>
        <th>OS</th>
        <th>编译器</th>
        <th>编译语句</th>
        <th>可执行文件</th>
    </tr>
    <tr>
        <td width="15%">UNIX</td>
        <td width="15%">cc</td>
        <td width="20%"><code>cc itarget.c</code></td>
        <td width="50%">a.out</td>
    </tr>
    <tr>
        <td>Linux</td>
        <td>gcc / cc</td>
        <td>gcc itarget.c</td>
        <td>a.out</td>
    </tr>
    <tr>
        <td>Windows</td>
        <td>Cygwin<br/>MinGW</td>
        <td>-</td>
        <td>itarget.exe</td>
    </tr>
</table>

## C程序的结构

<img src="../../pictures/C-C程序的结构.drawio.svg" wifth="600"/> 

```c
#include <stdio.h>

int main(){
        int num;
        num = 1;
        printf("Hello C, %d", num);
        return 0;
}
```

### <code>#include指令和头文件</code>

- <code>#include</code>是C预处理器指令（prepocessor directive），C编译器在编译前通常会对源代码进行预处理（prepocessor）。
- <b>头文件（header）</b>是在C程序顶部的信息集合，例如<code>stdio.h</code>文件是标准输入/输出头文件，所有的C编译器软件包都提供<code>stdio.h</code>文件。
1. 大多数情况下，头文件包含了编译器创建最终可执行程序要用到的信息，而函数的实际代码放在预编译代码的库文件中。
2. <q>ANSI/ISO C</q>规定了C编译器必须提供哪些头文件，特定C实现的文档中应该包含对C库函数的说明，以此确定了使用哪些函数需要包含哪些头文件。

### <code><a href="#main">main()函数</a></code>

### 注释

<table>
    <tr>
        <td width="20%"><code>/* */</code></td>
        <td width="80%">多行注释</td>
    </tr>
    <tr>
        <td><code>//</code></td>
        <td>单行注释</td>
    </tr>
</table>

### 花括号、函数体、块

- 一般而言，所有的C函数都使用<b>花括号{}</b>标记函数的开始和结束。花括号<code>{}</code>还可以将函数中的多条语句合并为一个单元或块。

### 声明

- <b>声明（declaration）</b>是C语言最重要的特性之一，编译器使用声明的信息来为<b>变量（variable）</b>在内存中分配存储空间。
1. 声明把特定<b>标识符（identifier）</b>（变量、函数或其他实体的名称）与计算机内存中的特定位置联系起来，同时也确定了存储在某位置的信息类型或数据类型。
2. 在C语言中，所有变量都必须先声明才能使用。
3. 变量声明时，可以使用逗号“<code>,</code>”分隔来一次声明多个相同类型的变量。
4. 变量声明时，不管有没有赋值表达式，都会为变量进行<b><a href="#初始化">初始化</a></b>（显式初始化和默认初始化）。

```c
int a, b, c;
printf("a = %d \t b = %d \t c = %d \t");
```

- 命名：C99和C11允许使用更长的标识符名，但是编译器只识别前63个字符（如果超过可能不会正确识别）。
1. 标识符可以使用小写字母、大写字母、数字、下划线（<code>_</code>）来命名。
2. 操作系统和C库经常用以一个或两个下划线字符开始的标识符（标准标签），例如 “<code>_kcab</code>”。为避免名称冲突，应该避免使用下划线开头的标识符。
3. C语言的名称区分大小写。
4. C99和C11根据UCN（通用字符名）机制添加了扩展字符集。

### 赋值 与 初始化

- 赋值表达式语句（C语言是通过赋值运算符而不是赋值语句完成赋值操作的）。在变量声明时，编译器在计算机内存中为变量预留了空间，而在执行赋值表示式时，把值存储到之前预留的位置。
- <b><span name="初始化">初始化</span>（intialize）</b>变量就是在声明时为变量赋一个初始值。可以在一行为多个变量进行初始化，但应该避免将未初始化和需要初始化的变量放在一起（可阅读性）。
1. 如果有赋值表达式，则变量的值就是赋值运算符后的值。
2. 如果没有赋值表达式，而且是局部变量，则变量的值是由数据类型和编译器决定的随机值。
3. 如果没有赋值表达式，而且是全局变量，则变量的值是由数据类型指定的默认初始化值。例如，int类型的全局变量的默认初始化值为0。

```c
/* 全局变量，int类型的默认初始化值为0 */
int a, b, c;
int main(void){
        printf("a = %d \t b = %d \t c = %d \n", a, b, c);
        return 0;
}
// a = 0      b = 0      c = 0
```

```c
/* 全局变量，int类型的默认初始化值为编译器决定的随机值 */
int main(void){
        int a, b, c;
        printf("a = %d \t b = %d \t c = %d \t", a, b, c);
        return 0;
}
// a = 32764      b = -1560847544      c = 0 
```

### 函数

#### 函数结构

- C程序由一个或多个函数组成，必须有main()函数。
1. 函数由函数头和函数体组成。函数头包括函数名、传入该函数的信息类型和函数的返回类型。
2. 通过函数名后的圆括号（<code>()</code>）可识别出函数，圆括号里可能为空，可能有参数。
3. 函数体被花括号（<code>{}</code>）括起来，由一系列语句、声明组成。

#### 函数原型（函数声明）

```c
#include <stdio.h>

void bulter(void); // 函数原型/函数声明

int main(void){
        printf("Hello, function\n");
        bulter(); // 函数调用
        printf("OK!");
        return 0;
}

// 函数定义
void bulter(void){
        printf("Bulter is called.\n");
}
```

1. <b>函数原型（function prototype）</b>是一种声明形式（function declaration），告知编译器要在程序中使用该函数。
   - C90标准新增的函数原型；而早期的C语言的函数声明只需要指定返回类型和函数名即可。
   - C标准建议，要为程序中用到的所有函数提供函数原型。标准include文件（包含文件）为标准库函数提供了函数原型。
2. <b>函数调用（function call）</b> 
3. <b>函数定义（function definition）</b>也就是函数本身的源代码。

#### <span name="main"><code>main()</code>函数</span>

- C程序一定从<code>main()</code>函数开始执行，函数是C程序的基本模块。
1. 无论<code>main()</code>函数位于程序的什么位置，所有的C程序都从<code>main()</code>开始执行。
2. <code>main()</code>函数提供了程序的基本框架，C的惯例是把<code>main()</code>函数放在开头位置。

# 数据

## 整型

<table>
    <caption>C语言的基本数据类型</caption>
    <tr>
        <th>K&R</th>
        <th>C90</th>
        <th>C99</th>
    </tr>
    <tr>
        <td>int</td>
        <td>signed</td>
        <td>_Bool</td>
    </tr>
    <tr>
        <td>long</td>
        <td>void</td>
        <td>_Complex</td>
    </tr>
    <tr>
        <td>short</td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <td>unsigned</td>
        <td>char</td>
        <td>float</td>
    </tr>
    <tr>
        <td>double</td>
        <td></td>
        <td></td>
    </tr>
</table>

### [整数](../Computer/数据的表示.md) int

#### int与附属关键字

<table>
    <tr>
        <th>转换说明</th>
        <th>进制</th>
        <th>前缀</th>
        <th>显示前缀</th>
    </tr>
    <tr>
        <td width="10%">%d</td>
        <td width="25%">十进制（decimal，DEC）</td>
        <td width="10%"></td>
        <td width="55%"></td>
    </tr>
    <tr>
        <td>%o</td>
        <td>八进制（octonary，Oct）</td>
        <td>0</td>
        <td>%#o</td>
    </tr>
    <tr>
        <td rowspan="2">%x</td>
        <td rowspan="2">十六进制<br/>（hexadecimal，HEX）</td>
        <td>0x</td>
        <td>%#x</td>
    </tr>
    <tr>
        <td>0X</td>
        <td>%#X</td>
    </tr>
</table>

- C语言提供3个<b>附属关键字</b>来修饰基本整数类型：<b><code>short</code>、<code>long</code>、<code>unsigned</code></b>。

<table>
    <th width="15%">类型</th>
    <th width="10%">简写</th>
    <th width="10%">后缀</th>
    <th width="15%">名称</th>
    <th width="50%">长度（bit）</th>
    <tr>
        <td>short int</td>
        <td>short</td>
        <td></td>
        <td>短整数</td>
        <td>16</td>
    </tr>
    <tr>
        <td>long int</td>
        <td>long</td>
        <td>l、L</td>
        <td>长整型</td>
        <td>32</td>
    </tr>
    <tr>
        <td>long long int</td>
        <td>long long</td>
        <td>ll、LL</td>
        <td>长整型（C99）</td>
        <td>64</td>
    </tr>
    <tr>
        <td>unsigned int</td>
        <td>unsigned</td>
        <td></td>
        <td>无符号数</td>
        <td>-</td>
    </tr>
    <tr>
        <td>signed xxx</td>
        <td>xxx</td>
        <td></td>
        <td>强调有符号</td>
        <td>-</td>
    </tr>
</table>

<table>
    <tr>
        <th>标准</th>
        <th>类型</th>
        <th>简写</th>
        <th>后缀</th>
    </tr>
    <tr>
        <td rowspan="2" width="10%">C90</td>
        <td width="20%">unsigned short int</td>
        <td width="20%">unsigned short</td>
        <td width="50%"></td>
    </tr>
    <tr>
        <td>unsigned long int</td>
        <td>unsigned long</td>
        <td></td>
    </tr>
    <tr>
        <td>C99</td>
        <td>unsigned long long int</td>
        <td>unsigned long long</td>
        <td>ull、llu、ULL、LLU</td>
    </tr>
</table>

#### 占用空间与溢出

- C语言对基本数据类型只规定了允许的最小大小。例如，C语言只规定了short占用的存储空间不能多于int，long占用的存储空间不能少于int等。
- <code><b>int</b></code>占用的空间为16位或32位，根据计算机的自然字长而定。
- 对于<b>数字常量（number constant）</b>，也就是没有声明类型的数字（字面量），例如`123456`
1. 通常情况下（不带后缀时），程序代码中使用的整数（十进制数）都被存储为<code>int</code>类型，如果超过范围，且在编译器能够识别的类型中，依次尝试存储为<code>long int</code>、<code>unsigned long</code>、<code>long long</code>或<code>unsigned long long</code>。
2. 八进制和十六进制数字被视为<code>int</code>类型。如果值超过范围，则编译器会依次尝试使用<code>unsigned int</code>、<code>long</code>、<code>unsigned long</code>、<code>long long</code>、<code>unsigned long long</code>。

<img src="../../pictures/C-范围超过的类型转换.drawio.svg" width="800"/> 

- <b>溢出</b>行为是未定义的行为，C标准并未定义有符号类型的溢出规则。通常情况下，无符号数发生溢出时，会从0开始继续；而有符号数会从最小负数开始继续。

### 字符 char

#### char与字符常量

- <code>char</code>类型由于存储字符，<b>实际上存储的是整数</b>而不是字符，也就是字符编码（通常使用ASCII编码）。
1. C语言把<code>1 Byte</code>定义为<code>char</code>类型所占用的位数。而在一些编译器中，为了支持Unicode编码，<code>char</code>类型就被扩展成了<code>2 Byte</code>。
2. 在C语言中，<b>字符常量（character constant）</b>是用<b>单引号（<code>' '</code>）</b>括起来的单个字符，编译器一旦发现字符常量就会将其转换为相应的代码值（字符编码）。不同的编码集转换的字符编码值也不相同，因此尽量使用字符常量而不是字符编码。
3. 从C90开始，字符编码可以是十进制（需要强转<code>(char)</code>对应的整数）、八进制（<code>\\</code>）、十六进制（<code>\x</code>）。
4. C语言将字符常量视为<code>int</code>类型而不是<code>char</code>类型，但其实际占用的空间仍然是<code>char</code>类型对应的<code>1 Byte</code>。也就是，一个字符变量实际上被存储为1Byte的整数值。
5. 有些编译器认为<code>char</code>是无符号类型，而有些编译器认为<code>是有符号类型</code>，可以查阅<code>limits.h</code>头文件来查看。因此，在C90标准，C语言允许在关键字<code>char</code>前面使用<code>signed</code>或<code>unsigned</code>来显示指定。

> 字符串使用双引号 ""

```c
/* 十进制 字符编码 */
char ch = (char) 64; // @

/* 八进制 字符编码 */
char ch = '\64'; // 4

/* 十六进制 字符编码 */
char ch = '\64'; // d
```

#### 非打印字符

- 非打印字符是一些特殊的、代表行为的字符，无法通过正常途径打印。
1. 使用ASCII码的字符编码来打印。
2. 使用<b>转义序列（escape sequence）</b>来打印。

<table>
    <caption>转义序列</caption>
    <tr>
        <td>\a</td>
        <td colspan="7">警告</td>
    </tr>
    <tr>
        <td width="16%">\b</td>
        <td width="16%">退格</td>
        <td width="2%" rowspan="4"></td>
        <td width="16%">\f</td>
        <td width="16%">换页</td>
        <td width="2%" rowspan="4"></td>
        <td width="16%">\n</td>
        <td width="16%">换行</td>
    </tr>
    <tr>
        <td>\r</td>
        <td>回车</td>
        <td>\t</td>
        <td>水平制表符</td>
        <td>\v</td>
        <td>垂直制表符</td>
    </tr>
    <tr>
        <td>\\</td>
        <td>反斜杆</td>
        <td>\'</td>
        <td>单引号</td>
        <td>\"</td>
        <td>双引号</td>
    </tr>
    <tr>
        <td>\?</td>
        <td>问号</td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <td>\0oo</td>
        <td colspan="3">八进制值（o表示0~7）</td>
        <td>\xhh</td>
        <td colspan="3">十六进制值（h表示0~f）</td>
    </tr>
</table>

- 警告（<code>\a</code>）（C90）是否产生取决于计算机的硬件，蜂鸣是最常见的警报。C标准规定警报字符不得改变活跃位置（activie position），也就是，不得改变显示设备中下一个字符将要出现的位置（光标）。

### 布尔 <code>_Bool</code>与<code>bool</code>

- C99标准添加了<code>_Bool</code>类型来表示布尔值（逻辑值）true和false。
1. <code>_Bool</code>类型实际上也是一种整数类型，<code>1</code>表示<code>true</code>，0表示<code>false</code>。
2. 原则上，<code>_Bool</code>类型只占用<code>1 bit</code>的存储空间。

```c
#include <stdio.h>
#include <stdbool.h>

int main(void){
        printf("%d\t%d\n", true, false);
}
```

- C23标准之后，彻底支持了<code>bool</code>类型

1. 在C23标准之前，如果需要使用true和false，则要包含<code>stdbool.h</code>头文件。

```c
#include <stdio.h>

int main(void)
{
    printf("%d\n%d\n", true, false);
}
```

### （整数）可移植类型 <code>stdint.h</code>与<code>inttypes.h</code>

- 由于某些类型名在不同系统中的功能不同，C99新增了两个头文件<code>stdint.h</code>和<code>inttypes.h</code>，以确保C语言的类型在各系统中的功能相同。

- C语言为现有类型创建了更多类型名，定义在<code>stdint.h</code>头文件中，不同的系统可以定义相同的类型名。在包含<code>stdint.h</code>头文件时，编译器会把这些定义的类型替换成与当前系统匹配的类型。

<table>
    <caption>可移植类型</caption>
    <tr>
        <td rowspan="2" width="25%">精确宽度整数类型<br/>exact-width integer type</td>
        <td width="75%">精确宽度整数类型是可选项，部分计算机的底层系统可能不支持。</td>
    </tr>
    <tr>
        <td>例如，<code>int32_t</code>在<code>int</code>为16位、<code>long</code>为32位的系统中会被作为<code>long</code>的别名。</td>
    </tr>
    <tr>
        <td rowspan="2">最小宽度类型<br/>minimum width type</td>
        <td>最小宽度类型是由C99和C11提供的第二类别名集合，保证所表示的类型一定是至少有指定宽度的最小整数类型。</td>
    </tr>
    <tr>
        <td>例如，<code>int_least8_t</code>是可容纳8位有符号整数值的类型中宽度最小的类型的一个别名。如果某系统的最小整数类型是16位，则可能不能定义<code>int8_t</code>类型。尽管如此，<code>int_least8_t</code>类型仍然可被该系统使用，只是可能会被实现为16位的整数类型。</td>
    </tr>
    <tr>
        <td>最快最小宽度类型<br/>faster minimum width type</td>
        <td>C99和C11定义了一组可使计算达到最快的类型集合。</td>
    </tr>
</table>

## 转换说明

- 转换说明符决定的只是数据的显示方式，而非存储方式。

### <code>printf()</code> 打印