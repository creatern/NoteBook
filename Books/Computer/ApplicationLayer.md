# 网络应用模型

## 客户/服务器模型 C/S

<img src="../../pictures/计算机网络-CS.drawio.svg" width="300"/> 

- 在客户/服务器（Client/Server，C/S）模型中，有一个总是打开的主机被称为服务器，其服务于许多来自其他被称为客户机的主机请求。服务器的工作流程如下：

1. 服务器处于接收请求的状态。
2. 客户机发出服务请求，并等待接收结果。
3. 服务器收到请求后，分析请求，进行必要的处理，得到结果并发送给客户机。

- C/S模型最主要的特征是：客户是服务请求方，服务器是服务提供方。

<table>
    <tr>
        <td width="15%">客户程序</td>
        <td width="85%">客户程序必须知道服务器程序的地址，客户机上一般不需要特殊的硬件和复杂的操作系统</td>
    </tr>
    <tr>
        <td>服务器程序</td>
        <td>服务器上运行的软件则是专门用来提供某种服务的程序，可同时处理多个远程或本地客户的要求。系统启动后即自动调用并一直不断地运行着，被动地等待并接收各地客户的请求。因此，服务器程序不需要知道客户程序的地址</td>
    </tr>
</table>

- 常见的C/S模型的应用包括Web、文件传输协议（FTP）、远程登录和电子邮件等。
- C/S模型的主要特点还有：

1. 网络中各计算机的地位不平等，服务器可以通过对用户权限的限制来达到管理客户机的目的，使它们不能随意存储/删除数据，或进行其他受限的网络活动。整个网络的管理工作由少数服务器担当，因此网络的管理非常集中和方便。服务器性能的好坏决定了整个系统的性能，当大量用户请求服务时，服务器就必然成为系统的瓶颈。
2. 客户机相互之间不直接通信。例如，在Web应用中两个浏览器并不直接通信。
3. 可扩展性不佳。受服务器硬件和网络带宽的限制，服务器支持的客户机数有限。

## P2P模型

<img src="../../pictures/计算机网络-P2P.drawio.svg" width="300"/> 

- P2P模型的思想是整个网络中的传输内容不再被保存在中心服务器上，每个结点都同时具有下载、上传的功能，其权利和义务都是大体对等的。 

- 在P2P模型中，各计算机没有固定的客户和服务器划分。相反，任意一对计算机称为对等方（Peer），直接相互通信。实际上，P2P模型从本质上来看仍然使用客户/服务器模式，每个结点既作为客户访问其他结点的资源,也作为服务器提供资源给其他结点访问。
- 当前比较流行的 P2P应用有PPlive、Bittorrent 和电驴等。
- 与C/S 模型相比，P2P模型的优点主要体现如下:

1. 减轻了服务器的计算压力，消除了对某个服务器的完全依赖，可以将任务分配到各个结点上，因此大大提高了系统效率和资源利用率。（例如，播放流媒体时对服务器的压力过大，而通过P2P模型，可以利用大量的客户机来提供服务）
2. 多个客户机之间可以直接共享文档。
3. 可扩展性好，传统服务器有响应和带宽的限制，因此只能接受一定数量的请求。
4. 网络健壮性强，单个结点的失效不会影响其他部分的结点。

- P2P模型也有缺点：在获取服务的同时，还要给其他结点提供服务，因此会占用较多的内存，影响整机速度。例如，经常进行P2P下载还会对硬盘造成较大的损伤。据某互联网调研机构统计，当前P2P程序已占互联网50%~90%的流量，使网络变得非常拥塞，因此各大ISP（互联网服务提供商，如电信、网通等）通常都对P2P应用持反对态度。

# 域名系统 DNS

- 域名系统（Domain Name System，DNS）是因特网使用的命名系统，用来便于记忆的具有特定含义的主机名转换为便于机器处理的IP地址。
- DNS系统采用C/S模型，其协议运行在UDP之上，使用53号端口。
- 从概念上可将DNS分为3个部分：层次域名空间、域名服务器、解析器。

## 层次域名空间

- 因特网采用层次树状结构的命名方法，任何一个连接到因特网的主机或路由器，都有一个唯一的层次结构名称（域名，Domain Name）。
- 域（Domain）是名字空间中一个可被管理的划分，域可被划分为子域，而子域还可以继续划分为子域的子域，由此形成顶级域、二级域、三级域等。每个域名都由标号序列组成，而各标号之间用点（“.”）隔开。

<img src="../../pictures/计算机网络-域名.drawio.svg" width="250"/> 

- 关于域名中的标号有几点注意：

1. 标号中的英文不区分大小写。
2. 标号中除连字符（-）外不能使用其他的标点符号。
3. 每个标号不超过63个字符，多标号组成的完整域名最长不超过255个字符。
4. 级别最低的域名写在最左边，级别最高的顶级域名写在最右边。

- 顶级域名（Top Level Domain，TLD）分为以下三类：

<table>
    <tr>
        <td width="20%">国家（地区）顶级域名<br />nTLD</td>
        <td width="80%">国家和某些地区的域名。如“.cn”表示中国、“.us”表示美国、“.uk”表示英国</td>
    </tr>
    <tr>
        <td>通用顶级域名<br />gTLD</td>
        <td>常见的有“.com”公司、“.net”网络服务机构、“.org”非营利性组织、“.gov”国家或政府组织</td>
    </tr>
    <tr>
        <td>基础结构域名</td>
        <td>该类顶级域名只有一个，“arpa”反向域名，用于反向域名解析</td>
    </tr>
</table>

- 国家（地区）顶级域名下注册的二级域名均由该国家（地区）自行确定。
- 在域名系统中，每个域分别由不同的组织进行管理。每个组织都可以将它的域再分成一定数目的子域，并将子域委托给其他组织去管理。

<img src="../../pictures/20240229213342.png" width="400"/> 

## 域名服务器

- 因特网的域名系统被设计成一个联机分布式的数据库系统，并采用C/S模型。域名到IP地址的解析是由运行在域名服务器上的程序完成的，一个服务器所负责管辖的（或有权限的）范围称为区（而不是“域”为单位），各单位根据具体情况来划分自己管辖范围的区，但在一个区中的所有结点必须是能够连通的，每个区设置相应的权限域名服务器，用来保存该区中的所有主机的域名到IP地址的映射。每个域名服务器不但能够进行一些域名到IP地址的解析，而且还必须具有连向其他域名服务器的信息。当自己不能进行域名到IP地址的转换时，能够知道到什么地方去找其他域名服务器。
- DNS使用了大量的域名服务器，它们以层次方式组织。没有一台域名服务器具有因特网上所有主机的映射，相反，该映射分布在所有的DNS上。
- DNS主要有4种类型的域名服务器：

<table>
    <tr>
        <td width="20%" rowspan="3">根域名服务器</td>
        <td width="80%">根域名服务器是最高层次的域名服务器，所有的根域名服务器都知道所有的顶级域名服务器的IP地址。根域名服务器也是最重要的域名服务器，不管是哪个本地域名服务器，若要对因特网上任何一个域名进行解析，只要自己无法解析，就首先要求助于根域名服务器。</td>
    </tr>
    <tr>
        <td>因特网上有13个根域名服务器，尽管我们将这13个根域名服务器中的每个都视为单个服务器，但每个“服务器”实际上是冗余服务器的集群，以提供安全性和可靠性。</td>
    </tr>
    <tr>
        <td>根域名服务器用来管辖顶级域（如.com），通常它并不直接把待查询的域名直接转换成IP地址，而是告诉本地域名服务器下一步应当找哪个顶级域名服务器进行查询。</td>
    </tr>
    <tr>
        <td>顶级域名服务器</td>
        <td>这些域名服务器负责管理在该顶级域名服务器注册的所有二级域名。收到DNS查询请求时，就给出相应的回答（可能是最后的结果，也可能是下一步应当查找的域名服务器的IP地址）</td>
    </tr>
    <tr>
        <td>授权域名服务器<br />（权限域名服务器）</td>
        <td>每台主机都必须在授权域名服务器处登记。为了更加可靠地工作，一台主机最好至少有两个授权域名服务器。实际上，许多域名服务器都同时充当本地域名服务器和授权域名服务器。授权域名服务器总能将其管辖的主机名转换为该主机的IP地址。</td>
    </tr>
    <tr>
        <td>本地域名服务器</td>
        <td>本地域名服务器对域名系统非常重要。每个因特网服务提供者(ISP)，或一所大学，甚至一所大学中的各个系，都可以拥有一个本地域名服务器。当一台主机发出DNS查询请求时，这个查询请求报文就发送给该主机的本地域名服务器。</td>
    </tr>
</table>
<img src="../../pictures/计算机网络-DNS的层次结构.drawio.svg" width="600"/> 

## 域名解析过程

- 域名解析：把域名映射成IP地址（正向解析）或把IP地址映射成域名（反向解析）的过程。当客户端需要域名解析时，通过本机的DNS客户端构造一个DNS请求报文，以UDP数据报方式发往本地域名服务器。
- 域名解析有两种方式：递归查询、递归与迭代相结合的查询

- 为了提高DNS的查询效率，并减少因特网上的DNS查询报文数量，在域名服务器中广泛地使用了高速缓存。当一个DNS服务器接收到DNS查询结果时，它能将该DNS信息缓存在高速缓存中。这样，当另一个相同的域名查询到达该DNS服务器时，该服务器就能够直接提供所要求的Ip地址，而不需要再去向其他DNS服务器询问。因为主机名和IP地址之间的映射不是永久的，所以DNS服务器将在一段时间后丢弃高速缓存中的信息。

### 主机向本地域名服务器的查询 递归查询

- 递归查询：本地域名服务器只需向根域名服务器查询一次，后面的几次查询都是递归地在其他几个域名服务器之间进行的。之后，本地服务器从根域名服务器得到了所需的IP地址。最后，本地域名服务器把查询结果告诉发起查询的主机。但该方法对根域名服务器造成的负载过大，在实际中几乎不使用。

<img src="../../pictures/计算机网络-递归查询域名解析.drawio.svg" width="700"/> 

- 如果本地主机所询问的本地域名服务器不知道被查询域名的IP地址，那么本地城名服务器就以DNS 客户的身份，向根域名服务器继续发出查询请求报文（即替该主机继续查询)，而不是让该主机自己进行下一步的查询。

### 本地域名服务器向根域名服务器的查询 迭代查询

- 当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地域名服务器：“你下一步应当向哪个顶级域名服务器进行查询”。然后让本地城名服务器向这个顶级域名服务器进行后续的查询。同样，顶级域名服务器收到查询报文后，要么给出所要查询的地址，要么告诉本地域名服务器下一步应向哪个权限域名服务器查询。最后，知道所要解析的域名的IP地址后，把这个结果返回给发起查询的主机。

- 域名解析的过程（共使用了8个UDP报文）如下：

<img src="../../pictures/计算机网络-迭代查询域名解析.drawio.svg" width="400"/> 

1. 客户机向其本地域名服务器发出DNS请求报文（递归查询）。
2. 本地域名服务器收到请求后，查询本地缓存，若没有该记录；则以DNS客户的身份向根域名服务器发出解析请求报文（迭代查询）。
3. 根域名服务器收到请求后，判断该域名属于.com域，将对应的顶级域名服务器dns.com的IP地址返回给本地域名服务器。
4. 本地域名服务器向顶级域名服务器dns.com发出解析请求报文（迭代查询）
5. 顶级域名服务器dns.com收到请求后，判断该域名属于abc.com域，因此将对应的授权域名服务器dns.abc.com的IP地址返回给本地域名服务器。
6. 本地域名服务器向授权域名服务器dns.abc.com发起解析请求报文（迭代查询）。
7. 授权域名服务器dns.abc.com收到请求后，将查询结果返回给本地域名服务器。
8. 本地域名服务器将查询结果保存到本地缓存，同时返回给客户机。

# 文件传输协议 FTP

- 文件传输协议（File Transfer Protocol，FTP）是因特网上使用最广泛的文件传输协议。FTP提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限。FTP还屏蔽了各计算机系统的细节，适合于在异构网络中的任意计算机之间传送文件。

- FTP提供以下功能：

1. 提供不同种类主机系统（硬、软件体系等都可以不同）之间的文件传输能力。
2. 以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力。
3. 以匿名FTP的方式提供公用文件共享的能力。

- FTP采用客户/服务器的工作方式，它使用TCP可靠的传输服务。一个FTP服务器进程可同时为多个客户进程提供服务。FTP的服务器进程由两大部分组成：一个主进程，负责接收新的请求；另外有若干从属进程，负责处理单个请求。其工作步骤如下：

1. 打开熟知端口21（控制端口），使客户进程能够连接上。
2. 等待客户进程发连接请求。
3. 启动从属进程来处理客户进程发来的请求。主进程与从属进程并发执行，从属进程对客户进程的请求处理完毕后即终止。
4. 回到等待状态，继续接收其他客户进程的请求。

- FTP服务器必须在整个会话期间保留用户的状态信息。特别是服务器必须把指定的用户账户与控制连接联系起来，服务器必须追踪用户在远程目录树上的当前位置。

## 控制连接与数据连接

- FTP在工作时使用两个并行的TCP 连接：一个是控制连接（服务器端口号21）、一个是数据连接（服务器端口号 20）。使用两个不同的端口号可以使协议更容易实现。

<img src="../../pictures/计算机网络-控制连接和数据连接.drawio.svg" width="580"/> 

### 控制连接

- 服务器监听21号端口，等待客户连接，建立在这个端口上的连接称为控制连接，控制连接用来传输控制信息（如连接请求、传送请求等)，并且控制信息都以7位 ASCII格式传送。FTP客户发出的传送请求，通过控制连接发送给服务器端的控制进程，但控制连接并不用来传送文件。在传输文件时还可以使用控制连接（如客户在传输中途发一个中止传输的命令），因此控制连接在整个会话期间一直保持打开状态。

### 数据连接

- 服务器端的控制进程在接收到FTP客户发来的文件传输请求后，就创建“数据传送进程”和“数据连接”。数据连接用来连接客户端和服务器端的数据传送进程，数据传送进程实际完成文件的传送，在传送完毕后关闭“数据传送连接”并结束运行。
- 数据连接有两种传输模式：主动模式 PORT 和被动模式 PASV。使用PORT模式还是PASV模式，选择权在客户端。主动模式传送数据是“服务器”连接到“客户端”的端口；被动模式传送数据是“客户端”连接到“服务器”的端口。

<table>
    <tr>
        <td width="15%">主动模式 PORT</td>
        <td width="85%">客户端连接到服务器的21端口，登录成功后要读取数据时，客户端随机开放一个端口，并发送命令告知服务器，服务器收到PORT命令和端口号后，通过20端口和客户端开放的端口连接，发送数据</td>
    </tr>
    <tr>
        <td>被动模式 PASV</td>
        <td>客户端要读取数据时，发送PASV命令到服务器，服务器在本地随机开放一个端口，并告知客户端，客户端再连接到服务器开放的端口进行数据传输</td>
    </tr>
</table>

<table>
    <tr>
        <td width="10%">FTP</td>
        <td width="80%">因为FTP使用了一个分离的控制连接，所以也称FTP的控制信息是带外（Out-of-band）传送的。使用FTP时，若要修改服务器上的文件，则需要先将此文件传送到本地主机，然后再将修改后的文件副本传送到原服务器，来回传送耗费很多时间。</td>
    </tr>
    <tr>
        <td>NFS</td>
        <td>网络文件系统（NFS）采用另一种思路，它允许进程打开一个远程文件，并能在该文件的某个特定位置开始读写数据。这样，NFS可使用户复制一个大文件中的一个很小的片段，而不需要复制整个大文件。</td>
    </tr>
</table>

# 电子邮件

# 万维网 WWW