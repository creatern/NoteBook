# 存储器概述

## 存储器分类

| 作用（层次）划分        | 特点                                                         |
| ----------------------- | ------------------------------------------------------------ |
| 主存储器（主存）        | CPU可以直接和内存交换信息。<br />速度快、容量小、单位价格高。 |
| 辅助存储器（辅存）      | 辅存存放当前暂时不用的程序和数据，不能与CPU直接交换信息。<br />速度慢、容量大、单位价格低。 |
| 高速缓冲存储器（Cache） | Cache存放当前CPU经常使用的指令和数据。<br />速度快、容量小、单位价格高。 |

| 存取方式                                    | 特点                                                         |
| ------------------------------------------- | ------------------------------------------------------------ |
| 随机存储器（RAM）<br />Random Access Memory | RAM的任何一个存储单元的内容都可以随机存取，存取时间与存储单元的物理位置无关。<br />可读/写存储器，主要用作主存、Cache，分为静态RAM和动态RAM。 |
| 只读存储器（ROM）<br />Read Only Memory     | ROM存放固定不变的数据（不易失），只能随机读出存储内容，而不能重新写入。<br />ROM与RAM共同作为主存的一部分，统一构成主存的地址域。<br />掩模型只读存储器（MROM）、可编程只读存储器（PROM）、可擦除可编程只读存储器（EPROM）、电可擦除可编程只读存储器（EEPROM）。 |
| 串行访问存储器                              | 串行访问存储器对存储单元进行读/写操作时，需按其物理位置的先后顺序寻找地址。（信息所处位置不同，读/写时间不同）<br />顺序存取存储器（磁带）读/写时必须从介质的始端开始按顺序寻找信息<br />直接存取存储器（磁盘）直接指出该存储器中的某个小区域（磁道）（直接访问），再按顺序寻访，直到找到位置。 |

> 相联存储器按内容或地址寻址。把存储单元所存内容的某一部分作为检索项，并将存储器中与该检索项符合的存储单元内容进行读/写出操作。

| 信息的可保存性 | 说明                       |
| -------------- | -------------------------- |
| 易失性存储器   | 断电后，存储信息消失       |
| 非易失性存储器 | 断电后，存储信息仍然保留   |
| 破坏性读出     | 读出后，原存储信息被破坏   |
| 非破坏性读出   | 读出后，原存储信息不被破坏 |

| 存储介质     | 特点：能寄存“0”、“1”两种代码，并能区别两种状态的物质/元器件  |
| ------------ | ------------------------------------------------------------ |
| 半导体存储器 | 存储元件由半导体器件组成的存储器。<br />易失性存储器。体积小、功耗小、存取时间短<br />双极型（TTL）高速。<br />MOS：高集成度、制造简单、成本低廉、功耗小。 |
| 磁表面存储器 | 在金属/塑料基体表面涂一层磁性材料作为记录介质，工作时，磁场随载磁体高速运转，用磁头在磁层上进行读/写操作。<br />按磁体形状不同：磁盘、磁带、磁鼓（很少采用）。<br />非易失性：磁表面物质具有矩形磁滞回线特性，按其剩磁状态的不同区分“0”、“1”，且剩磁状态不容易丢失。 |
| 磁芯存储器   | 磁芯：由硬磁材料制成的环状元件，在磁芯中穿有驱动线（通电流）和读出线进行读写操作。<br />不易失的永久记忆存储器。体积大、工艺复杂、功耗太大。（几乎不采用，被半导体存储器替代） |
| 光盘存储器   | 应用激光在记录介质（磁光材料）上进行读/写的存储器。<br />非易失性。密度高、耐用性好、可靠性高、可互换性强。（用于计算机系统） |

## 存储器性能指标

- 存储器的主要性能指标：速度、容量、每位价格（位价）。速度越高、位价就越高；容量越大，速度必越低，位价就越低。

<img src="../../pictures/计算机组成原理-存储器-位价.drawio.svg" width="600"/>

- 存储容量（Byte） = 存储字数（存储单元个数，存储器的地址空间大小） \* 字长（一次存取操作的数据量）

- 每位价格（单位成本） = 总成本 / 总容量
- 数据传输率（存储器带宽，存储速度） = 数据的宽度 / 存取周期（存储周期）

<img src="../../pictures/计算机组成原理-存取时间和访问周期.drawio.svg" width="400"/> 

| 指标                                 | 说明                                                         |
| ------------------------------------ | ------------------------------------------------------------ |
| 存取时间                             | Memory Access Time，启动一次存储器操作（读/写出）到完成该操作所用时间<br />读出时间：从存储器接收到有效地址开始，到产生有效输出所需的全部时间<br />写入时间：从存储器接收到有效地址开始，到数据写入被选中单元为止所需的全部时间 |
| 恢复时间                             | 任何存储器在读/写操作之后，都需要一段恢复内部状态的时间      |
| 存取周期<br />读写周期<br />访存周期 | Memory Cycle Time，存储器进行连续两次独立的存储器操作所需的最小间隔时间<br />存取周期 = 存取时间 \+ 恢复时间 |
| 主存带宽<br />数据传输率             | 单位时间内存储器存取的信息量（字/秒、字节/秒、位/秒）        |

> 现代MOS型存储器的存取周期可达到100ns、双极型TTL存储器的存取周期接近于10ns。
>

## 缓存-主存-辅存 三级存储系统 

- 存储器层次结构利用上一级存储器作为下一级存储器的高速缓冲（上层作为下层的部分内容的副本），解决速度\-成本\-容量的冲突。

<img src="../../pictures/计算机组成原理-存储器-层次结构.drawio.svg" width="600"/>

1. 缓存-主存层次：解决CPU和主存速度不匹配的问题。缓存的速度比主存的高，将CPU近期要使用的信息调入缓存，CPU便可直接从缓存获取信息，提高访存速度。由于缓存的容量小，需要不断地将主存的内容调入缓存，使缓存中原有的信息被替换。数据操作由硬件自动完成，对所有程序员透明。

2. 主存-辅存层次：解决存储系统容量问题。辅存的速度比主存低，而且不能直接和CPU交换信息，但辅存的容量大于主存，可存放大量暂时未使用到的信息。当CPU需要使用到这些信息时，将辅存的内容调入主存，供CPU直接访问。数据操作由硬件和操作系统共同完成，对应用程序员透明。

- 命中率：上级存储器对下级存储器访问时，下级存储器中正好存在需要的数据的概率。对于CPU-Cache-主存，若命中，则耗费时间为Cache的访问时间；若未命中（此时，CPU直接访问主存），则Cache+主存的访问时间。（CPU可直接读取主存的数据，数据不需要再从主存经过Cache而到达CPU）

> 需要注意是否是Cache和内存同时访问。

- 虚拟存储系统：编程的地址范围与虚拟存储器的地址空间相对应。当虚地址的内容在主存时，机器可直接使用；若虚地址的内容不在主存，则必须将此虚地址的内容传递到主存的合适单元，再被机器使用。逻辑地址转换为物理地址由硬件和操作系统共同完成，对程序员透明。

| 指令地址 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 虚拟地址 | 编程时大于实际主存空间的可用地址空间，实际并不存在。（虚地址、虚存地址、逻辑地址） |
| 物理地址 | 主存的实际地址，程序执行过程中真正访问的地址。               |

# 主存储器 MM

## 主存基本组成

<img src="../../pictures/计算机组成原理-MM-struct.drawio.svg" width="800"/> 

- 指令执行过程中需要访问主存时。首先由CPU将被访问单元的地址送到MAR，经地址总线送至主存的地址寄存器，以便地址译码器译码选中的单元。同时CPU将读写信号通过控制线送到主存的读写控制电路。若为写操作，则CPU同时将要写的信息送到MDR，在读写控制电路的控制下，经数据线将信号写入选中的单元；若为读操作，则主存读出选中单元的内容送到数据线，之后送到MDR。

### 存储单元编址

- 主存储器（MM，Main Memory）的核心部分是由一个个存储0或1的记忆单元（存储元件）构成的存储矩阵（[存储体](#存储体)），记忆单元是具有两种稳态的能表示二进制0和1的物理器件，为存取存储体中的信息，必须对存储单元编址。编址单位是具有相同地址的存储元件构成的，按字或字节编址。

> 现代计算机通常采用字节编址，存储体内的一个地址有一个字节。

- 主存各存储单元的空间位置由单元地址号表示，地址总线指出存储单元地址号，根据该地址可读出/写入一个存储字。

> 不同的机器存储字长不同，但都是8的倍数：通常使用8位二进制数表示一个字节，以满足字符处理需要。

- 字寻址、字节寻址。

<img src="../../pictures/计算机组成原理-字寻址和字节寻址.drawio.svg" width="600"/>

## 半导体存储芯片

- 存储芯片通过地址总线、数据总线、控制总线与外部连接。
- 半导体存储芯片是超大规模集成电路制造工艺，一个芯片内集成具有记忆功能的存储矩阵、译码驱动电路、读/写电路等。

<img src="../../pictures/计算机组成原理-存储芯片的基本结构.drawio.svg" width="1000"/> 

1. <span name="存储体">存储体</span>：存储元是存放一个二进制位的物理器件，是存储器最基本的构件；地址码相同的多个存储元构成一个存储单元；若干存储单元的集合构成存储体。存储体由行选择线X和列选择线Y来选择所访问的单元，存储体的相同行、列上的位同时被读出或写入。
2. 地址译码器：将地址转换为译码输出线上的高电平，以便驱动相应的读写电路。将地址总线送来的地址信号翻译成对应存储单元的选择信号，该信号在读/写电路的配合下完成对被选中单元的读/写操作。
3. I/O选择电路：控制被选中单元的读写，具有放大信息的作用。
4. 片选控制信号：保证在访问某个字时，选中该存储字所在的芯片，避免选中其他芯片。
5. 读/写控制信号：根据CPU给出的读/写命令，控制被选中单元进行读/写操作。

| 类型   | 输入 | 位数                                                |
| ------ | ---- | --------------------------------------------------- |
| 地址线 | 单向 | 位数与芯片容量有关                                  |
| 数据线 | 双向 | 位数与芯片可读出/写入的数据位数有关、与芯片容量有关 |

- 数据线的宽度与MDR宽度相同，地址线的宽度与MAR宽度相同。数据线决定一次可读取的单元数，若为字节编码，则每次最多读取 数据线位数/8个单元的内容。地址线决定主存地址空间的最大可寻址范围，从0开始编址，0\~2<sup>36</sup>\-1。

| 控制线      | 作用                                                         |
| ----------- | ------------------------------------------------------------ |
| 读/写控制线 | 决定芯片进行读/写操作                                        |
| 片选线      | 选择存储芯片<br />半导体存储器由多个芯片组成，通过片选信号来确定被选中的芯片。 |

- 不同存储芯片的读/写控制线、片选线可以不同。

> 一个64K\*8位的存储器，可由32片16K\*1位的存储芯片组成，每次读出一个存储字时，只需选中8片。
>
> <img src="../../pictures/计算机组成原理-64K8bit的存储器.drawio.svg" width="500"/> 

- 译码驱动方式：线选法、重合法。

 <img src="../../pictures/计算机组成原理-译码驱动方式.drawio.svg" width="600"/>

### RAM 随机存取存储器

- RAM通常是为用户编程而设置。

| RAM      | SRAM     | DRAM     |
| -------- | -------- | -------- |
| 存储信息 | 触发器   | 电容     |
| 读出     | 非破坏性 | 破坏性   |
| 刷新     | 不需要   | 需要     |
| 行列地址 | 同时送   | 分两次送 |
| 集成度   | 低       | 高       |
| 位价     | 高       | 低       |
| 信息保存 | 易失性   | 易失性   |
| 用途     | Cache    | 主存     |

#### SRAM 静态RAM

- SRAM（Static Random Access Memory）的存储元通过双稳态触发器（六晶体管 MOS）来记忆信息，非破坏性读出x，易失性。存取速度快，集成度低，功耗大，价格贵；一般用于Cache。

##### 基本单元电路

- 存储器的基本单元电路：存储器中用于存储“0”、“1”代码的电路。

<img src="../../pictures/计算机组成原理-静态RAM的基本单元电路.drawio.svg" width="1200"/> 

<img src="../../pictures/计算机组成原理-Intel2114.drawio.svg" width="1200"/>

<img src="../../pictures/计算机组成原理-2114-RAM矩阵结构.drawio.svg" width="1200"/>

#### DRAM 动态RAM

- DRAM（Dynamic Random Access Memory）利用存储元电路中栅极电容上的电荷来存储信息，其基本存储元一般只使用一个晶体管（集成度高）。容易集成，价位低，容量大，功耗低，存取速度慢；一般用于主存。
- DRAM一般采用地址引脚复用技术，行地址和列地址（行选线和列选线）通过相同的引脚先后两次输入，可减少一半的地址线引脚。

> 行缓冲区（row buffer），8192\*8192\*8位的DRAM芯片，其芯片内行数为8192，每行大小为8192\*8位。

<details>
    <summary>某SRAM存储芯片的容量为32K\*16位，则该芯片的最小引脚数目为____，地址线____根，数据线____根，其他线路____（除了电源和接地端）。若为DRAM芯片呢？</summary>
    1. 该芯片的最小引脚数目为34个，地址线15根（32K = 2<sup>5</sup>*2<sup>10</sup>），数据线16根（16bit），片选线1根、读控制线（RD）1根、写控制线（WE）1根。<br/>
    2. 若为DRAM芯片，采用了地址复用技术，则该芯片的最小引脚数目为28个，地址线为8根（15/2 向上取整），数据线为16根，行通选线1根，列通选线1根、读控制线1根、写控制线1根。
</details>

##### 刷新方式

- DRAM电容上的电荷一般只能维持1\~2ms，即使电源不断电，信息也会自动消失，每隔一段时间就必须刷新，刷新周期一般取2ms。

1. 集中刷新：在一个刷新周期内，利用一段固定的时间（死区），依次对存储器的所有行进行逐一再生，在此期间停止对存储器的读写操作，读写操作和刷新工作分开。
2. 分散刷新：对每行的刷新被分散到各个工作周期（前半部分用于读写操作或保持，后半部分用于刷新），避免了死区，但增长了系统的存取周期。
3. 异步刷新：结合前两种方法，将刷新周期除以行数（两次刷新操作之间的时间间隔 t），利用逻辑电路每隔时间t产生一次刷新请求。

- DRAM的刷新：（1）对CPU透明，不依赖外部访问；（2）以行为单位刷新，由芯片内部自动生成行地址；（3）不需要选片，整个存储器中的所有芯片同时被刷新；（4）一次完整的刷新过程只需要占用一个存储周期，将数据读出经刷新放大器（集成于DRAM）后返回即可（不经过CPU）。

##### 读写周期

- DRAM在读周期中，为使芯片能够正确接收行、列地址，在$\overline{RAS}$有效前将行地址送到芯片的引脚，$\overline{CAS}$滞后$\overline{RAS}$一段时间，在$\overline{CAS}$有效前再将列地址送到芯片的地址引脚，$\overline{RAS}$、$\overline{CAS}$至少保持时间t<sub>RAS</sub>、t<sub>CAS</sub>。$\overline{WE}$为高电平，并在$\overline{CAS}$有效前建立。
- DRAM在读周期中，行列选通的时序关系和读周期相同，但写数据必须在$\overline{CAS}$有效前在数据总线上保持稳定。$\overline{WE}$为低电平，并在$\overline{CAS}$有效前建立。

<img src="../../pictures/计算机组成原理-DRAM读写周期时序.drawio.svg" width="1000"/>

### ROM 只读存储器

- ROM（Read-Only Memory）支持随机访问；非易失性存储器，一旦有了信息就不能轻易改变，即使掉电也不丢失；结构简单，位密度比可读写存储器高。

1. MROM（掩模式只读存储器）由半导体制造厂按用户需求在生产过程中直接写入，任何人都无法改变写入后的内容。可靠性高、集成度高、位价低，但灵活性差。
2. PROM（一次可编程只读存储器）由用户通过编程器写入自己的程序，一旦写入无法改变。
3. EPROM（可擦除可编程只读存储器）由用户通过编程器写入自己的程序，可对其内容多次改写，但次数有限，且写入时间长。
4. Flash（闪存）在EPROM和EEPROM发展而来，可长期断电保存信息。位价低、集成度高，可擦除重写，且速度快，可作为辅存。
5. SSD（固态硬盘 Solid State Drives）基于Flash，由固态电子存储芯片阵列制成的硬盘，由控制单元和存储单元（Flash）组成。

- ROM通常用于存放系统程序、标准子程序、各类常数。

## 多模块存储器

- 多模块存储器是空间并行技术，利用多个结构完全相同的存储模块的并行工作来提高存储器的吞吐率。

1. 单体多字存储器：存储器中只有一个存储体，每个存储体存储m个字，总线宽度也为m个字。一次并行读出m个字，地址必须顺序排列并处于同一存储单元（指令和数据必须是连续存放在内存的）。

> 基于CPU的速度比存储器块。

2. 多体并行存储器由多体模块组成，每个模块都有相同的容量和存取速度，各模块都有独立的读写控制电路、地址寄存器、数据寄存器，各模块既能并行工作，也能交叉工作。

> 双端口存储器具有两套独立的读/写口，具有各自的地址寄存器和译码电路，可以同时访问同一区间、同一单元，也就是端口的地址码相同时，不会发生冲突。

### 高位交叉编址（顺序方式）

- 高位地址表示体号，低位地址表示体内地址，高位交叉编址总是将低位的体内地址送到由高位体号确定的模块内进行译码。访问一个连续主存块时，总是先在一个模块内访问，等待该模块访问结束后才转到下一个模块访问，CPU总是按顺序访问存储模块，各模块不能被并行访问，不能提高存储器的吞吐率。

<img src="../../pictures/计算机组成原理-高位交叉编址.drawio.svg" width="500"/> 

### 低位交叉编址（交叉方式）

- 低位地址表示体号，高位地址表示体内地址，总是把高位的体内地址送到由低位体号确定的模块内进行译码。每个模块按模m（m个模块）交叉编址，模块号 = 单元地址 % m，程序连续存放在相邻模块（交叉存储器）。采用流水线方式并行存取，不改变每个模块存取的周期，提供存储器的带宽。

<img src="../../pictures/计算机组成原理-低位交叉编址.drawio.svg" width="500"/> 

<details>
    <summary>假定使用若干16K*8位的存储芯片组成一个64K*8位的存储器，存储芯片各单元采用交叉编址方式，则地址BFFFH所在芯片的最小地址为______。</summary>
    0003H<br/>
    模块数 = 64K*8位 / 16K*8位 = 4，则片选信号（体号）需要的地址位数为2，即低2位为体号。而地址BFFFH的低2位为11，即编号3的芯片（从0开始编号），其最小地址为0003H。
</details>

- 设模块字长等于数据总线宽度，模块存取一个字的存取周期为T，总线传送周期为r，则：

1. 交叉存取度m = T/r，每经过r时间延迟后启动下一个模块，交叉存储器要模块数必须大于等于m，以保证启动某模块后经过m\*r时间后再次启动该模块时，其上次的存取操作已经完成，保证流水线不被中断。
2. 连续存取m个字所需的时间t = T \+ ( m \- 1)r。

> 高位交叉编址（顺序方式）连续存取m个字所需的时间 = mT。

<img src="../../pictures/计算机组成原理-低位交叉编址流水线.drawio.svg" width="400"/> 

<details>
<summary>一个四体并行低位交叉存储器，每个模块的容量为64K*32位，存取周期为200ns，总线周期为50ns，则在200ns内，存储器能向CPU提供___位二进制信息。</summary>
    128位（4*32位），以下两种角度理解：<br/>
    1. 连续取m个字耗时t=T+(m-1)r,平均每个字的存取时间为t/m。实际工作时，m相当大，t/m近似于r，相当于1个总线周期内存储器能向CPU提供一个字（本题为32位）。<br/>
    2. 低位交叉编址的流水线方式充分流动后，每个总线周期都能完成一个字的读写。
</details>

<details>
    <summary>某机器采用四体低位交叉存储器，分别执行以下操作：（1）读取6个连续地址单元中存放的存储字，重复80次；（2）读取8个连续地址单元中存放的存储字，重复60次。则（1）（2）花费的时间之比为____。</summary>
    4:3<br/>
    总线周期r=T/m=T/4<br/>
    （1）在每轮读取存储器的前6个总线周期内，依次进入各体，而下一轮欲读取存储器时，最近访问的M0还在占用中，需要等待2r的时间才能开始下一轮读取，则读取一轮的耗时为2T；而最后一轮结束的时间是第六个字读取结束，也就是M1第二次读取完成，耗时为2T+r。则总耗时为(80-1)*2T+(2T+r)=160T+r=160.25T<br/>
    <img src="../../pictures/计算机组成原理-低位交叉编址流式线001.drawio.svg" width="600"/><br/>
    （2）在每轮读取存储器的前8个总线周期内，依次进入各体，下一轮欲读取存储器时，最近访问的M0未被占用中，不需要等待就可立即开始下一轮读取，则读取一轮的耗时为2T；而最后一轮结束的时间是第8个字读取结束，也就是M3第二次读取完成，耗时为2T+3r。则总耗时为(60-1)*2T+(2T+3r)=160T+3r=120.75T<br/>
    <img src="../../pictures/计算机组成原理-低位交叉编址流式线002.drawio.svg" width="600"/>
</details>
<details>
    <summary>某计算机使用四体交叉编址存储器，假定在存储器总线上出现的主存地址（十进制）序列为8005、8006、8007、8008、8001、8002、8003、8004、8000，则可能出现访存冲突的地址是______。</summary>
    8004和8000<br/>
    每个访存地址对应的模块序号（体号）= 访存地址 % 存储器交叉模块数<br/>
    <table>
        <tr>
            <th>访存地址</th>
            <td>8005</td>
            <td>8006</td>
            <td>8007</td>
            <td>8008</td>
            <td>8001</td>
            <td>8002</td>
            <td>8003</td>
            <td>8004</td>
            <td>8000</td>
        </tr>
        <tr>
            <th>模块序号</th>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>0</td>
            <td>0</td>
        </tr>
    </table>
    <br/>
    判断是否发生访存冲突的规则为，给定的访存地址在相邻的四次访问中出现在同一个存储体（体号相同）内，违背了流水线式的访存方式。
</details>
## 存储器与CPU的连接

1. 选择存储芯片。芯片类型（RAM、ROM）、芯片数量。
2. 地址线的连接。CPU的地址线数往往比存储芯片的地址线数多，通常将CPU地址线的低位和存储芯片的地址线相连，用于字选，译码由芯片的片内逻辑完成；高位则在扩充存储芯片时使用，用于[片选](#片选)，译码由外接译码器逻辑完成。
3. 数据线的连接。CPU的数据线数与存储芯片的数据位数不一定相等，相等时可直接连接；不等时必须对存储芯片[扩位](#位扩展)使得相等。
4. 读/写命令线的连接。（1）CPU读/写命令线一般可直接与存储芯片的读/写控制端相连，通常高电平为读、低电平为写。（2）若CPU的读/写命令线是分开的（$\overline{RD}$、$\overline{WE}$，均为低电平有效），此时CPU的读命令线和存储芯片的运行读控制端相连，而CPU的写命令线和存储芯片的允许写命令控制端相连。
5. 片选线的连接（关键）。那一片存储芯片被选中完全取决于该存储芯片的片选控制端$\overline{CS}$是否能接收到来自CPU的片选有效信号。片选有效信号与CPU的访存控制信号$\overline{MREQ}$有关，只有当CPU要求访存时，才要求选中存储芯片，$\overline{MREQ}$为低电平时有效；若CPU访问I/O，则$\overline{MREQ}$为高电平，表示不要求存储器工作。

### 主存容量扩展

#### 位扩展法

- <span name="位扩展">位扩展</span>，CPU的数据线数与存储芯片的数据位数不一定相等，此时必须对存储芯片扩位，即用多个存储器件对字长进行扩充，增加存储字长。将多个存储芯片的地址端、片选端、读写控制端相应并联，数据端分别引出，使得存储芯片的数据位数与CPU的数据线数相等。

- 仅采用位扩展时，各芯片连接地址线的方式相同，但连接数据线的方式不同，在某一时刻需要选中所有的存储芯片，片选信号$\overline{CS}$要连接到所有芯片，即位扩展为一组的存储芯片（芯片组）只需要一个片选信号。

<img src="../../pictures/计算机组成原理-位扩展.drawio.svg" width="500"/> 

#### 字扩展法

- 字扩展，增加存储器中字的数量，而位数不变。将多个芯片的地址线、数据线、读写控制线相应并联，由片选信号来区分各芯片的地址范围。

- 仅采用字扩展时，各芯片连接地址线的方式相同，连接数据线的方式也相同，但在某一时刻只需要选中部分存储芯片即可，通过片选信号$\overline{CS}$或采用译码器设计连接到相应的芯片，即字扩展的存储芯片不共用一个片选信号，需要为每个字扩展的存储芯片配置独立的一个片选信号。

<img src="../../pictures/计算机组成原理-字扩展.drawio.svg" width="540"/> 

#### 字位同时扩展法

- 字位同时扩展，存储器往往需要同时扩充字和位，即增加存储字的数量，又增加存储字长。
- 采用字位同时扩展时，各芯片连接地址线的方式相同，但连接数据线的方式不同，且需要通过片选信号$\overline{CS}$或采用译码器设计连接到相应的芯片。

<img src="../../pictures/计算机组成原理-字位扩展.drawio.svg" width="640"/> 

### 存储芯片的地址分配和片选

- CPU实现对存储单元的访问，首先需要选择存储芯片（片选），然后为选中的芯片依地址码选择相应的存储单元，以进行数据的存取（字选）。片内的字选通常是由CPU送出的N（片内存储容量2<sup>N</sup>）条低位地址线完成的，地址线直接接到所有存储芯片的地址输入端。
- 片选信号的产生分为<span name="片选">线选法和译码片选法</span>。

<details>
    <summary>假定用8片8Kx8位的存储芯片组成64Kx8位存储器（地址线16位，数据线8位），需要___个片选信号，采用________产生片选信号。</summary>
    8，译码片选法<br/>
    此题，8片存储芯片对应8个片选信号，且除去片内寻址的13（2<sup>13</sup>=8K）位地址线外，仅余高3位。<br/>
    1. 若采用线选法，只能产生3个片选信号，不满足8个片选信号。<br/>
    2. 若采用译码片选法，用一片74LS148作为地址译码器，可以产生2<sup>3</sup>个片选信号，则A<sub>15</sub>A<sub>14</sub>A<sub>13</sub>=000时选中第一片，以此类推。
</details>

<details>
    <summary>若片选地址为111时，选定某一32Kx16位的存储芯片工作，则该芯片在存储器中的首地址和末地址为_______。</summary>
    38000H，3FFFFH<br/>
    由片选地址为111，得到片选地址线（高位地址线）3根；而存储芯片为32Kx16位，得到片内地址线（低位地址线）为15根；总地址线数为18。故首地址为11,1000,0000,0000,0000（共18位，38000H），末地址为首地址加上32K-1，即11,1111,1111,1111,1111（3FFFFH）。
</details>

#### 线选法

- 线选法用除片内寻址外的高位地址线直接（或经反相器）分别接至各个存储芯片的片选端（片选地址线），当某地址线信息为“0”时，就选中与之对应的存储芯片。这些片选地址线每次寻址时只能有一位有效，不允许同时有多位有效，保证每次只选中一个芯片（或芯片组）。

1. 不需要地址译码器。
2. 地址空间不连续，选片的地址线必须分时为低电平（否则不能工作），不能充分利用系统的存储器空间，地址资源浪费（n条地址线原本对应2<sup>n</sup>个地址，但在片选法中，只能对应n个片选信号，需要保证只有一位有效的“0“）。

<details>
    <summary>假设4片2K x 8位存储芯片用线选法构成8K x 8位存储器，则各芯片的片选信号（A<sub>11</sub>~A<sub>14</sub>）为______，其中，低位地址线A<sub>0</sub>~A<sub>10</sub>为字选线，用于片内寻址。</summary>
    <table>
        <tr>
            <th>芯片</th>
            <th>A<sub>14</sub></th>
            <th>A<sub>13</sub></th>
            <th>A<sub>12</sub></th>
            <th>A<sub>11</sub></th>
        </tr>
        <tr>
            <td>0#</td>
            <td>1</td>
            <td>1</td>
            <td>1</td>
            <td>0</td>
        </tr>
        <tr>
            <td>1#</td>
            <td>1</td>
            <td>1</td>
            <td>0</td>
            <td>1</td>
        </tr>
        <tr>
            <td>2#</td>
            <td>1</td>
            <td>0</td>
            <td>1</td>
            <td>1</td>
        </tr>
        <tr>
            <td>3#</td>
            <td>0</td>
            <td>1</td>
            <td>1</td>
            <td>1</td>
        </tr>
    </table>
</details>

#### 译码片选法

- 译码片选法用除片内寻址外的高位地址线通过地址译码器芯片产生片选信号。

<details>
    <summary>地址总线A<sub>0</sub>（高位）~A<sub>15</sub>（低位），用4K x 4位的存储芯片组成16KB存储器，则产生片选信号的译码器的输入地址线应该是_____。</summary>
    A<sub>2</sub>A<sub>3</sub><br/>
    由4K确定字选需要12根低位地址线，故A<sub>4</sub>A<sub>15</sub>都被使用<br/>
    又16KB存储器为16Kx8位，需要位扩展8/4=2。<br/>
    而需要字扩展16K/4K=2<sup>2</sup>，则需要2根高位地址线，则选择A<sub>2</sub>A<sub>3</sub>，而不是A<sub>0</sub>A<sub>1</sub>
</details>

