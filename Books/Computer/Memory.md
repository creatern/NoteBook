# 存储器概述

- 存储元是存放一个二进制位的物理器件，是存储器最基本的构件。地址码相同的多个存储元构成一个存储单元。若干存储单元的集合构成存储体。

## 存储器分类

| 作用（层次）划分        | 特点                                                         |
| ----------------------- | ------------------------------------------------------------ |
| 主存储器（主存）        | CPU可以直接和内存交换信息。<br />速度快、容量小、单位价格高。 |
| 辅助存储器（辅存）      | 辅存存放当前暂时不用的程序和数据，不能与CPU直接交换信息。<br />速度慢、容量大、单位价格低。 |
| 高速缓冲存储器（Cache） | Cache存放当前CPU经常使用的指令和数据。<br />速度快、容量小、单位价格高。 |

| 存取方式                                    | 特点                                                         |
| ------------------------------------------- | ------------------------------------------------------------ |
| 随机存储器（RAM）<br />Random Access Memory | RAM的任何一个存储单元的内容都可以随机存取，存取时间与存储单元的物理位置无关。<br />可读/写存储器，主要用作主存、Cache，分为静态RAM和动态RAM。 |
| 只读存储器（ROM）<br />Read Only Memory     | ROM存放固定不变的数据（不易失），只能随机读出存储内容，而不能重新写入。<br />ROM与RAM共同作为主存的一部分，统一构成主存的地址域。<br />掩模型只读存储器（MROM）、可编程只读存储器（PROM）、可擦除可编程只读存储器（EPROM）、电可擦除可编程只读存储器（EEPROM）。 |
| 串行访问存储器                              | 串行访问存储器对存储单元进行读/写操作时，需按其物理位置的先后顺序寻找地址。（信息所处位置不同，读/写时间不同）<br />顺序存取存储器（磁带）读/写时必须从介质的始端开始按顺序寻找信息<br />直接存取存储器（磁盘）直接指出该存储器中的某个小区域（磁道）（直接访问），再按顺序寻访，直到找到位置。 |

> 相联存储器按内容或地址寻址。把存储单元所存内容的某一部分作为检索项，并将存储器中与该检索项符合的存储单元内容进行读/写出操作。

| 信息的可保存性 | 说明                       |
| -------------- | -------------------------- |
| 易失性存储器   | 断电后，存储信息消失       |
| 非易失性存储器 | 断电后，存储信息仍然保留   |
| 破坏性读出     | 读出后，原存储信息被破坏   |
| 非破坏性读出   | 读出后，原存储信息不被破坏 |

| 存储介质     | 特点：能寄存“0”、“1”两种代码，并能区别两种状态的物质/元器件  |
| ------------ | ------------------------------------------------------------ |
| 半导体存储器 | 存储元件由半导体器件组成的存储器。<br />易失性存储器。体积小、功耗小、存取时间短<br />双极型（TTL）高速。<br />MOS：高集成度、制造简单、成本低廉、功耗小。 |
| 磁表面存储器 | 在金属/塑料基体表面涂一层磁性材料作为记录介质，工作时，磁场随载磁体高速运转，用磁头在磁层上进行读/写操作。<br />按磁体形状不同：磁盘、磁带、磁鼓（很少采用）。<br />非易失性：磁表面物质具有矩形磁滞回线特性，按其剩磁状态的不同区分“0”、“1”，且剩磁状态不容易丢失。 |
| 磁芯存储器   | 磁芯：由硬磁材料制成的环状元件，在磁芯中穿有驱动线（通电流）和读出线进行读写操作。<br />不易失的永久记忆存储器。体积大、工艺复杂、功耗太大。（几乎不采用，被半导体存储器替代） |
| 光盘存储器   | 应用激光在记录介质（磁光材料）上进行读/写的存储器。<br />非易失性。密度高、耐用性好、可靠性高、可互换性强。（用于计算机系统） |

## 存储器性能指标

- 存储器的主要性能指标：速度、容量、每位价格（位价）。速度越高、位价就越高；容量越大，速度必越低，位价就越低。

<img src="../../pictures/计算机组成原理-存储器-位价.drawio.svg" width="600"/>

- 存储容量（Byte） = 存储字数（存储器的地址空间大小） \* 字长（一次存取操作的数据量）
- 每位价格（单位成本） = 总成本 / 总容量
- 数据传输率（存储速度） = 数据的宽度 / 存取周期（存储周期）

<img src="../../pictures/计算机组成原理-存取时间和访问周期.drawio.svg" width="400"/> 

| 指标                                 | 说明                                                         |
| ------------------------------------ | ------------------------------------------------------------ |
| 存取时间                             | 启动一次存储器操作（读/写出）到完成该操作所用时间            |
| 存取周期<br />读写周期<br />访存周期 | 存储器完成一次完整读/写操作所需要的时间（连续两次独立访问存储器操作之间所需的最小时间间隔）<br />任何存储器在读/写操作之后，都需要一段恢复内部状态的时间 |
| 主存带宽<br />数据传输率             | 每秒从主存进出信息的最大数量                                 |

## 缓存-主存-辅存 三级存储系统 

- 存储器层次结构利用上一级存储器作为下一级存储器的高速缓冲（上层作为下层的部分内容的副本），解决速度\-成本\-容量的冲突。

<img src="../../pictures/计算机组成原理-存储器-层次结构.drawio.svg" width="600"/>

1. 缓存-主存层次：解决CPU和主存速度不匹配的问题。缓存的速度比主存的高，将CPU近期要使用的信息调入缓存，CPU便可直接从缓存获取信息，提高访存速度。由于缓存的容量小，需要不断地将主存的内容调入缓存，使缓存中原有的信息被替换。数据操作由硬件自动完成，对所有程序员透明。

2. 主存-辅存层次：解决存储系统容量问题。辅存的速度比主存低，而且不能直接和CPU交换信息，但辅存的容量大于主存，可存放大量暂时未使用到的信息。当CPU需要使用到这些信息时，将辅存的内容调入主存，供CPU直接访问。数据操作由硬件和操作系统共同完成，对应用程序员透明。

- 命中率：上级存储器对下级存储器访问时，下级存储器中正好存在需要的数据的概率。对于CPU-Cache-主存，若命中，则耗费时间为Cache的访问时间；若未命中（此时，CPU直接访问主存），则Cache+主存的访问时间。（CPU可直接读取主存的数据，数据不需要再从主存经过Cache而到达CPU）

> 需要注意是否是Cache和内存同时访问。

- 虚拟存储系统：编程的地址范围与虚拟存储器的地址空间相对应。当虚地址的内容在主存时，机器可直接使用；若虚地址的内容不在主存，则必须将此虚地址的内容传递到主存的合适单元，再被机器使用。逻辑地址转换为物理地址由硬件和操作系统共同完成，对程序员透明。

| 指令地址 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 虚拟地址 | 编程时大于实际主存空间的可用地址空间，实际并不存在。（虚地址、虚存地址、逻辑地址） |
| 物理地址 | 主存的实际地址，程序执行过程中真正访问的地址。               |

# 主存储器

- 主存储器由DRAM实现，而Cache由SRAM实现。

## 半导体存储芯片

- 半导体存储芯片：超大规模集成电路制造工艺，一个芯片内集成具有记忆功能的存储矩阵、译码驱动电路、读/写电路等。

| 基本结构  | 说明                                                         |
| --------- | ------------------------------------------------------------ |
| 译码驱动  | 将地址总线送来的地址信号翻译成对应存储单元的选择信号，<br />该信号在读/写电路的配合下完成对被选中单元的读/写操作。 |
| 读/写单元 | 读出放大器、写入电路：完成读/写操作。                        |

- 存储芯片通过地址总线、数据总线、控制总线与外部连接。

<img src="../../pictures/计算机组成原理-存储芯片的基本结构.drawio.svg" width="700"/> 

- 地址线和数据线的位数共同反映存储芯片的容量。

| 类型   | 输入 | 位数                                                |
| ------ | ---- | --------------------------------------------------- |
| 地址线 | 单向 | 位数与芯片容量有关                                  |
| 数据线 | 双向 | 位数与芯片可读出/写入的数据位数有关、与芯片容量有关 |

> 地址线10根，数据线4根：芯片容量为$2^{10}*4 = 4K$位。
>
> 地址线14根，数据线1根：芯片容量为$2^{14}*1 = 16K$位。

- 不同存储芯片的读/写控制线、片选线可以不同。

| 控制线      | 作用                                                         |
| ----------- | ------------------------------------------------------------ |
| 读/写控制线 | 决定芯片进行读/写操作                                        |
| 片选线      | 选择存储芯片<br />半导体存储器由多个芯片组成，通过片选信号来确定被选中的芯片。 |

> 一个64K`*`8位的存储器，可由32片16K`*`1位的存储芯片组成：每次读出一个存储字时，只需选中8片。
>
> <img src="../../pictures/计算机组成原理-64K8bit的存储器.drawio.svg" width="1200"/>

- 译码驱动方式：线选法、重合法。

<img src="../../pictures/计算机组成原理-译码驱动方式.drawio.svg" width="1400"/>

## RAM 随机存取存储器

### SRAM 静态RAM

- SRAM的存储元通过双稳态触发器（六晶体管 MOS）来记忆信息，非破坏性读出x，易失性。存取速度快，集成度低，功耗大，价格贵；一般用于Cache。

#### 基本单元电路

- 存储器的基本单元电路：存储器中用于存储“0”、“1”代码的电路。

<img src="../../pictures/计算机组成原理-静态RAM的基本单元电路.drawio.svg" width="1200"/> 

<img src="../../pictures/计算机组成原理-Intel2114.drawio.svg" width="1200"/>

<img src="../../pictures/计算机组成原理-2114-RAM矩阵结构.drawio.svg" width="1200"/>

#### 读写周期

### DRAM 动态RAM

- DRAM利用存储元电路中栅极电容上的电荷来存储信息，其基本存储元一般只使用一个晶体管（集成度高）。容易集成，价位低，容量大，功耗低，存取速度慢；一般用于主存。

#### 刷新方式

- DRAM电容上的电荷一般只能维持1\~2ms，即使电源不断电，信息也会自动消失，每隔一段时间就必须刷新，刷新周期一般取2ms。

1. 集中刷新：在一个刷新周期内，利用一段固定的时间（死区），依次对存储器的所有行进行逐一再生，在此期间停止对存储器的读写操作，读写操作和刷新工作分开。
2. 分散刷新：对每行的刷新被分散到各个工作周期（前半部分用于读写操作或保持，后半部分用于刷新），避免了死区，但增长了系统的存取周期。
3. 异步刷新：结合前两种方法，将刷新周期除以行数（两次刷新操作之间的时间间隔 t），利用逻辑电路每隔时间t产生一次刷新请求。

- DRAM的刷新：（1）对CPU透明，不依赖外部访问；（2）以行为单位刷新，由芯片内部自动生成行地址；（3）不需要选片，整个存储器中的所有芯片同时被刷新。

#### 读写周期

- DRAM在读周期中，为使芯片能够正确接收行、列地址，在<span style="text-decoration: overline">RAS</span>有效前将行地址送到芯片的引脚，<span style="text-decoration: overline">CAS</span>滞后<span style="text-decoration: overline">RAS</span>一段时间，在<span style="text-decoration: overline">CAS</span>有效前再将列地址送到芯片的地址引脚，<span style="text-decoration: overline">RAS</span>、<span style="text-decoration: overline">CAS</span>至少保持时间t<sub>RAS</sub>、t<sub>CAS</sub>。<span style="text-decoration: overline">WE</span>为高电平，并在<span style="text-decoration: overline">CAS</span>有效前建立。
- DRAM在读周期中，行列选通的时序关系和读周期相同，但写数据必须在<span style="text-decoration: overline">CAS</span>有效前在数据总线上保持稳定。<span style="text-decoration: overline">WE</span>为低电平，并在<span style="text-decoration: overline">CAS</span>有效前建立。

<img src="../../pictures/计算机组成原理-DRAM读写周期时序.drawio.svg" width="1000"/>

## ROM 只读存储器

## 多模块存储器

## 概述

### 主存基本组成

<img src="../../pictures/计算机组成原理-主存的基本组成.drawio.svg" width="1200"/> 

### 主存、CPU读写过程-

- 从存储器读出某一信息字时：

1. 首先由CPU将该字的地址送到MAR，经地址总线送至主存，然后发出读命令。
2. 主存接到读命令后，得知需要该地址单元的内容读出，完成读操作，将该单元的内容读至数据总线。
3. 由CPU决定该信息由MDR送至何处。

- 向主存存入一个信息字时：

1. 首先CPU将该字所在主存单元的地址经MAR送至地址总线，并将信息字送入MDR，之后向主存发出写命令。
2. 主存接到写命令后，将数据总线上的信息写入对应地址总线指出的主存单元内。

### 存储单元地址的分配

- 主存各存储单元的空间位置由单元地址号表示，地址总线指出存储单元地址号，根据该地址可读出/写入一个存储字。

> 不同的机器存储字长不同，但都是8的倍数：通常使用8位二进制数表示一个字节，以满足字符处理需要。

- 字寻址、字节寻址。

<img src="../../pictures/计算机组成原理-字寻址和字节寻址.drawio.svg" width="1200"/>

### 技术指标

- 主存的主要技术指标：存储容量、存储速度。

#### 存储容量

- 存储容量：主存能存放二进制代码的总位数。

$$
\tag{位数}
存储容量 = 存储单元个数 \times 存储字长
$$

$$
\tag{字节总数}
存储容量= 存储单元个数 \times 存储字长/8
$$

> 某机器内存的存储容量为256MB，则按字节寻址的地址线位数对应28位。

#### 存储速度

- 存储速度：由存取时间、存取周期表示。
- 存取时间（存储器的访问时间 Memory Access Time）：启动一次存储器操作（读/写）到完成该操作所需要的全部时间。

| 存取时间 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 读出时间 | 从存储器接收到有效地址开始，到产生有效输出所需的全部时间。   |
| 写入时间 | 从存储器接收到有效地址开始，到数据写入被选中单元为止所需的全部时间。 |

- 存取周期（Memory Cycle Time）：存储器进行连续两次独立的存储器操作所需的最小间隔时间。
  - 存取周期通常大于存取时间。

> 现代MOS型存储器的存取周期可达到100ns
>
> 双极型TTL存储器的存取周期接近于10ns

#### 存储器带宽

- 存储器带宽：单位时间内存储器存取的信息量（字/秒、字节/秒、位/秒），与存取周期密切相关，衡量数据传输率。

> 若存储器的存取周期为500ms，每个存取周期可访问16位，则其带宽为32M bit/s

- 提高存储器带宽的措施：

1. 缩短存取周期。
2. 增加存储字长，使每个存取周期可读/写更多的二进制位数。
3. 增加存储体。

