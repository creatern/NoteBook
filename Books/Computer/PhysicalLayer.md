# 通信基础

## 基本概念

### 数据、信号、码元

- 通信的目的是传送信息；数据是信息的载体；信号则是数据的电气或电磁表现，是数据在传输过程中的存在形式。

1. 模拟数据（模拟信号）：连续变化的数据（信号）。
2. 数字数据（数字信号）：取指仅为有限个离散数值的数据（信号）。

- 数据传输方式分为串行传输和并行传输。
- 码元是用一个固定时长的信号波形（数字脉冲）表示一位k进制数字，代表不同离散数值的基本波形，是数字通信中数字信号的计量单位。k进制码元（通常为二进制码元）是该固定时长内的信号，而码元宽度是该固定时长。1码元可以携带若干比特的信息量。
- <span name="有效离散位">有效离散位</span>：码元的离散电平的数目表示有多少种不同的码元。有效离散位的位数：（1）[QAM](#QAM)，m个相位 x n种幅度；（2）二进制信号的有效离散位的位数为2
- 对于k进制码元，m位有效离散位，1码元携带的信息量（bit） = log<sub>k</sub><sup>m</sup>。

### 信源、信道、信宿

- 数据通信是数字计算机或其他数字终端之间的通信，一个数字通信系统主要划分为信源、信道和信宿三个部分。信源发出的信息需要通过变换器转换成适合于在信道传输的信号，而通过信道传输到接收端的信号先由反变换器转换成原始信息，再发送给信宿。

1. 信源是产生和发送数据的源头。
2. 信宿是接收数据的终点。
3. 信道是信号的传输媒介，不等同电路。信道可视为一条线路的逻辑部件，表示向某个方向传送信息的介质，故一条通信线路往往包含一条发送信道和一条接收信道。
4. 噪声源（信噪）是信道上的噪声（干扰）及分散在通信系统其他各处的噪声的集中表示。

<img src="../../pictures/计算机网络-通信系统模型.drawio.svg" width="600"/> 

- 信道按传输信号形式的不同，分为模拟信道（传送模拟信号）和数字信道（传送数字信号）；按传输介质的不同，分为无线信道和有线信道。
- 信道上的信号分为基带信号和宽带信号。

1. 基带信号将数字信号0和1直接用两种不同的电压表示，然后送到数字信道上传输（基带传输）。

2. 宽带信号将基带信号进行调制后形成频分复用模拟信号，然后送到模拟信道上传输（宽带传输、频带传输）。

- 通信双方信息的交换方式分为三种基本方式，单向通信、半双工通信、全双工通信。
- 信道的极限容量是指信道的最高码元传输速率或信道的极限信息传输速率。

### 速率、波特、带宽

- 速率（数据率、数据传输速率）表示单位时间内传输的数据量。

1. 码元传输速率（波特率，波特 Baud）表示单位时间内数字通信系统所传输的码元个数（脉冲个数、信号变化的次数）。一波特表示数字通信系统每秒传输一个码元，码元速率和进制数无关。
2. 信息传输速率（信息速率、比特率，bit/s）表示单位时间内数字通信系统传输的二进制码元个数（比特数）。

- 波特率和比特率的转换主要取决于码元，如[以太网的波特率](#曼彻斯特编码)是比特率的2倍。波特率 = 比特率 / 每码元携带的比特数。

- 带宽即最高数据率（bit/s），而不是一般所认为的信号的频带宽度。

## 奈奎斯特定理、香农定理

- 奈氏准则只考虑带宽与极限码元速率的关系；而香农定理考虑宽带以及信噪比。若给出了[码元与比特数之间的关系](#有效离散位)，则需要受到两个公式的共同制约。

<details>
    <summary>二进制信号在信噪比为127 : 1的4kHz的信道上传输，最大数据传输速率可达到_______。</summary>
    8000 bit/s<br/>
    “二进制信号”给出了码元与比特数之间的关系，需要受到两个公式的共同制约。<br/>
    1. 奈氏准则：理想低通信道下的极限数据传输速率 = 2Wlog<sub>2</sub><sup>V</sup> = 2*4000*log<sub>2</sub><sup>2</sup> = 8000 bit/s<br/>
    2. 香农定理：信道的极限数据传输速率 = Wlog<sub>2</sub><sup>(1+S/N)</sup> = 4000*log<sub>2</sub><sup>1+127</sup> = 28000 bit/s
</details>


### 奈奎斯特定理（奈氏准则）

- <span name=" 奈氏准则">奈氏准则</span>（Nyquist）规定在理想低通（信道没有噪声、带宽有限），为避免码间串扰，极限码元传输速率为2W波特。W是理想低通信道的带宽，V是每个码元[离散电平的数目](#有效离散位)。

理想低通信道下的极限数据传输速率（bit/s） = 2Wlog<sub>2</sub><sup>V</sup> 

1. 在任何信道，码元的传输速率是有上限的，避免码间串扰。
2. 信道的频带越宽（通过的信号高频分量越多），就可用更高的速率进行码元的有效传输。
3. 给出了码元传输速率的限制，而并未对信息传输速率给出限制，即没有限制一个码元对应多少个二进制位，但也侧面反映了一个码元对应的二进制位数是有限的。

- 采样定理：在通信领域，带宽是指信号最高频率和最低频率之差，单位为Hz。因此，将模拟信号转换为数字信号时，假设原始信号中的最大频率为f，则采样频率f<sub>采样</sub>必须大于或等于最大频率的两倍，才能保证采样后的数字信号完整保留原始模拟信号的信息。

### 香农定理

- 香农定理（Shannon）给出了带宽受限且有高斯白噪声干扰的信道的极限数据传输速率，用此速率进行传输时，可以做到无误差。

1. W为信道的带宽
2. S/N（信噪比），信号的平均功率（S）与噪声的平均功率（N）之比。若给出的S/N的单位为dB（分贝），则x dB = 10log<sub>10</sub><sup>(S/N)</sup>

信道的极限数据传输速率 = Wlog<sub>2</sub><sup>(1+S/N)</sup>

1. 信道的带宽或信道的信噪比越大，信息的极限传输率越高。
2. 对一定的传输带宽和一定的信噪比，信息传输速率的上限是确定的。
3. 只要信息传输速率低于信道的极限传输速率，就能找到某种方法来实现无差错的传输。
4. 香农定理得出的是极限信息传输速率，实际信道能够达到的传输速率要更低。

<details>
    <summary>电话系统的典型参数是信道带宽为3kHz，信噪比为30dB，则该系统的最大数据传输速率为_____。</summary>
    30000bit/s<br/>
    该题未给出码元和比特之间的关系，仅给出信噪比和带宽，只需要考虑香农定理。<br/>
    由信噪比为30dB，则30 = 10log<sub>10</sub><sup>S/N</sup>，S/N = 1000<br/>
    信道的极限数据传输速率 = Wlog<sub>2</sub><sup>(1+S/N)</sup> = 1000*log<sub>2</sub><sup>(1+1000)</sup>&asymp;30000bit/s<br/>
</details>


## 编码与调制

- 数据（数字和模拟）都必须转变成信号才能传输。

1. 调制：把数据变换为模拟信号的过程
2. 编码：把数据变换为数字信号的过程

- 数字数据可以通过数字发送器转换为数字信号，也可以通过调制器转换成模拟信号；模拟数据可以通过PCM编码器转换成数字信号，也可以通过放大器调制器转换成模拟信号。

### 数字数据编码为数字信号

- 数字数据编码用于基带传输，在基本不改变数字数据信号的情况下，直接传输数字信号。
- 编码规定具体使用何种数字信号表示0和1。

<img src="../../pictures/计算机网络-数字数据编码.drawio.svg" width="600"/> 

1. 归零编码（RZ）用高电平代表1、低电平代表0（或相反），每个时钟周期的中间均跳变到低电平（归零）。接收方根据该跳变调整本方的时钟基准，为传输双方提供了自同步机制，但归零需要占用一部分的带宽。
2. 非归零编码（NRZ）不用归零，一个周期可以全部用来传输数据，但无法传输时钟信号，传输双方难以同步。若要参数高速同步数据，则传输双方都需要带有时钟线。
3. 反向非归零编码（NRZI）用信号的翻转表示0、信号保持不变表示1，翻转本身可作为通知机制。既能传输时钟信号，又能尽量不损失系统带宽。

> USB2.0通信的编码方式采用NRZI。

4. <span name="曼彻斯特编码">曼彻斯特编码</span>（Manchester Encoding）将一个码元分成两个相等的间隔，前一个间隔为高电平而后一个间隔为低电平表示码元1，码元0的表示则相反，或采用相反的规定。在每个码元的中间出现电平跳变，位中间的跳变既作为时钟信号，又作为数据信号，但占用的频带宽度是原始基带宽度的2倍（此时，波特率是比特率的2倍，每码元携带2bit的信息量）。

> 以太网采用曼彻斯特编码。

5. 差分曼彻斯特编码常用于局域网传输，若码元为1，则前半个码元的电平与上一码元的后半个码元的电平相同；若码元为0，则相反。在每个码元的中间都有一次电平的跳转，可实现自同步，且抗干扰性好。
6. 4B/5B编码将欲发送数据流的每4位作为一组，之后按照4B/5B编码规则将其转换成相应的5位码。5位码共32（2<sup>5</sup>）种组合，但只能采用其中的16种对应16种不同的4位码，其余的16位作为控制码或保留。

### 数字数据调制为模拟信号

- 数字数据调制技术在发送端将数字信号转换为模拟信号（调制解调器的调制），而在接收端将模拟信号还原为数字信号（调制解调器的解调）。

1. ASK（幅移键控）通过改变载波信号的振幅来表示数字信号1和0，而载波的频率和相位都不改变。较容易实现，抗干扰能力差。
2. FSK（频移键控）通过改变载波信号的频率来表示数字信号1和0，而载波的振幅和相位都不改变。较容易实现，抗干扰能力强，应用广泛。
3. PSK（相移键控）通过改变载波信号的相位来表示数字信号1和0，而载波的频率和振幅都不改变。分为绝对调相和相对调相。
4. <span name="QAM">QAM</span>（正交振幅调制）在频率相同的前提下，将ASK和PSK相结合，形成叠加信号。设波特率为B，采用m个相位，每个相位有n种振幅，则该QAM技术的数据传输速率R为 R = Blog<sub>2</sub><sup>(mn)</sup>

> 采用QAM的[有效离散位](#有效离散位)数量 = m个相位 x n种幅度。

<img src="../../pictures/aHR0cDovL3N0b3JhZ2UucWluaXUuYXNwaS50ZWNoLyVFNiU5QyU4MCVFNSU5RiVCQSVFNiU5QyVBQyVFNyU5QSU4NCVFNCVCOCU4OSVFNyVBNyU4RCVFOCVCMCU4MyVFNSU4OCVCNiVFNiU5NiVCOSVFNiVCMyU5NS5wbmc.png" width="600"/> 

### 模拟数据编码为数字信号

- 该编码的典例为对音频信号进行编码的PCM（脉冲调制），主要包括采样、量化、编码三个步骤。

1. 采样是对模拟信号进行周期性扫描，把时间上连续的信号变成时间上离散的信号。由采样原理（[奈奎斯特定理](#奈氏准则)），规定当采样的频率大于或等于模拟数据的频带宽度（最高变化频率）的两倍时，所得的离散信号可以无失真地代表被采样的模拟数据。
2. 量化是将采样取得的电平幅值按照一定的分级标度转换为对应的数字值并取整，将连续的电平幅值转换为离散的数字量。
3. 编码是将量化的结果转换为与之对应的二进制编码。

### 模拟数据编码为模拟信号

- FDM（频分复用技术）。
- 电话机和本地局交换机采用模拟信号传输模拟数据的编码方式，模拟的声音数据是加载到模拟的载波信号中传输的。

## 交换技术

1. 传送的数据量很大且传送时间远大于呼叫时间，采用电路交换。
2. 端到端的通路由多段链路组成，采用分组交换。
3. 提供整个网络的信道利用率，报文交换和分组交换优于电路交换。
4. 计算机之间的突发式数据通信，采用分组交换，分组交换的平均时延小于报文交换。

<img src="../../pictures/计算机网络-三种交换技术.drawio.svg" width="800"/> 

<details>
    <summary>比较电路交换网络和分组交换网络，要传送的报文共x比特。从源点到终点一定经过k段链路，每段链路的传播时延为d秒，数据传输速率为b比特每秒。在电路交换时电路的建立时间为s秒。在分组交换时分组长度为p比特，且各结点的排队等待时间可忽略不计。问在何种条件下，分组交换的时延比电路交换的时延小？</summary>
    对于k段链路共经过k-1个结点，设有n个分组（不等于x/p，np&asymp;x）<br/>
    1. 电路交换时延 = s + kd + x/b<br/>
    2. 分组交换时延 = kd + np/b + (k-1)p/b<br/>
    要求 kd + np/b + (k-1)p/b &lt; s + kd + x/b，则 (k-1)p/b &lt; s<br/>
    <img src="../../pictures/计算机网络-交换技术-电路交换-分组交换.drawio.svg" width="600"/>
</details>

### 电路交换

- 电路交换：进行数据传输之前，源结点和目的结点之间必须先建立一条专用（双方独占）的物理通信路径（由通信双方之间的交换设备和链路逐段连接而成），该路径可以经过多个中间结点。电路交换包括连接建立、数据传输、连接释放三个阶段。

> 最典型的是传统电话网络。

- 电路交换的优点

1. 数据直接传送、时延小：电路建立后，通信线路被独占，除源结点和目的结点外，电路上的任何结点都采用“直通方式”接收和发送数据，不存在存储转发所消耗的时间。
2. 有序传输：双方通信时按发送顺序传送数据，不存在失序问题。
3. 没有冲突：不同的通信双方独立地拥有不同的信道，不存在信道的争用。
4. 使用范围广：可以用于传输模拟信号和数字信号。
5. 实时性强：通信双方一旦建立物理通路，就可以随时通信。
6. 控制简单。

- 电路交换的缺点

1. 建立连接时间长，灵活性差、不便差错控制：电路建立需要的时间长，且一旦通信线路中任何一点出现故障，就必须重新拨号建立新的连接。
2. 线路独占，信道利用率低：电路建立后，通信线路被独占，即使通信线路空闲，也不能被其他用户使用。
3. 难以规格化。

### 报文交换

- 报文交换网络（存储-转发网络）：用户数据加上源地址、目的地址、校验码等辅助信息，之后封装为报文。整个报文传送到相邻结点，全部存储后，再转发到下一个结点，直到到达目的结点。每个报文可以单独选择到达目的结点的路径，可以同时发送给多个目的地。
- 报文交换的优点

1. 无须建立连接。
2. 动态分配线路。
3. 提高线路可靠性。
4. 提高线路利用率：可以较充分地利用线路容量，实现不同链路之间不同数据传输速率的转换、格式转换。
5. 提供多目标服务：可以实现一对多、多对一的访问，实现差错控制。

- 报文交换的缺陷

1. 存储转发时延。
2. 增大了资源开销：封装了额外的辅助信息。
3. 增加了缓冲机制：需要额外的控制机制来保证多个报文的顺序。
4. 缓冲区难以管理：报文的大小没有限制，接收方在接收到报文之前不能预知报文的大小。

### 分组交换

- 分组交换网络（包交换网络）：将数据分成较短的固定长度的数据块，在每个数据块中加上必要的控制信息封装为分组（包，Packet），以存储-转发方式传输。网络结点根据控制信息把分组送到下一个结点，下一个结点接受到分组后，暂时保存并排队等待传输，之后根据分组控制信息选择其下一个结点，直到达目的结点。
- 分组交换的优点

1. 具有报文交换网络的优点。
2. 相对于报文交换，缓冲易于管理：分组交换限制了每次传送的数据块大小的上限，相应的缓冲区的大小也固定。
3. 包的平均时延更小，网络占用的平均缓冲区更少：分组是逐个传输的（流水线），可以使后一个分组的存储和前一个分组的转发并行完成。
4. 减少了出错概率和重发数据量。

- 分组交换的缺点

1. 存储转发时延。
2. 资源开销大于报文交换网络：每个分组（小数据块）都要带上必要的控制信息，使得传送的信息量增大了5%\~10%。
3. 若采用数据报服务，可能会出现失序、丢失、重复分组；若采用虚电路，则无失序问题，但需要呼叫建立、数据传输、虚电路释放三个阶段。

| 比较     | 数据报                           | 虚电路                                         |
| -------- | -------------------------------- | ---------------------------------------------- |
| 连接建立 | 不需要                           | 需要                                           |
| 目的地址 | 每个分组都有完整的目的地址       | 仅建立连接阶段需要，之后每个分组使用虚电路号   |
| 路由选择 | 每个分组独立地进行路由选择和转发 | 属于同一条虚电路的分组按照同一路由转发         |
| 可靠性   | 尽最大努力交付，可靠性由主机保证 | 可靠性由网络保证                               |
| 故障适应 | 仅出故障的结点丢失分组           | 所有经过故障结点或故障链路的虚电路都将遭到破坏 |

#### 数据报

- 作为通信子网用户的端系统发送一个报文时，在端系统中实现的高层协议先把报文拆成若干带有序号的数据单元，并在网络层加上控制信息后形成数据报分组。中间结点存储分组并找到最佳的路由，尽快转发每个分组。每个分组可以选择不同的路径，也可以按照不同的顺序到达目的结点。

1. 发送分组之前不需要建立连接，通信双方不独占某条链路，资源利用率高。
2. 尽最大努力交付，分组可能丢失、失序、重复。
3. 发送的分组在交换结点存储转发时，需要排队等候处理；但存储转发的延时一般较小，提高了网络的吞吐量。
4. 网络具有冗余路径，对故障适应能力强：当某个交换结点或链路出现故障时，可相应地更新转发表，寻找另一条路径转发分组。

#### 虚电路

- 在分组发送之前，要求通信双方建立一条逻辑上相连的虚电路，且连接一旦建立，就固定了虚电路对应的物理路径。通信过程包括虚电路建立、数据传输、虚电路释放三个阶段。
- 虚电路不是专用的，每个结点到其他结点之间的链路可能有多个虚电路通过，也可能同时与多个结点之间建立虚电路。虚电路支持特定的两个端系统之间的数据传输，两个端系统之间也可以有多条虚电路为不同的进程服务，这些虚电路的实际路由可以相同或不同。
- 端系统每次建立虚电路时，选择一个从未使用过的虚电路号分配给该虚电路，用以区别该系统中的虚电路。虚电路网络中的每个结点都维护一张虚电路表，每一项记录一个打开的虚电路的信息（接收链路和发送链路上的虚电路号、前一结点和下一结点的标识）（虚电路建立时确定这些信息）。数据的传输是双向进行的。

<img src="../../pictures/20210412110305934.png" width="400"/>  

1. 虚电路通信链路的建立和拆除需要时间开销，对交互式应用和小量的短分组情况显得浪费，但对长时间、频繁的数据交换效率较高。
2. 虚电路的路由选择体现在连接建立阶段，连接建立之后就确定了传输路径。
3. 虚电路提供可靠的通信功能，且保证每个分组正确有序地到达，且可以进行流量控制。
4. 网络中的某个阶段或链路出现故障时，所有经过该结点或链路的虚电路都将遭到破坏。
5. 分组的首部在虚电路建立阶段需要包含目的地址，而建立通信链路之后，分组的首部不包含目的地址，而是虚电路标识符。

### 信元交换

# 传输介质