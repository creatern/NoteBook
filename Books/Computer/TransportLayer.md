# 传输层提供的服务

## 传输层的功能

- 从通信和信息处理的角度看，传输层向它上面的应用层提供通信访问，属于面向通信部分的最高层，同时也是用户功能中的最底层。
- 传输层位于网络层的之上，为运行在<b>不同主机上的进程之间</b>提供了逻辑通信，而网络层提供主机之间的逻辑通信。
- 在通信子网中没有传输层，传输层只存在于通信子网以外的主机中。

<img src="../../pictures/20240227172314.png" width="600"/> 

<table>
    <tr>
        <th width="10%">功能</th>
        <th width="45%">传输层</th>
        <th width="45%">网络层</th>
    </tr>
    <tr>
        <td>逻辑通信</td>
        <td>提供应用进程之间的逻辑通信（端到端）</td>
        <td>提供的是主机之间的逻辑通信（点到点）</td>
    </tr>
    <tr>
        <td>复用分用</td>
        <td>传输层的复用是<b>发送方不同的应用进程</b>都可使用同一个传输层协议传送数据；分用是指接收方的传输层在剥去报文的首部后能够把这些数据正确交付到目的应用进程</td>
        <td>网络层的复用是指<b>发送方不同协议的数据</b>都可封装成IP数据报发送出去；分用是指接收方的网络层在剥去首部后把数据交付给相应的协议</td>
    </tr>
    <tr>
        <td>差错检测</td>
        <td>还要对收到的报文进行差错检测（首部和数据部分）</td>
        <td>只检查IP数据报的首部，不检验数据部分是否出错</td>
    </tr>
    <tr>
        <td>传输协议</td>
        <td>提供两种不同的传输协议，面向连接的TCP和无连接的UDP</td>
        <td>无法同时实现两种协议，要么只提供面向连接的服务（如虚电路等），要么只提供无连接的服务（如数据报）</td>
    </tr>
</table>

-  传输层向高层用户屏蔽了低层网络核心的细节。

## 传输层的寻址与端口

### 端口

- 端口能够让应用层的各种应用进程将其数据通过端口向下交付给传输层，以及让传输层指定应当将其报文段中的数据向上通过端口交付给应用层相应的进程。
- 端口是传输层服务访问点（TSAP），而端口号标识的是主机中的应用进程。

> 数据链路层的SAP是MAC地址；网络层的SAP是IP地址；传输层的SAP是端口。

- 传输层使用的是软件端口。

<table>
    <tr>
        <td width="10%">软件端口</td>
        <td width="90%">在协议栈层间的抽象的协议端口，应用层的各种协议进程与传输实体进行层间交互的一种地址</td>
    </tr>
    <tr>
        <td>硬件端口</td>
        <td>不同硬件设备进行交换的接口</td>
    </tr>
</table>

### 端口号

- 应用进程通过端口号进行标识，端口号长度为16bit，能够表示65536（2<sup>16</sup>）个不同的端口号。端口号只具有本地意义，即端口号只标识本计算机应用层中的各进程。
- 根据端口号范围可将端口分为两类：服务器端使用的端口号、客户端使用的端口号。

<table>
    <tr>
        <td width="20%" rowspan="2">服务器端使用的端口号</td>
        <td width="15%">熟知端口号</td>
        <td width="65%">数值为0~1023，IANA（互联网地址指派机构）把这些端口号指派给了TCP/IP最重要的一些应用程序，且所有用户都知晓</td>
    </tr>
    <tr>
    <td>登记端口号</td>
    <td>数值为1024~49151，供没有熟知端口号的应用程序使用，必须在IANA登记使用，避免重复</td>
    </tr>
    <tr>
        <td>客户端使用的端口号<br/>（短暂端口号、临时端口）</td>
        <td colspan="2">数值为49152~65535，仅在客户端进程运行时才动态地选择，通信结束后此类端口号就不复存在，以供其他客户进程使用</td>
    </tr>
</table>

### 套接字 Socket

- 套接字（Socket）：端口号拼接到IP地址即构成套接字Socket，在网络中采用发送方和接收方的套接字来识别端点，即套接字实际上是一个通信端口。套接字唯一地标识网络中的一台主机和其上的一个应用（进程）。

Socket = (IP地址: 端口号)

## 无连接服务与面向连接服务

<table>
    <tr>
        <td width="15%" rowspan="4">TCP<br/>面向连接的传输控制协议</td>
        <td width="85%">传输层向上提供的是一条全双工的可靠逻辑信道</td>
    </tr>
    <tr>
        <td>提供面向连接的服务，在传输数据之前必须先建立连接，数据传送结束后要释放连接。不提供广播或组播服务</td>
    </tr>
    <tr>
        <td>不可避免地增加了许多开销，使得协议数据单元的头部增大很多，还要占用许多的处理机资源</td>
    </tr>
    <tr>
        <td>适合可靠性更重要的场合，如FTP（文件传输协议）、HTTP（超文本传输协议）、TELNET（远程登录）</td>
    </tr>
    <tr>
        <td rowspan="4">UDP<br/>无连接的用户数据报协议</td>
        <td>无连接的非可靠传输层协议，向上提供的是一条不可靠的逻辑信道</td>
    </tr>
    <tr>
        <td>在IP之上仅提供两个附加服务：多路复用和对数据的错误检查</td>
    </tr>
    <tr>
        <td>IP知道怎样把分组投递给一台主机，但不知道怎样把它们投递给主机上的具体应用。UDP在传送数据之前不需要先建立连接，远程主机的传输层收到UDP报文后，不需要给出如何确认</td>
    </tr>
    <tr>
        <td>UDP比较简单，执行速度比较快、实时性好。主要应用于TFTP（小文件传送协议）、DNS、SNMP、RTP（实时传输协议）</td>
    </tr>
</table>

1. IP 数据报和UDP数据报的区别：IP数据报在网络层要经过路由的存储转发；而UDP数据报在传输层的端到端的逻辑信道中传输，封装成IP数据报在网络层传输时，UDP数据报的信息对路由是不可见的。
2. TCP 和网络层虚电路的区别：TCP报文段在传输层抽象的逻辑信道中传输，对路由器不可见；虚电路所经过的交换结点都必须保存虚电路状态信息。在网络层若采用虚电路方式，则无法提供无连接服务；而传输层采用TCP不影响网络层提供无连接服务。

# UDP协议
