# 冯·诺依曼体系

## 存储程序概念

- 存储程序概念：指令驱动\+存储，指令和数据都在存储器中。将事先编制好的程序和原始数据送入主存后才能执行，一旦程序启动，就无须操作人员的干预，计算机自动逐条执行指令直到程序执行结束。
1. 计算机硬件系统由运算器、存储器、控制器、输入设备、输出设备5大部件组成。
2. 指令和数据以同等地位存于存储器，按地址寻访。
3. 指令和数据均用二进制代码表示。指令由操作码（操作的类型）和地址码（操作数的地址）组成，在存储器中按顺序存放。
6. 以运算器为中心，IO设备与存储器之间的数据传送通过运算器完成。

## 硬件组成

<img src="../../pictures/Snipaste_2023-04-30_10-47-27.png" width="800"/> 

<img src="../../pictures/计算机组成原理-计算机组成.drawio.svg" width="800"/> 

- [主存储器](./Memory.md)

1. M（存储体）存放二进制信息，若干存储单元的集合构成存储体，地址码相同的多个存储元件构成一个存储单元，每个存储元件存放一个二进制位。存储字是存储单元可存放的一串二进制代码，存储字长是这串二进制代码的位数，1Byte或字节的偶数倍。
2. <span name="MAR">MAR（地址寄存器）</span>存放访存地址，用于寻址，经地址译码后找到所选的存储单元。MAR的位数对应存储单元的个数，其对应的应该是主存地址空间的大小，而不仅仅是主存储器的大小。
3. MDR（数据寄存器）暂存要从存储器中读/写的信息。MDR的位数和存储字长相等，对应于数据总线的宽度。
4. 时序控制逻辑用于产生存储器操作所需的各种时序信号。

> 现代计算机中，MDR、MAR、Cache都存在于CPU。

- 运算器

1. [ALU](./数据的表示.md)（算术逻辑单元，Arithmetic and Logical Unit）是运算器的核心，能进行多种算术运算和逻辑运算（包括移位操作）。
2. 运行器包含若干通用寄存器，用于暂存操作数和中间结果，必须具备ACC（累加器）、MQ（乘商寄存器）、X（操作数寄存器）。

- 控制器

1. PC（程序计数器）存放当前欲执行指令的地址，自动加1，与MAR之间有一条直接通路。
2. IR（指令寄存器）存放当前的指令，内容来自MDR。指令中的操作码OP（IR）送至CU，用于分析指令并发出各种微操作命令序列；而地址码Ad（IR）送至MAR，用于取操作数。
3. CU（控制单元）

### 指令执行过程

## 存储器设计思想

### 冯·诺依曼结构

<img src="../../pictures/Snipaste_2023-04-30_12-46-30.png" width="350"/>     

1. 指令和数据混合存储在同一个存储器中，指令地址和数据地址指向同一个存储的不同物理位置，指令和数据的宽度相同。
2. CPU和共享存储器间的信息交换，不能同时取指令和取操作数，且存储器的存取速度远低于CPU运算速度。

### 哈弗结构

<img src="../../pictures/Snipaste_2023-04-30_12-48-58.png" width="600"/> 

1. 指令存储在程序存储器（PM)，数据存储在数据存储器（DM）：指令和数据可以有不同的数据宽度。
2. 分离的程序总线和数据总线允许同时获取指令字和操作数而互不干扰：在一个机器周期内可以同时准备好指令和操作数，本条指令执行时可以预先读取下一条指令。

# 层次结构与软件

## 层次结构

<img src="../../pictures/Snipaste_2023-04-30_13-08-26.png" width="500"/> 

> 软件和硬件之间的界面是ISA（指令集体系结构），即软件可见部分，定义了一台计算机可以执行的所有指令的集合。

## 软件

1. 系统软件是一组保证计算机系统高效、正确运行的基础软件，通常作为系统资源提供给用户使用。主要包括操作系统（OS）、数据库管理系统（DBMS）、语言处理程序、分布式软件系统、网络软件系统、标准库程序、服务性程序等。

2. 应用软件是用户为解决某个应用领域中的各类问题而编制的程序。

- 软、硬件逻辑功能的等价性，某一功能既可以使用软件实现，也可以使用硬件实现。

## 语言与翻译

<table>
    <caption>三种级别的计算机语言</caption>
    <tr>
        <td width="10%">机器语言</td>
        <td width="90%">机器语言（二进制代码语言）是计算机唯一可以直接识别和执行的语言</td>
    </tr>
    <tr>
        <td>汇编语言</td>
        <td>汇编语言必须经过汇编程序（系统软件）的翻译，转换为机器语言后，才能在计算机的硬件系统上执行</td>
    </tr>
    <tr>
        <td>高级语言</td>
        <td>高级语言需要经过编译程序翻译成汇编语言程序，再经过汇编操作得到机器语言程序，或直接由高级语言程序转换为机器语言程序</td>
    </tr>
</table>

<table>
    <caption>翻译程序</caption>
    <tr>
        <td width="20%">汇编程序（汇编器）</td>
        <td width="80%">将汇编语言转换为机器语言程序</td>
    </tr>
    <tr>
        <td>解释程序（解释器）</td>
        <td>将源程序中的语言按执行顺序逐条翻译为机器指令并直接执行，翻译一句执行一句，不会生成目标程序</td>
    </tr>
    <tr>
        <td>编译程序（编译器）</td>
        <td>将高级语言程序翻译成编译语言或机器语言程序，将高级语言程序一次全部编译成目标程序</td>
    </tr>
</table>

# 性能指标

- 基准程序（Benchmarks）是专门用于性能评价的一组程序，但程序员可以专门优化某段代码来影响基准程序的评测结果。

## 机器字长

<table>
    <tr>
        <td width="18%" rowspan="3">机器字长（字长）</td>
        <td width="82%">机器字长（字长）是计算机进行一次整数（定点整数）运算所能处理的二进制数据的位数（CPU内部用于整数运算的数据通路的宽度），字长一般等于CPU内部用于整数运算的运算器位数和通用寄存器宽度。</td>
    </tr>
    <tr>
        <td>字长越长，数的表示范围越大，计算机精度越高。</td>
    </tr>
    <tr>
        <td>某16位机器、32位机器，其中的16位、32位指的是字长。</td>
    </tr>
    <tr>
        <td rowspan="2">指令字长</td>
        <td>指令字长是一个指令字中包含的二进制代码的位数，一般是存储字长的整数倍。若指令字长等于存储字长的2倍（也就是，一条指令需要两个存储字才能完全装载），则需要2个访存周期（从内存中读出指令的实际时间）来取出一条指令。 </td>
    </tr>
    <tr>
        <td>取指周期是处理器从内存中取出一条指令所需的时间，不仅包括访存周期，还包括解码、预处理等一系列其他操作所需要的时间。机器周期与取指周期的关系取决于处理器的具体实现。</td>
    </tr>
    <tr>
        <td>存储字长</td>
        <td>存储字长是一个存储单元存储的二进制代码的长度，必须是字节的整数倍。</td>
    </tr>
</table>

- 字表示被处理信息的单位，衡量数据类型的宽度。

- 字节（Byte）：1 PB = 1024 TB 、1 TB = 1024 GB 、1 GB = 1024 MB 、1 MB = 1024 KB 、1 KB = 1024 B 、1 B = 8 bit。

## 数据通路宽度

- 数据通路宽度是（外部）数据总线一次所能并行传送信息的位数。
- 数据通路是各个子系统通过数据总线连接形成的数据传送路径，不同于CPU内部的数据总线宽度（内部寄存器的大小）。

## 存储容量

- 存储器容量分为主存容量和辅存容量。
- 主存容量是主存中存放二进制代码的总位数（最大容量），通常以字节衡量、或以字数\*字长（512K\*16位）表示。<a href="#MAR" >MAR位数反映存储单元的个数，MDR的位数反映存储单元的字长。</a>

<img src="../../pictures/20231030222326.png" width="500"/> 

- 字节编址：以字节数表示存储容量。

## 运算速度

### 吞吐量和响应时间

- 吞吐量是系统单位时间内处理请求的数量，主要取决于[主存的存取周期](./Memory.md)。
- 响应时间是系统对（用户发出的）请求做出响应的时间，响应时间=CPU时间\+等待时间。

### CPU执行时间

<table>
    <tr>
        <td width="20%">主频</br/>（CPU时钟频率）</td>
        <td width="80%">主频是在CPU内数字脉冲信号振荡的速度，机器内部主时钟的频率（Hz）（1Hz即每秒一次）</td>
    </tr>
    <tr>
        <td rowspan="2">CPU时钟周期</td>
        <td>CPU时钟周期是CPU主频的倒数，通常为节拍脉冲、T周期，是CPU中最小的时间元素，执行指令的每个动作至少需要一个时钟周期</td>
    </tr>
    <tr>
        <td>CPU时钟周期 = 1 / 主频</td>
    </tr>
    <tr>
        <td rowspan="2">CPI<br/>Cycle Per Instruction</td>
        <td>CPI是执行一条指令所用的时钟周期数。不同指令的时钟周期数可能不同，此时，CPI是该程序或机器指令集中的所有指令执行所需的平均时钟周期数</td>
    </tr>
<tr>
    <td>IPC是每个时钟周期执行的指令数，IPC = 1 / CPI</td>
</tr>
</table>

- CPU执行时间是运行一个程序所花费的时间，取决于主频、CPI、指令条数。CPU执行时间、主频、指令条数相互制约。

<img src="../../pictures/20231030222528.png" width="400"/> 

### MIPS

- MIPS（Million Instructions Per Second），每秒执行多少百万条指令。MIPS = 指令条数 / (执行时间 \* 10<sup>6</sup>) = 主频 / (CPI \* 10<sup>6</sup>)

- MFLOPS，每秒执行多少百万次浮点运算。
