# 计算机网络概述

## 计算机网络的概念

- 计算机网络是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统。即一些互连的、自治的计算机系统的集合。

1. 目的，资源共享。
2. 组成单元，分布在不同地理位置的多台独立的自治计算机。
   1. 网络中的计算机必须遵循的统一规则，网络协议。


## 计算机网络的组成

- 组成部分，一个完整的计算机网络主要由硬件、软件、协议三大部分组成。

1. 硬件主要由主机（端系统）、网络通信链路（双绞线、光纤）、交换设备（路由器、交换机）、通信处理机（网卡）等组成。
2. 软件主要包括各种实现资源共享的软件和方便用户使用的各种工具软件（网络操作系统、邮件收发程序、FTP程序、聊天程序等）。
3. 协议是计算机网络的核心，规定了网络传输数据时所遵循的规范。

- 主机包括用户终端设备与服务器，是资源子网的主要组成单元，通过高速通信线路与通信子网的通信控制处理机相连接。普通用户终端通过主机连入网络。主机要为本地用户服务网络其他主机设备与资源提供服务，同时要为网络中远程用户共享本地资源提供服务。终端是用户访问网络的界面。

- 工作方式，Internet（因特网）分为边缘部分和核心部分。

1. 边缘部分由所有连接到因特网上、供用户使用的主机组成，用来进行通信和资源共享。
2. 核心部分由大量的网络和连接到这些网络的路由器组成，为边缘部分提供连通性和交换服务。

<img src="../../pictures/计算机网络-核心部分和边缘部分.drawio.svg" width="400"/> 

- 功能组成，计算机网络由通信子网和资源子网组成。

1. 通信子网由各种传输介质、通信设备和相应的网络协议组成，包括物理层（集线器）、数据链路层（交换机）、网络层（路由器），使网络具有数据传输、交换、控制和存储的能力，实现联网计算机之间的数据通信。
2. 资源子网是实现资源共享功能的设备及其软件的集合，向网络用户提供分享其他计算机上硬件资源、软件资源和数据资源的服务。负责全网的数据处理业务，向网络用户提供各种的网络资源与网络服务。

- 通信控制处理机在网络拓扑中被称为网络结点。（1）作为与资源子网的主机、终端的连接接口，将主机和终端连入网络。（2）作为通信子网中的分组存储转发结点，完成分组的接收、校验、存储、转发等功能，实现将源主机报文发送到目的主机的作用。
- 通信线路为通信控制处理机与通信控制处理机、通信控制处理机与主机之间提供通信信道。例如：电话线、双绞线、同轴电缆、光纤、无线通信信道、微波与卫星通信信道等

### Internet系统

1. 用户计算机可以通过局域网方式接入，或电话线交换网（PSTN）、有线电视网（CATV）、无线城域网（WMAN）、无线局域网（WLAN）方式接入到作为地区级的城域网。
2. 城域网通过路由器和光纤接入到作为国家级或区域主干网的广域网。
3. 多个广域网互联形成不断变化的Internet网络系统。

## 计算机网络的功能

1. 数据通信。计算机网络最基本和最重要的功能。
2. 资源共享。
3. 分布式处理。
4. 提高可靠性。
5. 负载均衡。

## 计算机网络的分类

### 覆盖范围

| 类型              | 覆盖范围           | 说明                                   |
| ----------------- | ------------------ | -------------------------------------- |
| WAN（广域网）     | 几十千米至几千千米 | 基于广播技术发展，通常采用网状拓扑结构 |
| MAN（城域网）     | 5\~50km            |                                        |
| LAN（局域网）     | 几十米至几千米     | 基于交换技术发展                       |
| PAN（个人局域网） | 10m                |                                        |

> 若中央处理器之间的距离非常近，仅1m或更小的数量级，一般称为多处理器系统，而不是计算机网络。

### 传输技术

1. 广播式网络。该网络中的所有联网计算机共享一个公共通信信道，一台计算机通过共享通信信道发送报文时，所有其他计算机都会收到该分组。
2. 点对点网络（P2P）。每条物理线路连接一对计算机。

### 拓扑结构

- 网络拓扑结构是由网中结点（路由器、主机等）与通信线路（网线）之间的几何关系表示的网络结构，计算机网络拓扑结构主要取决于通信子网。

<img src="../../pictures/计算机网络-网络拓扑结构.drawio.svg" width="1000"/>

| 网络拓扑 | 说明                                         | 特点                                                         |
| -------- | -------------------------------------------- | ------------------------------------------------------------ |
| 总线形   | 单根传输线将计算机连接                       | 建网容易，增/减结点方便，节省线路<br />重负载时通信效率低，总线任意一处对故障敏感 |
| 星形     | 每个终端以独立的线路与中央设备（主机或）相连 | 便于集中控制和管理，端用户之间的通信必须经过中央设备<br />成本高、中央设备对故障敏感 |
| 环形     | 所有计算机接口设备连接成一个环               | 令牌环网，环中信号是单向传输的                               |
| 网状     | 一般，每个结点至少有两条路径和其他接口相连   | 可靠性高，控制复杂，线路成本高                               |

- 以上各种网络拓扑结构可以互连。

### 交换技术

- 按[交换技术](./PhysicalLayer.md>)分为电路交换网络、报文交换网络、分组交换网络。

## 计算机网络的性能指标

- 带宽（Bandwidth，最高数据传输速率）在计算机网络中，表示网络的通信线路所能传送数据的能力（bit/s）。
- 速率（Speed，数据传输速率、数据率、比特率），连接计算机网络上的主机在数字通道上传送数据的速率（bit/s），最高数据传输速率也就是带宽。

- 时延（Delay）= 发送时延 + 传播时延 + 处理时延 + 排队时延，指数据从网络的一端传送到另一端所需的总时间。

<img src="../../pictures/计算机网络-时延delay.drawio.svg" width="500"/> 

1. 发送时延（传输时延） = 分组长度 / 信道宽度，结点将分组的所有比特推向传输链路所需的时间，即从发送分组的第一个比特计算，到该分组的最后一个比特发送完毕所需的时间。

>对于高速链路，仅只是提高数据发生速率，减少发送时延，而不是提高数据在信道上的传播速率，更没有减少传播时延。

2. 传播时延 = 信道长度 / 电磁波在该信道上的传播速率，电磁波在信道中传播一定的距离所需的时间，即一个比特从链路的一端传播到另一端所需的时间。
3. 处理时延，数据在交换结点中为存储转发而进行的一些必要的处理所需要的时间。
4. 排队时延，分组在进入路由器之后，要先在输入队列中排队等待处理；路由器确定转发端口后，要在输出队列中排队等待转发。

> 处理时延和排队时延一般忽略不计。

- 时延带宽积（以比特为单位的链路长度）= 传播时延 x 信道带宽，指发送端发送的第一个比特即将到达站点时，发送端已经发出了多少个比特。
- RTT（往返时延，Round-Trip Time），指从发送端发出一个短分组，到发送端收到来自接收端的确认，总共经历的时延。 

- 吞吐量（Throughput）指单位时间内通过某个网络（信道、接口）的数据量，吞吐量受网络带宽和网络额定速率的限制。

- 信道利用率 = 有效数据通过时间 / (有效数据通过时间 + 空闲时间)，指出某一信道有百分之几的时间是有数据通过的。

<details>
    <summary>
        在下列情况，计算传送1000KB文件所需要的总时间t（从开始传送时起直到文件的最后一位到达目的地为止）。假定RTT为100ms，一个分组是1KB的数据，在开始传送整个文件之前进行的起始握手过程需要2RTT的时间，只有一段链路。<br/>
        （1）带宽为1.5Mb/s，数据可连续发送。<br>
        （2）带宽为1.5Mb/s，但每发送完一个数据分组后，必须等待一个RTT（等待接收方的确认）才能发送下一数据分组。<br/>
        （3）假定带宽无限大（发送时延为0），并在等待每条RTT之后可以发送最多20个分组。
    </summary>
    此题，传播时延 = RTT / 2，最后一组数据分组不需要等待确认，只需要RTT/2<br/>
    （1）t = 起始握手时间 + 传播时延 + 发送时延 = 2RTT + RTT/2 + 1000KB / 1.5Mb/s<br/>
    （2）t = 起始握手时间 + 传播时延 + 发送时延 + 等待确认时间 = 2RTT + RTT/2 + 1000KB / 1.5Mb/s + (⌈1000KB / 1KB⌉ - 1)RTT<br/>
    （3）t = 起始握手时间 + 传播时延 + 等待确认时间 = 2RTT + RTT/2 + (⌈(1000KB / 1KB / 20)⌉ - 1)RTT<br/>
    <img src="../../pictures/计算机网络-RTT.drawio.svg" width="400"/>
</details>

# 计算机网络分层结构

## 分层的基本原则

- 网络的体系结构（Architecture）是计算机网络各层及其协议的集合。

- 分层的基本原则

1. 每层都实现一种相对独立的功能，降低大系统的复杂度。
2. 各层之间界面自然清晰、易于理解，相互交流尽可能少。
3. 各层功能的精确定义独立于具体的实现方法，采用最合适的技术来实现。
4. 保持下层对上层的独立性，上层单向使用下层提供的服务。
5. 整个分层结构应能促进标准化工作。

- 实体是任何可发送或接收信息的硬件或软件进程，第n层的活动元素通常称为第n层实体。对等层是不同机器上的同一层，而对等实体是同一层的实体。第n层（服务提供者）的实体实现的服务被第n+1层（服务使用者）使用。

- 每个报文都分为两部分，SDU（数据部分）、PCI（控制信息部分），共同构成PDU（协议数据单元）。

| 组成部分            | 说明                                                         |
| ------------------- | ------------------------------------------------------------ |
| SDU（服务数据单元） | n-SDU，为完成用户所要求的功能而应传送的数据                  |
| PCI（协议控制信息） | n-PCI，控制协议操作的信息                                    |
| PDU（协议数据单元） | n-PDU，对等层之间传送的数据单元为该层的PDU，每层的PDU有各自的名称<br />比特（物理层）、帧（数据链路层）、分组（网络层）、报文段（传输层） |

- 在各层传输数据时，把从第n+1层收到的PDU作为第n层的SDU，并加上第n层的PCI，作为第n层的PDU，依次类推，接收方接受时，则相反处理。

1. 第n层的实体不仅要使用第n-1层的服务来实现自身定义的功能，还要向第n+1层提供本层的服务，该服务是第n层及其下面各层提供的服务总和。
2. 最低层只提供服务，是整个层次结构的基础；中间各层既是下一层的服务使用者，又是上一层的服务提供者；最高层面向用户提供服务。
3. 上一层只能通过相邻层的接口使用下一层的服务，而不能调用其他层的服务；下一层所提供服务的实现细节对上一层透明。
4. 不同主机通信时，对等层在逻辑上有一条直接信道。

<img src="../../pictures/计算机网络-n-PDU.drawio.svg" width="1000"/> 

## 协议、接口、服务

1. 协议（Protocol）由语法、语义、同步组成。语法规定传输数据的格式；语义规定所要完成的功能；同步规定执行各个操作的条件和时序等。协议是水平的，是控制对等实体进行通信的规则的集合，不对等实体之间没有协议。
2. 接口是同一阶段内相邻两层间交换信息的连接点，每层只能为紧邻的层次之间定义接口，不能跨层定义接口。同一结点相邻两层的实体通过SAP（服务访问点，Service Access Point）进行交互，每个SAP都有唯一标识的地址。
3. 服务是下层为紧邻的上层提供的功能调用，是垂直的。对等实体在协议的控制下，使得本层能够向上一层提供服务，但实现本层的协议需要使用下一层提供的服务（只有对上层不透明的才能是服务）。服务原语是上层使用下层提供的服务时，必须与下层交互的命令，分为请求（Request）、指示（Indication）、响应（Responce）、证实（Confirmation），对于无应答服务只有请求和指示。

<img src="../../pictures/计算机网络-protocol-interface-service.drawio.svg" width="600"/> 

## OSI参考模型、TCP/IP模型

<img src="../../pictures/计算机网络-OSI-TCPIP.drawio.svg" width="1000"/> 

<img src="../../pictures/计算机网络-n-PDU.drawio.svg" width="1000"/> 

- OSI/RM（开放系统互连参考模型）是由ISO（国际标志化组织）提出的网络体系结构模型。
- TCP/IP是APRA提出的，得到广泛应用的事实上的国际标准。

1. OSI参考模型定义了三个主要的概念，服务、协议、接口；而TCP/IP模型没有区分这三个概念。
2. OSI参考模型产生于协议发明之前，通用性良好，但对于功能应该位于哪一层有些混乱；TCP/IP模型实际上是对已有协议的描述，但不适合于任何非TCP/IP的其他协议栈。
3. OSI参考模型最初只考虑一种标准的公用网络将不同的系统互连，最终只能在网络层划分出一个子层来完成类似TCP/IP模型中IP的功能；TCP/IP模型将网际协议（IP）作为单独的重要层次，考虑了多种异构网的互连问题。
4. OSI参考模型在网络层支持无连接和面向连接的通信，而在传输层仅支持面向连接的通信；TCP/IP模型认为可靠性是端到端的问题，在网际层仅支持无连接的通信模式，而在传输层支持无连接和面向连接的通信模式。

### OSI参考模型

#### 物理层 Physical Layer

- 物理层的传输单元是比特（bit），在物理媒体上为数据端设备透明地传输原始比特流。
- 物理层协议（物理层接口标准、物理层规程）主要定义数据终端设备（DTE）和数据通信设备（DCE）的物理与逻辑连接方法，EIA-232C、EIA/TIA RS-449、CCITT的X.21等。

1. 规定通信链路与通信结点连接需要的一些电路接口的一些参数，机械形状和尺寸、交换电路的数量和排列等
2. 规定通信链路上传输的信号的意义和电气特征。

- 物理媒体（双绞线、光缆、无线信道等）并不在物理层协议之内，而是在物理层协议下面，即第0层。

#### 数据链路层 Data Link Layer

- 数据链路层的传输单元是帧（frame）。

1. 成帧，将网络层传来的IP数据报组装成帧。
2. 差错控制，检测错误信息并丢弃。
3. 流量控制，协调两个结点的数据传输速率，使发送速率和接收速率均衡。
4. 传输管理，处理信号通过介质的传输。
5. 物理寻址。

- 数据链路层协议包括SDLC、HDLC、PPP、STP、帧中继（FR）等。

#### 网络层 Network Layer

- 网络层的传输单元是数据报，关心通信子网的运行控制，将网络层的协议数据单元（分组）从源端传到目的端，为分组交换网上的不同主机提供通信服务。对分组进行路由选择，并实现流量控制、拥塞控制、差错控制、网际互连等功能。

1. 路由选择，根据网络情况，利用路由算法为数据报选择合适的路由。
2. 流量控制，同数据链路层。
3. 差错控制，通信结点之间约定的特定检错规则（奇偶检验码等），接收方根据该规则检查收到的分组是否出现差错，若出现差错，则进行纠错，不能纠错就丢弃，确保向上提交的数据正确无误。
4. 拥塞控制，缓解网络拥塞。

- 网络层协议包括IP、IPX、ICMP、IGMP、ARP、RARP、OSPF等。

#### 传输层 Transport Layer

- 传输层（运输层）的传输单元是报文段（TCP）或用户数据报（UDP），负责两个进程之间的通信。为端到端连接提供流量控制、差错控制、服务质量、数据传输管理等服务。
- 数据链路层提供点到点的通信；而传输层提供端到端的通信。

1. 复用和分用的功能，复用是多个应用层进程可同时使用传输层的服务；分用是传输层把收到的信息分别交付到上面应用层中相应的进程。

- 传输层协议包括TCP、UDP。

#### 会话层 Session Layer

1. 建立同步（SYN），会话层允许不同主机上的各种进程之间进行会话，利用传输层提供的端到端的服务，为表示层实体或用户进程建立连接并在连接上有序地传输数据（会话）。

2. 通信恢复，会话层负责管理主机间的会话进程，包括建立、管理及终止进程间的会话，可以使用校验点使通信会话在通信失效时从校验点恢复通信，实现数据同步。

#### 表示层 Presentation Layer

- 表示层主要处理两个通信相同中交换信息的表示方式。

> 不同机器采用的编码和表示方法不同，使用的数据结构也不同。

- 表示层提供数据表现交换功能，表示层使用抽象的标准方法定义数据结构，并采用标准的编码形式，使不同表示方法的数据和信息之间能互相交换，包括数据压缩、加密和解密。

#### 应用层 Application Layer

- 应用层时OIS参考模型的最高层，是用户与网络的界面，提供用户与网络的接口。应用层为特定类型的网络应用提供访问OSI参考模型环境的手段，是最复杂的一层，使用的协议也最多。

- 应用层协议包括FTP、SMTP、HTTP等。

### TCP/IP模型

#### 网络接口层 Network Access Layer

- 网络接口层的功能类似于OSI参考模型的物理层和数据链路层，表示物理网络的接口，从主机或结点接收IP分组，并发送到指定的物理网络。TCP/IP本身并未真正描述该部分，只是指出主机必须使用某种协议与网络连接，以便在其上传递IP分组。具体的物理网络可以是（1）各种类型的局域网（以太网、令牌环网、令牌总线网等）；（2）电话网、SDH、X.25、帧中继、ATM等公共数据网络。

#### 网际层 Internet Layer

- 网际层（点到点，主机-主机）是TCP/IP模型的关键部分，将分组发往任何网络，并为之独立地选择合适的路由，但不保证各个分组有序到达，由高层负责各个分组的有序交付。
- 网际层定义了标准的分组格式和协议，即IP（IPv4和IPv6）。everthing over IP，TCP/IP可以为各种应用提供服务；IP over everything，TCP/IP允许IP协议在各种网络构成的互联网上运行。

#### 传输层 Transport Layer

- 传输层（端到端，进程-进程）类似OSI参考模型的传输层。

1. TCP（传输控制协议，Transmission Control Protocol）是面向连接的，提供可靠的交付，数据传输的单元是报文段。
2. UDP（用户数据报协议，User Datagram Protocol）是无连接的，尽最大努力交付（Best-Effort-Delivery），数据传输的单元是用户数据报。

> 选择TCP还是UDP，取决于具体的情况，若网络环境恶劣，需要可靠的交互，则选择TCP；若网络环境优良，则可以选择UDP。

#### 应用层 Application Layer

- 应用层（用户到用户）包含所有的高层协议，Telnet、FTP、DNS、SMTP、HTTP等。