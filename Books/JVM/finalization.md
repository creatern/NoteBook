- 对象终止机制（finalization）：对象被销毁之前的自定义处理逻辑。
- Object\#finalize()：垃圾回收时，由垃圾回收器在对象上调用，只会被调用一次。

1. 可能导致对象的复活。
2. 执行时间没有保障，完全由GC线程决定，低优先级的Finalizer线程。

```java
protected void finalize() throws Throwable { }
```

- JVM中的对象一般处于3种可能的状态，只有在不可触及状态下才可以被回收。

| 状态     | 说明                                                       |
| -------- | ---------------------------------------------------------- |
| 可触及   | 从根节点开始，可以到达该对象。                             |
| 可复活   | 对象的所有引用都被释放，但该对象可能在finalize()复活。     |
| 不可触及 | 对象的finalize()被调用，且该对象没有复活。（不可能被复活） |

- 判断一个对象是否可回收，至少经过两次标记过程：

1. 如果该对象到GC Roots没有引用链，则进行第一次标记。
2. 筛选，判断该对象是否有必要执行finalize()：
   1. 如果该对象没有重写finalize()、或finalize()已经被JVM调用过，则没有必要执行，该对象被判断为不可触及。
   2. 如果该对象重写了finalize()、且还未被JVM调用过，则将该对象插入到F\-Queue队列，由一个JVM自动创建的、低优先级的Finalizer线程触发执行。
   3. finalize()是对象逃脱死亡的最后机会，之后GC会对F\-Queue中的对象进行第二次标记。如果该对象在finalize()中与引用链上的任何一个对象建立了联系，则第二次标记时，该对象被移出“即将回收”集合。否则被判断为不可触及。
   4. 之后，如果该对象再次出现没有引用存在的情况，则finalize()不会被调用，直接判断为不可触及。

<img src="../../pictures/JVM-finalize执行判断.svg" width="600"/> 