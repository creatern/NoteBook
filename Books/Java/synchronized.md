# synchronized概述

- synchronized块是Java提供的一种原子性内置锁（监视器锁），Java中的每个对象都可以把它当作一个同步锁来使用。

1. 内置锁是<b>排他锁、独占锁</b>（mutual-exclusion），当一个线程获取了该锁后，其他线程必须等待该线程释放锁后才能获取该锁。
   1. 线程的执行代码在进入synchronized块前会自动获取内部锁，此时其他访问该同步代码块的线程会被阻塞挂起。
   2. 得到内部锁的线程会在正常退出同步代码块、或抛出异常后、或在同步块内调用了该内置锁资源的wait系列方法时，释放该内置锁。
2. synchronized的使用会导致上下文切换，带来线程调度开销（很耗时）。因为Java的线程和操作系统中的原生线程是一一对应的，所以当阻塞一个线程时，需要从用户态切换到内核态来执行阻塞操作。
3. sychronized的内存语义（加锁和释放锁），解决了共享变量内存可见性问题。
   1. 把在synchronized块内使用到的变量从线程的工作内存中清除，使得sychronized块使用的变量必须直接从主内存获取。也就是，获取锁之后，会清空锁块内本地内存中将会被用到的共享变量，只有在使用这些共享变量时才会从主内存中获取。
   2. 在退出sychronized块时，把在sychronized块内对共享变量的修改刷新到主内存。也就是，释放锁时，将本地内存中修改的共享变量刷新到主内存。

# 同步与监视器

1. 同步方法，当synchronized作为方法的修饰符时，被修饰的方法处于锁保护状态：
   1. 实例方法的监视器是对象；而静态方法的监视器是类。
   2. 被synchronized修饰的方法不能被子类继承。
2. 同步块，可以实现比同步方法更细粒度的控制：
   1. 同步块只针对某一块代码进行同步控制。
   2. 同步块需要指出监视器。

```java
synchronized(监视器锁) { ... }
```

- 同步方法和同步块都使用JVM内置的监视器，

