# rpm RPM包

<img src="../../../pictures/Snipaste_2022-11-30_19-47-03.png" width="700"/> 

**常用**

| 组合                            | 说明                                                       |
| :------------------------------ | :--------------------------------------------------------- |
| rpm -ivh RPM包                  | 安装时显示信息                                             |
| rpm -ivh --force RPM包          | 强制安装                                                   |
| rpm -ivh --nodeps --force RPM包 | 无视依赖，强制安装                                         |
| rpm -qpl RPM包                  | 查看软件包的详细信息                                       |
| rpm -Uvh RPM包                  | 更新已安装的软件包                                         |
| rpm -qa                         | 查看已安装的软件包                                         |
| rpm -e                          | 卸载软件包，如果存在依赖关系，需要先卸载需要其依赖的软件包 |
| rpm -qf                         | 查看文件所属软件包                                         |
| rpm -qip                        | 获取说明信息                                               |

```shell
# 1.挂载光盘
[root@bogon Packages]# mkdir -p /cdrom
[root@bogon Packages]# mount -t iso9660 /dev/cdrom /cdrom

# 2.安装 需要依赖关系时
[root@bogon Packages]# rpm -ivh glibc-devel-2.17-196.el7.x86_64.rpm
warning: glibc-devel-2.17-196.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
error: Failed dependencies:
        glibc-headers is needed by glibc-devel-2.17-196.el7.x86_64
        glibc-headers = 2.17-196.el7 is needed by glibc-devel-2.17-196.el7.x86_64
[root@bogon Packages]# rpm -ivh glibc-devel-2.17-196.el7.x86_64.rpm glibc-headers-2.17-196.e17.x86_64.rpm

# 3.先安装依赖关系
[root@bogon Packages]# rpm -ivh glibc-headers-2.17-196.el7.x86_64.rpm
warning: glibc-headers-2.17-196.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
error: Failed dependencies:
        kernel-headers is needed by glibc-headers-2.17-196.el7.x86_64
        kernel-headers >= 2.2.1 is needed by glibc-headers-2.17-196.el7.x86_64
[root@bogon Packages]# rpm -ivh kernel-headers-3.10.0-693.el7.x86_64.rpm
warning: kernel-headers-3.10.0-693.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:kernel-headers-3.10.0-693.el7    ################################# [100%]
[root@bogon Packages]# rpm -ivh kernel-headers-3.10.0-693.el7.x86_64.rpm
warning: kernel-headers-3.10.0-693.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:kernel-headers-3.10.0-693.el7    ################################# [100%]
[root@bogon Packages]# rpm -ivh glibc-headers-2.17-196.el7.x86_64.rpm
warning: glibc-headers-2.17-196.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:glibc-headers-2.17-196.el7       ################################# [100%]
[root@bogon Packages]# rpm -ivh glibc-devel-2.17-196.el7.x86_64.rpm
warning: glibc-devel-2.17-196.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:glibc-devel-2.17-196.el7         ################################# [100%]
# 4.检查
```

```shell
[root@bogon Packages]# rpm -ivh ftp-0.17-67.el7.x86_64.rpm
warning: ftp-0.17-67.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:ftp-0.17-67.el7                  ################################# [100%]
[root@bogon Packages]# rpm -ivh --force ftp-0.17-67.el7.x86_64.rpm
warning: ftp-0.17-67.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:ftp-0.17-67.el7                  ################################# [100%]
[root@bogon Packages]# rpm -ivh --nodeps --force ftp-0.17-67.el7.x86_64.rpm
warning: ftp-0.17-67.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:ftp-0.17-67.el7                  ################################# [100%]
[root@bogon Packages]# rpm -Uvh ftp-0.17-67.el7.x86_64.rpm
warning: ftp-0.17-67.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
```

```shell
[root@bogon Packages]# rpm -e glibc-headers
error: Failed dependencies:
        glibc-headers = 2.17-196.el7 is needed by (installed) glibc-devel-2.17-196.el7.x86_64
```

```shell
[root@bogon Packages]# rpm -qip glibc-devel-2.17-196.el7.x86_64.rpm
warning: glibc-devel-2.17-196.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Name        : glibc-devel
Version     : 2.17
Release     : 196.el7
Architecture: x86_64
Install Date: (not installed)
Group       : Development/Libraries
Size        : 1066324
License     : LGPLv2+ and LGPLv2+ with exceptions and GPLv2+
Signature   : RSA/SHA256, Sat 17 Jun 2017 03:48:44 AM CST, Key ID 199e2f91fd431d51
Source RPM  : glibc-2.17-196.el7.src.rpm
Build Date  : Sat 17 Jun 2017 12:59:25 AM CST
Build Host  : x86-017.build.eng.bos.redhat.com
Relocations : (not relocatable)
Packager    : Red Hat, Inc. <http://bugzilla.redhat.com/bugzilla>
Vendor      : Red Hat, Inc.
URL         : http://www.gnu.org/software/glibc/
Summary     : Object files for development using standard C libraries.
Description :
The glibc-devel package contains the object files necessary
for developing programs which use the standard C libraries (which are
used by nearly all programs).  If you are developing programs which
will use the standard C libraries, your system needs to have these
standard object files available in order to create the
executables.

Install glibc-devel if you are going to develop programs which will
use the standard C libraries.
```

## 需要的依赖问题

```shell
[root@localhost Packages]# rpm -ivh unbound-1.4.20-34.el7.x86_64.rpm
warning: unbound-1.4.20-34.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
error: Failed dependencies:
        libunbound.so.2()(64bit) is needed by unbound-1.4.20-34.el7.x86_64
        # 需要unbound库的2个64位的rpm包
        # lib库名.so.需要的包的数量()(位数x86_64或.i686)
        unbound-libs(x86-64) = 1.4.20-34.el7 is needed by unbound-1.4.20-34.el7.x86_64
        # 需要unbound-libs(x86-64)包
```

# 源码包

- Linux 系统中用于保存源代码的位置主要有 2 个，分别是 "/usr/src" 和 "/usr/local/src"，其中 "/usr/src" 用来保存内核源代码，"/usr/local/src" 用来保存用户下载的源代码。

**流程**

1. 下载源码包
2. tar 解压缩 
3. cd 进入解压目录
4. ./configure 软件配置与检查 
5. make 编译
6. make install 正式开始安装软件 

## 安装

### ./configure

- configure 是源码包软件自带的一个脚本程序，必须采用 ./configure 方式执行。
- configure 通过系统环境的检测结果和定义好的功能选项生成编译规则文件 Makefile ，后续的编译和安装需要依赖这个文件的内容。

**常用**

| 命令                          | 说明             |
| :---------------------------- | :--------------- |
| ./configure --prefix=安装路径 | 指定安装路径。   |
| ./configure --help            | 查询其支持的功能 |

### make 

- make根据Makefile文件生成目标文件，如二级制程序等。

### make install

## 测试

### vim源码安装

**1.检查并卸载vim**

```shell
[root@localhost ~]# vim --version
     
[root@localhost ~]# which vim
/usr/bin/vim
[root@localhost ~]# rpm -qf /usr/bin/vim
vim-enhanced-7.4.160-2.el7.x86_64
[root@localhost ~]# rpm -e vim-enhanced
[root@bogon ~]# which vim
/usr/bin/which: no vim in (/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin)
```

**2. 使用wget工具下载Vim http://www.vim.org**

- vim下载查看地址：`http://ftp.vim.org/pub/vim/unix/`
- vim9.0 ftp: `ftp://ftp.vim.org/pub/vim/unix/vim-9.0.tar.bz2`

- 先到安装目录下

```shell
[root@localhost ~]# mkdir soft
[root@localhost ~]# cd ./soft
[root@bogon soft]# wget ftp://ftp.vim.org/pub/vim/unix/vim-7.4.tar.bz2
```

**3. 解压缩**

```shell
[root@localhost soft]# ll
[root@localhost soft]# tar xvf vim-7.4.tar.bz2
```

**4. ./configure**

- 需要进入软件安装目录内部

```shell
[root@localhost soft]# cd vi74
[root@localhost vim74]# ./configure
configure: creating cache auto/config.cache
checking whether make sets $(MAKE)... yes
checking for gcc... no
checking for cc... no
checking for cl.exe... no
configure: error: in `/root/soft/vim74/src':
configure: error: no acceptable C compiler found in $PATH
See `config.log' for more details.
```

- 进行补充，gcc等配置

```shell
[root@localhost Packages]# ll | grep gcc
-r--r--r--.  953 root root 10529884 Apr  1  2014 compat-gcc-44-4.4.7-8.el7.x86_64.rpm
-r--r--r--.  953 root root  6636564 Apr  1  2014 compat-gcc-44-c++-4.4.7-8.el7.x86_64.rpm
-r--r--r--.  203 root root 16957744 Jun  6  2017 gcc-4.8.5-16.el7.x86_64.rpm
-r--r--r--.  203 root root  7525624 Jun  6  2017 gcc-c++-4.8.5-16.el7.x86_64.rpm
-r--r--r--.  203 root root  6977048 Jun  6  2017 gcc-gfortran-4.8.5-16.el7.x86_64.rpm
-r--r--r--.  203 root root 13562880 Jun  6  2017 gcc-gnat-4.8.5-16.el7.x86_64.rpm
-r--r--r--.  203 root root  6020924 Jun  6  2017 gcc-objc-4.8.5-16.el7.x86_64.rpm
-r--r--r--.  203 root root  6444876 Jun  6  2017 gcc-objc++-4.8.5-16.el7.x86_64.rpm
-r--r--r--.  203 root root   108440 Jun  6  2017 libgcc-4.8.5-16.el7.i686.rpm
-r--r--r--.  212 root root   100552 Jun  6  2017 libgcc-4.8.5-16.el7.x86_64.rpm
[root@localhost Packages]# rpm -ivh gcc-4.8.5-16.el7.x86_64.rpm
warning: gcc-4.8.5-16.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
error: Failed dependencies:
        cpp = 4.8.5-16.el7 is needed by gcc-4.8.5-16.el7.x86_64
        libmpc.so.3()(64bit) is needed by gcc-4.8.5-16.el7.x86_64
[root@localhost Packages]# ll | grep cpp
-r--r--r--.  271 root root   195708 May 30  2017 abrt-addon-ccpp-2.1.11-48.el7.x86_64.rpm
-r--r--r--.  203 root root  6230984 Jun  6  2017 cpp-4.8.5-16.el7.x86_64.rpm
[root@localhost Packages]# ll | grep libmpc.so
[root@localhost Packages]# ll | grep libmpc
-r--r--r--. 1642 root root    52120 Apr  2  2014 libmpc-1.0.1-3.el7.i686.rpm
-r--r--r--. 1646 root root    51788 Apr  2  2014 libmpc-1.0.1-3.el7.x86_64.rpm
-r--r--r--. 1637 root root    29364 Apr  2  2014 libmpcdec-1.2.6-12.el7.i686.rpm
-r--r--r--. 1637 root root    28992 Apr  2  2014 libmpcdec-1.2.6-12.el7.x86_64.rpm
[root@localhost Packages]# rpm -ivh libmpc-1.0.1-3.el7.x86_64.rpm
warning: libmpc-1.0.1-3.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:libmpc-1.0.1-3.el7               ################################# [100%]
[root@localhost Packages]# rpm -ivh cpp-4.8.5-16.el7.x86_64.rpm
warning: cpp-4.8.5-16.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:cpp-4.8.5-16.el7                 ################################# [100%]
[root@localhost Packages]# rpm -ivh gcc-4.8.5-16.el7.x86_64.rpm
warning: gcc-4.8.5-16.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:gcc-4.8.5-16.el7                 ################################# [100%]
```

- 安装 ncurses库

- 继续完成配置

```shell
[root@localhost Packages]# cd /root/soft/vim74
[root@localhost vim74]# ./configure
# ...略
no terminal library found
checking for tgetent()... configure: error: NOT FOUND!
      You need to install a terminal library; for example ncurses.
      Or specify the name of the library with --with-tlib.
[root@localhost vim74]# echo $?
0
```

- 安装依赖包

```shell
[root@localhost vim74]# cd /cdrom/Packages
[root@localhost Packages]# ll | grep ncurses-devel
-r--r--r--. 1633 root root   729968 Apr  3  2014 ncurses-devel-5.9-13.20130511.el7.i686.rpm
-r--r--r--. 1633 root root   729972 Apr  3  2014 ncurses-devel-5.9-13.20130511.el7.x86_64.rpm
[root@localhost Packages]# rpm -ivh ncurses-devel-5.9-13.20130511.el7.x86_64.rpm
warning: ncurses-devel-5.9-13.20130511.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY
Preparing...                          ################################# [100%]
Updating / installing...
   1:ncurses-devel-5.9-13.20130511.el7################################# [100%]
```

- 再次继续配置

```shell
[root@localhost Packages]# cd ~/soft/vim74
[root@localhost vim74]# ./configure --prefix=/usr/local/vim74 | head
configure: loading cache auto/config.cache
checking whether make sets $(MAKE)... yes
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
```

**5. make进行编译**

```shell
[root@localhost vim74]# make
# 略...
```

**6. make install 继续安装**

```shell
[root@localhost vim74]# make install
# 略...

# 此时还未添加到环境，不能使用
[root@localhost vim74]# vim
-bash: /usr/bin/vim: No such file or directory
```

**7. PATH 添加到环境变量**

```shell
[root@localhost vim74]# /usr/local/vim74/bin/vim /etc/profile
# 或 vi /etc/profile
# 添加以下到末尾
PATH=$PATH:/usr/local/vim74/bin/
export PATH
# 结束
[root@localhost vim74]# source /etc/profile
[root@localhost vim74]# echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/usr/local/vim74/bin/

# 至此 安装成功
```

#### 静默安装

- RHEL74

```shell
# 删除vim
rpm -e vim-enhanced
# 下载
cd /root
mkdir soft
cd ./soft
wget ftp://ftp.vim.org/pub/vim/unix/vim-9.0.tar.bz2
# 解压
tar -xvf vim-9.0.tar.bz2
# 安装依赖
# 1. 挂载光盘
cd ~
mkdir -p /room
mount -t iso9660 /dev/cdrom /room
# 2. 安装rpm包
cd /room/Packages
rpm -ivh libmpc-1.0.1-3.el7.x86_64.rpm
rpm -ivh cpp-4.8.5-16.el7.x86_64.rpm
rpm -ivh kernel-headers-3.10.0-693.el7.x86_64.rpm
rpm -ivh glibc-headers-2.17-196.el7.x86_64.rpm
rpm -ivh glibc-devel-2.17-196.el7.x86_64.rpm
rpm -ivh gcc-4.8.5-16.el7.x86_64.rpm
# 3. 安装ncurses库
# yum的方式 yum install ncurses ncurses-devel

# 源码安装 ncurses
# 下载路径 https://invisible-island.net/ncurses/ncurses.html#download_ncurses
wget https://invisible-island.net/datafiles/release/ncurses.tar.gz
tar -vxf ncurses.tar.gz
cd /soft/ncurses-6.3
./configure
make
make install

# 进入/root/soft/vim90 ./configure 配置软件
cd /root/soft/vim90
./configure
make
make install

# 结束
```

### nginx安装

- 下载路径 `https://nginx.org/en/download.html`

```shell
mkdir /root/soft
cd /root/soft
wget https://nginx.org/download/nginx-1.22.1.tar.gz
tar -xvf nginx-1.22.1.tar.gz
cd /root/soft/nginx-1.22.1

# gcc配置 在vim安装时已经配置

# pcre模块 
cd /room/Packages
rpm -ivh pcre-devel-8.32-17.el7.x86_64.rpm
rpm -ivh pcre-8.32-17.el7.x86_64.rpm

# zlib开发包
cd /room/Packages
rpm -ivh zlib-devel-1.2.7-17.el7.x86_64.rpm
rpm -ivh zlib-1.2.7-17.el7.x86_64.rpm

cd /root/soft/nginx-1.22.1
./configure
make
make install
```

```shell
[root@bogon ~]# cd /usr/local/nginx/sbin
[root@bogon sbin]# ./nginx
[root@bogon sbin]# netstat -plnt | grep 80
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      50771/nginx: master 
[root@bogon sbin]# echo "welcome" > /usr/local/nginx/html/index.html
[root@bogon sbin]# curl http://127.0.0.1
welcome
```

## Linux源码包卸载

- 通过源码包方式安装的各个软件，其安装文件独自保存在 /usr/local/ 目录下的各子目录中
- 例如，apache 所有的安装文件都保存在 /usr/local/apache2 目录下。这就为源码包的卸载提供了便利。
- 源码包的卸载，只需要找到软件的安装位置，直接删除所在目录即可，不会遗留任何垃圾文件。
- 在删除软件之前，应先将软件停止服务。

- 以删除 apache 为例，只需关闭 apache 服务后执行如下命令即可：

```shell
[root@localhost ~]# rm -rf /usr/local/apache2/
```

# Linux函数库

- 函数库是一个文件，包含已经编译好的代码和数据，供程序使用。

**静态函数库** 
                                       

- 在编译程序时，如果指定静态函数库文件，则编译时将这些静态函数库一起加载到最终的可执行文件中，在程序执行前加入目标程序。
- 文件后缀 .a
- 所在目录 /usr/lib  
- 通常只有一个程序使用 

**共享函数库**

- 在程序启动时加载到程序，可以被不同的程序共享
- 当一个可执行程序启动时被加载
- 所在目录 /lib 和 /usr/lib 
- 被多个程序使用

**动态加载函数库**

- 可以在程序运行的任何时候动态的加载
- 文件后缀 .so
- 一般都是共享函数库 

## 寻找函数库

### 1. 缓存文件 /etc/ld.so.cache**

- 从缓存文件 /etc/ld.so.cache中可以找到相关的库文件信息

```shell
# 修改 /etc/ld.so.conf 文件，将该库的文件路径添加到文件
echo "/usr/local/ssl/lid/" >> /etc/ld.so.conf

# 让系统升级ld.so.cache文件
ldconfig
```

### LD_LIBRARY_PATH 环境变量

```shell
export LD_LIBRARY_PATH=/usr/local/ssl/lib:$LD_LIBRARY_PATH:.
```

## ldd 查看程序使用了哪些动态库文件

# yum
