# Linux用户概述

| 用户类型 | 说明                                                         |
| :------- | :----------------------------------------------------------- |
| 超级用户 | root；UID: 0                                                 |
| 系统用户 | 正常运行时，系统使用的用户，每个进程在系统中都有一个相应的属主。<br />系统用户不能用来登录（bin、daemon、mail等） |
| 普通用户 | user                                                         |

# 用户与用户组

## 用户管理命令

### useradd

- `useradd`：添加用户

### usermod

- `usermod`：修改用户，不允许改变正在线上的使用者帐号名称；改变user id时必须确认该用户没在电脑上执行任何程序。

### userdel

- `userdel`：删除用户

 -r：同时删除该用户的相关任务和文件

| 用户管理命令 | 作用     | 说明 |
| ------------ | -------- | ---- |
| useradd      | 添加用户 |      |
| usermod      | 修改用户 |      |
|              |          |      |
|              | 用户密码 |      |
|              | 用户信息 | 。   |

### passwd

- `passwd`：设置用户的认证信息，包括用户密码、密码过期时间等；只有管理者可以指定用户名称，一般用户只能变更自己的密码。

### id

- `id`：显示真实有效的用户ID（UID）、组ID（GID）

## 用户组管理命令

- 用户创建的同时默认创建一个与用户名同名的用户组。
- 每个用户都有一个用户组，一个用户可以属于多个用户组，一个用户组可以有多个用户。
- 系统对一个用户组的用户集中管理，赋予用户组的权限可以被该用户获取；用户的权限为其所在的所有用户组的权限之和。

| 用户组文件                   | 说明                                 |
| ---------------------------- | ------------------------------------ |
| [/etc/passwd](#/etc/passswd) | 定义的用户组为基本组，其他的为附加组 |
| [/etc/group](#/etc/group)    | 用户组的操作基于对该文件的更新       |

### groupadd

- `groupadd`：添加用户组

### groupdel

- `groupdel`：删除用户组（修改的系统文件包括`/ect/group`和`/ect/shadow`）；若该群组中仍包括某些用户，则必须先删除这些用户后，方能删除群组

### groupmod

- `groupmod`：修改用户组

### groups

- `groups`：查看用户所在用户组 

## 用户与用户组配置文件

### /etc/passswd 用户账号文件

- <span name="/etc/passswd"><code>/etc/passswd</code></span>：普通用户的UID默认1000之后

```shell
# 用户名:加密密码:UID:GID:用户相关注释:用户主目录:用户使用的shell
root:x:0:0:root:/root:/bin/bash
```

| 字段         | 说明                                                      |
| ------------ | --------------------------------------------------------- |
| 用户名       | 大小写敏感                                                |
| 加密密码     | 存储在/etc/shadow（用户密码文件），只有root用户可以查看   |
| UID          | 用户标识号，相同UID的用户被认为是同一用户，UID最大为65535 |
| GID          | 组标识号，与/etc/group文件相关                            |
| 用户相关注释 |                                                           |
| 用户的主目录 |                                                           |
| 使用的shell  | 用户登录系统时运行的shell，通常为/bin/bash                |

### /etc/shadow  用户密码文件

- `/etc/shadow`：存储用户密码等重要信息，需要root用户才能查看

```shell
# 用户名:加密密码:上次修改密码的时间:需要再次修改密码的最少间隔天数:密码的有效期:提前提醒用户密码过期的天数:密码过期几天后禁用该用户:用户过期时间:保留字段
root:$y$j9T$winqvu47uxSPB73JG1Cuu0$rWfYs20SLEtRak3NDJLSK7RHDody7iYD.8.lzX2QxS4:19526:0:99999:7:::
```

1. 需要再次修改密码的最少间隔天数：0表示禁用该选项；非0则表示经过n天之后必须修改密码
2. 提前提醒用户密码过期的天数：99999表示密码基本不用修改
3. 保留字段：置空，永久可用

- 计时：从1970-01-01开始计算的天数

### /etc/group 用户组文件

- <span name="/etc/group"><code>/etc/group</code></span>：用户登录时默认的组放在[/etc/passwd](#/etc/passswd)

```shell
# 用户组名:用户密码:GID:组内用户列表
zjk:x:1000:
```

# su、sudo 切换用户

## su

- su：切换用户，默认切换至root

```shell
# 切换用户但不改变环境变量
su [用户]

# 切换用户并改变环境变量
su - 用户

# 切换用户执行命令之后，返回原用户
su -c 命令 用户
```

## sudo

- `sudo`：普通用户获取超级权限、以其他身份来执行命令，预设的身份为root

### /etc/sudoers

- `/etc/sudoers`：设置可执行sudo指令的用户

# 用户行为监控

## who/w

- `who、w`：`who`返回的是在线用户以及登录时间、登录的IP；`w`返回的是在线用户、登录的地址IP，登录时间、在线时间

```shell
# 查看当前用户的登录信息
who am i
```

### 注销在线用户

```shell
# 查看所有在线用户
w

# 查看在线用户的pid
ps -u zjk

# 发送注销信号（15）使用户正常退出，需要有root权限来注销其他用户
sudo kill -15 [pid]
```

