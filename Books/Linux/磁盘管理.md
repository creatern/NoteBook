# Linux磁盘分区

- Linux的所有文件和目录都存在于根分区/中，Linux系统中的每一个硬件设备都映射到系统的一个文件。
- 硬盘分区类型主要有：主分区、扩展分区、逻辑分区。每一个硬盘设备最多只能由4个主分区构成，任何一个扩展分区都要占用一个主分区号码（主分区和扩展分区数量最多为4），占用分区号1~4。当分区数量大于4时，要用到扩展分区和逻辑分区。先划分扩展分区，再在扩展分区的基础上建立逻辑分区。在进行系统分区时，主分区一般设置为激活状态，用于在系统启动时引导系统。分区时，每个分区的大小可以由用户指定。


# 文件系统管理

## 挂载/卸载文件系统

### mount 挂载文件系统

- <span name="mount">mount</span>：虚拟目录[挂载点](#挂载点)通常是在/mnt中新建一个目录来挂载。

```
mount [-lhV]
mount -a [options]
mount [options] [--source] <source> | [--target] <directory>
mount [options] <source> <directory>
mount <operation> <mountpoint> [<target>]
```

### umount 卸载文件系统

- umount（unmount）：与mount挂载命令需要同时提供设备名与挂载目录不同，umount卸载命令只需要提供设备名或挂载目录之一即可完成卸载。

```
umount [参数] 设备或目录名
```

<table><tbody><tr><td>-a</td><td data-immersive-translate-effect="1" data-immersive_translate_walked="7c05567e-e5ff-4670-b322-b61cd71b9233">卸载“/etc/mtab”文件中记录的所有设备</td></tr><tr><td>-F</td><td>强制卸载设备而不询问</td></tr><tr><td>-h</td><td>显示帮助信息</td></tr><tr><td>-n</td><td>卸载时不要将信息写入“/etc/mtab”文件中</td></tr><tr><td>-r</td><td>使用只读方式重新挂载文件系统</td></tr><tr><td>-t</td><td>仅卸载指定的文件系统</td></tr><tr><td>-v</td><td>显示执行过程详细信息</td></tr><tr><td>-V</td><td>显示版本信息</td></tr></tbody></table>

```shell
# 卸载指定的文件系统并显示过程
umount -v /dev/sdb
```

### /etc/fstab：挂载文件

<img src="../../pictures/Snipaste_2022-11-29_00-08-22.png" width="850"/> 

## tune2fs 调整/查看磁盘的文件系统参数

## mkfs 格式化文件系统

- mkfs（make file system）：对设备进行格式化文件系统操作

<table><tbody><tr><td>-c</td><td>检查指定设备是否损坏</td></tr><tr><td>-t</td><td>设置档案系统的模式</td></tr><tr><td>-V </td><td>显示执行过程详细信息</td></tr><tr><td>--help</td><td>显示帮助信息</td></tr><tr><td>--version</td><td>显示版本信息</td></tr></tbody></table>

```shell
# 查看当前系统中支持mkfs的文件系统格式
ls -l /usr/sbin/mkfs.*

# 对指定的硬盘进行格式化文件系统操作，并输出详细过程信息
sudo mkfs -V -t xfs /dev/sdb
```

## e2label ntfs格式、ext2/3/4格式

# 磁盘分区管理

## du 显示某个指定目录下的磁盘使用情况

## df 显示磁盘空间使用量情况

- df（report file system disk space usage）：显示的磁盘使用量情况含可用、已用及使用率等信息，默认单位为KB。

<table><tbody><tr><td>-a<strong></strong></td><td>显示所有文件系统</td><td rowspan="5"><strong>&nbsp;</strong></td><td>-l<strong></strong></td><td>只显示本地文件系统 </td></tr><tr><td>-h<strong></strong></td><td>以更易读的方式显示<strong></strong></td><td>-t</td><td>只显示指定类型文件系统 <strong></strong></td></tr><tr><td>-H<strong></strong></td><td>以1KB=1000B为换算单位</td><td>-T<strong></strong></td><td>显示文件系统的类型<strong></strong></td></tr><tr><td>-i</td><td>显示索引字节信息<strong></strong></td><td>--sync <strong></strong></td><td>在获取磁盘使用信息前先执行sync同步命令</td></tr><tr><td>-k<strong></strong></td><td>设置显示时的块大小<strong></strong></td><td>&nbsp;</td><td><strong>&nbsp;</strong></td></tr></tbody></table>

```shell
# 显示系统全部磁盘的使用量情况（带容量单位）
df -h
```

## fdisk

- fdisk：固定磁盘（fixed disk）或格式化磁盘（format disk），管理磁盘的分区信息。

<table><tbody><tr><td>-b</td><td>设置每个分区的大小</td><td rowspan="5">&nbsp;</td><td>-l</td><td>显示指定的外围设备分区表状态</td></tr><tr><td>-c</td><td>关闭DOS兼容模式</td><td>-s</td><td>显示指定的分区大小</td></tr><tr><td>-C</td><td>设置硬盘的柱面数量</td><td>-S</td><td>设置每个磁道的扇区数</td></tr><tr><td>-h</td><td>显示帮助信息</td><td>-u</td><td>以分区数目代替柱面数目</td></tr><tr><td>-H</td><td>设置硬盘的磁头数</td><td>-v</td><td>显示版本信息</td></tr></tbody></table>

## parted

## lsblk

## ntfslabel 磁盘分区改名

# <span name="磁盘IO监控">系统IO监控</span>

## iostat 磁盘活动统计

- iostat：汇报磁盘活动统计情况、CPU使用情况。

```shell
# iostat -x /dev/sda1
Linux 3.10.0-693.el7.x86_64 (bogon)     12/12/2022      _x86_64_        (12 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.01    0.00    0.03    0.00    0.00   99.96

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda1              0.00     0.00    0.18    0.00     0.56     0.20     8.34     0.00    0.13    0.12    3.00   0.12   0.00
```

# 
