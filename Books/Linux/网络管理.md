# 网络检测

## nmap 网络扫描

<table><tbody><tr><td>-A</td><td>使用高级功能进行扫描</td></tr><tr><td>-d</td><td>显示调试信息</td></tr><tr><td>-n</td><td>不使用域名解析</td></tr><tr><td>-p</td><td>扫描指定端口和端口范围</td></tr><tr><td>-R</td><td>为所有目标解析域名</td></tr><tr><td>-PE</td><td>强制执行直接的ICMPping</td></tr><tr><td>-ps</td><td>发送SYN同步报文</td></tr><tr><td>-PU</td><td>发送udp ping</td></tr><tr><td>-sP</td><td>对目标主机进行ping扫描</td></tr><tr><td>-sV</td><td>探测服务版本信息</td></tr><tr><td>--traceroute</td><td>扫描主机端口并跟踪路由</td></tr></tbody></table>

```shell
# 高级模式扫描目标网络，并将输出内容追加到指定文件
nmap -A 10.22.189.188/16 >> ~/tmpNmap.txt

# 扫描网络范围内的主机是否开放了FTP端口（默认为21）
nmap -p 21 192.168.1.0/24
```

## ping 连通性

- ping：测试主机之间网络的连通性（ICMP传输协议）。

## netstat 网络状态

- netstat：查看当前主机的所有详细的网络信息。

```
Active Internet connections (w/o servers)
Proto   Recv-Q   Send-Q   Local Address    Foreign Address     State
```

| 基本信息                        | 说明                                        |
| ------------------------------- | ------------------------------------------- |
| Proto                           | 协议                                        |
| State                           | 状态                                        |
| Local Address                   | 本地地址                                    |
| Foreign Address                 | 外部地址                                    |
| **Active Internet connections** | **有源TCP连接**                             |
| Recv\-Q                         | 接收队列，通常为0，否则软件包正在队列中堆积 |
| Send\-Q                         | 发送队列，通常为0，否则软件包正在队列中堆积 |
| **Active UNIX domain sockets**  | **有源Unix域套接口**（只能用于本机通信）    |
| RefCnt                          | 连接到本套接口上的进程号                    |
| Types                           | 套接口的类型                                |
| Path                            | 连接到套接口的其它进程使用的路径名          |

# 网络下载与服务

| 命令   | 说明                                                         |
| ------ | ------------------------------------------------------------ |
| scp    | 加密的方式在本地主机和远程主机之间复制文件                   |
| rsync  | 远程数据同步工具、只传送两个文件的不同部分                   |
| telnet | 登录远程主机和管理（测试ip端口是否连通）<br />明文传送报文，安全性不好 |
| wget   | 支持FTP和HTTP下载                                            |

## curl 请求Web服务器

```shell
curl [options...] <url>
```

- 默认为\-X GET，即GET请求方式。

### -X POST POST请求

```shell
# 发送表单数据
curl [-X POST] -d 'name1=value' [-d 'name2=value'] <url>

# 发送分段数据 Content-Type: multipart/form-data
curl [-X POST] -F 'name=value' <url>

# 文件传输（图片 pic） 读取xx.png，传输时改名为aa.png
curl [-X POST] -F 'pic=@xx.png;filename=aa' <url>

# JSON数据
curl -H 'Content-Type: application/json' -d '{"name1": "value"}' [-d '{"name2": "value"}'] <url>

# XML数据
curl -H 'Content-Type: text/xml' -d 'hello' <url>
```

### --cookie Cookie

```shell
curl --cookie 'key=value' <url>
```

### -H 请求头

```shell
curl -H 'key=value' [-H 'key=value']
```

## wget

- wget：

# 网络接口配置

| 配置工具 | 说明                                |
| -------- | ----------------------------------- |
| ifconfig | 配置和显示Linux系统网卡的网络参数。 |
| ifdown   | 禁用指定的网络接口。                |

## ifconfig 网络接口参数

```
wlp1s0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.22.175.88  netmask 255.255.0.0  broadcast 10.22.255.255
        inet6 fe80::77bc:d47b:c023:d7aa  prefixlen 64  scopeid 0x20<link>
        ether 48:e7:da:0e:38:f7  txqueuelen 1000  (Ethernet)
        RX packets 6769  bytes 7814090 (7.8 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 4049  bytes 401429 (401.4 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

| 特殊网络接口 | 说明                         |
| ------------ | ---------------------------- |
| lo           | 主机回环地址                 |
| virbr0       | 虚拟桥接网络，主要用于虚拟机 |
| docker0      | docker网络                   |

```
flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
```

| flags参数 | 标识                   |
| --------- | ---------------------- |
| LOOPBACK  | 回环地址               |
| UP        | 网络接口处于启用状态   |
| RUNNIG    | 网卡设备处于连接状态   |
| BROADCAT  | 支持广播               |
| MULTICAST | 支持组播               |
| **mtu**   | **数据包最大传输单元** |

```
inet 10.22.175.88  netmask 255.255.0.0  broadcast 10.22.255.255
inet6 fe80::77bc:d47b:c023:d7aa  prefixlen 64  scopeid 0x20<link>
```

| IPv4地址信息     | 说明     |
| ---------------- | -------- |
| inet             | IPv4地址 |
| netmask          | 子网掩码 |
| broadcast        | 广播地址 |
| **IPv6地址信息** | **说明** |
| inet6            | IPv6地址 |
| prefixlen        |          |
| scopeid          |          |

```
ether 48:e7:da:0e:38:f7  txqueuelen 1000  (Ethernet)
```

| MAC 硬件地址    | 说明                                               |
| --------------- | -------------------------------------------------- |
| ether<br />loop | Ethernet（以太网）<br />Local Loopback（本地环回） |
| txqueuelen      |                                                    |

```
RX packets 6769  bytes 7814090 (7.8 MB)
RX errors 0  dropped 0  overruns 0  frame 0
TX packets 4049  bytes 401429 (401.4 KB)
TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

| 数据包信息 | 说明                                                 |
| ---------- | ---------------------------------------------------- |
| RX packets | 接收数据包情况统计                                   |
| RX errors  | 接收数据包异常情况统计                               |
| TX packets | 发送数据包情况统计                                   |
| TX errors  | 发送数据包异常情况统计<br />collisions：发送冲突次数 |

## 网络配置文件

<table>
    <tr>
        <td rowspan="2" width="35%">/etc/sysconfig/network\-scripts/ifcfg\-\*</td>
        <td width="65%">网络接口文件：设置网卡参数，`*`为网卡编号/回环网卡，配置IP地址，修改之后需要重启网络服务才开始生效。</td>
    </tr>
    <tr>
        <td>/etc/sysconfig目录仅rpm系的Linux系统使用</td>
    </tr>
    <tr>
        <td>/etc/resolv\.conf</td>
        <td>域名解析文件：设置DNS的相关信息，用于将域名解析到IP</td>
    </tr>
    <tr>
        <td>/etc/hosts</td>
        <td>主机名查询静态表：定义IP地址和主机名的映射关系。输入域名时，系统会先从hosts文件中寻找对应的IP地址，若没有找到，才将域名发送到DNS服务器进行IP地址解析。</td>
    </tr>
    <tr><td>/etc/hostname</td>
        <td>主机名文件：修改主机名称（hostname指令），修改完主机名后，还需要修改相应的/etc/hosts文件，使主机能够顺利地解析该主机名。</td>
    </tr>
    <tr>
        <td>/etc/nsswitch\.conf</td>
        <td>名字服务切换配置文件：设置DNS解析优先还是本地设置优先等</td>
    </tr>
    <tr>
        <td rowspan="2">/etc/sysconfig/network</td>
        <td>默认网关</td>
    </tr>
    <tr>
        <td>该文件在重启network服务后生效 <code>systemctl restart network</code></td>
    </tr>
</table>


## netplan

- `/etc/netplan/*.yaml`：定义网络接口的详细配置，包括IP地址、子网掩码、网关、DNS服务器等信息。

```shell
# 重新配置所有已定义在网络配置文件中的接口，并激活新的网络设置
sudo netplan apply
```

```yaml
network:
    version: 2 # 指定使用的Netplan配置版本
    wifis:
        renderer: networkd # 指定该网卡配置使用的服务
        wlan0:
            access-points: # 该无线网卡可以连接的Wi-Fi列表，依次尝试连接直到成功
                wzqandzjk: # wiff名称，不需要双引号，中文可能出错
                    password: 1b7ea879f2be928c2d571a6664cb4bdfb1a82c8ffa518b5a6bd221753664b92a # 加密密码
                XMUT-WiFi: {} # 无密码
            dhcp4: true # 指示该接口使用DHCP动态获取IPv4地址，而不是静态IP方式（CIDR记法）
            optional: true # true表明即使无法连接也不会阻止系统启动
```

- password需要加密：`wpa_passphrase SSID 密码`

```shell
wpa_passphrase wzqandzjk 20020217

# network={
# 	ssid="wzqandzjk"
# 	#psk="20020217"
# 	psk=1b7ea879f2be928c2d571a6664cb4bdfb1a82c8ffa518b5a6bd221753664b92a
# }
```

# 网络扫描

## 路由

- `192.168.1.1`：路由器管理页面的默认入口

### route 路由表

- route：显示/添加/修改路由器（主要是静态路由）

```
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         _gateway        0.0.0.0         UG    600    0        0 wlp1s0
10.22.0.0       0.0.0.0         255.255.0.0     U     600    0        0 wlp1s0
link-local      0.0.0.0         255.255.0.0     U     1000   0        0 wlp1s0
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0
```

| route信息   | 说明             |
| ----------- | ---------------- |
| Destination | 目标             |
| Gateway     | 无网关           |
| Genmask     | 子网掩码         |
| Flags       | 路由标识         |
| Metric      | 跃点数           |
| Ref         | 引用             |
| Use         | 使用             |
| Iface       | 网络接口（网卡） |

| Flags参数 | 标识                                                 |
| --------- | ---------------------------------------------------- |
| U         | UP，此路由处于启动状态。                             |
| \!        | 此路由处于关闭状态                                   |
| H         | Host，此网关是一个主机。                             |
| G         | Gateway，此网关是一个路由器。                        |
| R         | Reinstate Route，动态路由重新初始化的路由            |
| D         | Dynamically，此路由是动态写入的。                    |
| M         | Modified，此路由是路由守护进程、或导向器动态修改的。 |

### traceroute 路由追踪

- traceroute：追踪数据包在网络上的传输时的全部路径，默认发送的数据包大小是40字节。

### ip rule 路由策略

- Linux系统负责维护4个路由表（0、253、254、255）。RHEL系统中最多可以同时存在256个路由表（0\~255），每个路由表都各自独立，数据包传输时根据路由策略数据库中的策略决定数据包应该由哪个路由表传输。

| 路由表             | 说明                                                         |
| ------------------ | ------------------------------------------------------------ |
| 0号表（unspec）    | 系统保留表。                                                 |
| 253号表（default） | 默认路由表，一般，默认的路由都存放在253号表。                |
| 254号表（main）    | 主路由表，若没有指明路由所属的表，则所有的路由都默认放在这个表。 |
| 255号表（local）   | 本地路由表，由系统自动维护，管理员不能直接修改。<br />存放本地接口地址、广播地址、NAT地址。 |

### /etc/iproute2/rt\_tables 路由表文件

```shell
cat /etc/iproute2/rt_tables
255     local
254     main
253     default
0       unspec
```

## DNS

### nslookup

```shel
nslookup {hostname}
```

# 
