# 单实例

## Windows

- 创建服务时出现错误,服务oraclMTSRecoveryService已经存在：管理员打开cmd

```shell
net stop OracleMTSRecoveryService
sc delete OracleMTSRecoveryService
```

## Linux

### 11g&amp;RHEL7.4

[参考安装](https://www.cnblogs.com/mmzs/p/9033112.html)

```shell
# 先准备oracle11g 压缩包
mkdir /root/install
cd /root/install

# 解压缩
unzip linux.x64_11gR2_database_1of2.zip
unzip linux.x64_11gR2_database_2of2.zip

# 将解压后的文件夹直接移动到/software目录下：
mv database /software/database
cd /software

# 关闭selinux
vim /etc/selinux/config
# 设置SELINUX=disabled
setenforce 0

# 关闭防火墙
systemctl restart firewalld.service
systemctl list-unit-files|grep firewalld.service
systemctl disable firewalld.service

# 安装所需的安装包
#gcc 
#make 
#binutils 
#gcc-c++ 
#compat-libstdc++-33 
#libstdc++-devel
#libstdc++ 
#elfutils-libelf-devel 
#elfutils-libelf-devel-static 
#elfutils-libelf
#libgcc
#zlib-devel
#compat-libcap1
#libXext
#libXtst
#libX11
#libXau
#libxcb
#libXi
#ksh 
#libaio 
#libaio-devel 
#numactl-devel 
#sysstat 
#unixODBC 
#unixODBC-devel 
#pcre-devel

# rpm安装依赖
# 已经有的 make libaio libaio-devel libXext libXtst libX11 libXau libxcb libXi
# 挂载
mkdir /mnt/cdrom
mount -t iso9660 /dev/cdrom /mnt/cdrom
cd /mnt/cdrom/Packages
# gcc libmpc cpp kernel glibc-header gblic-devel
rpm -ivh libmpc-1.0.1-3.el7.x86_64.rpm
rpm -ivh cpp-4.8.5-16.el7.x86_64.rpm
rpm -ivh kernel-headers-3.10.0-693.el7.x86_64.rpm
rpm -ivh glibc-headers-2.17-196.el7.x86_64.rpm
rpm -ivh glibc-devel-2.17-196.el7.x86_64.rpm
rpm -ivh gcc-4.8.5-16.el7.x86_64.rpm
# binutils binutils-devel zlib
rpm -ivh zlib-devel-1.2.7-17.el7.x86_64.rpm
rpm -ivh binutils-devel-2.25.1-31.base.el7.x86_64.rpm
rpm -ivh binutils-2.25.1-31.base.el7.x86_64.rpm
# gcc-c++ libstdc++-devel libstdc++
rpm -ivh libstdc++-devel-4.8.5-16.el7.x86_64.rpm
rpm -ivh gcc-c++-4.8.5-16.el7.x86_64.rpm
rpm -ivh libstdc++-4.8.5-16.el7.x86_64.rpm
# compat-libstdc++-33 下载安装 
mkdir /root/mytempfile
cd /root/mytempfile
rpm -ivh compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm
# elfutils-libelf-devel elfutils-libelf-devel-static 下载以下0.168 
rpm -ivh elfutils-libelf-devel-0.168-8.el7.x86_64.rpm
rpm -ivh elfutils-libelf-devel-static-0.168-8.el7.x86_64.rpm
# ksh 下载http://mirror.centos.org/centos/7/updates/x86_64/Packages/ksh-20120801-144.el7_9.x86_64.rpm
rpm -ivh ksh-20120801-144.el7_9.x86_64.rpm
cd /mnt/cdrom/Packages
rpm -ivh libaio-devel-0.3.109-13.el7.x86_64.rpm
# numactl-devel
rpm -ivh numactl-devel-2.0.9-6.el7_2.x86_64.rpm
# sysstat
# unixODBC
rpm -ivh unixODBC-2.3.1-11.el7.x86_64.rpm
# unixODBC-devel
rpm -ivh unixODBC-devel-2.3.1-11.el7.x86_64.rpm
# pcre-devel
rpm -ivh pcre-devel-8.32-17.el7.x86_64.rpm

cd /software 

# 添加安装用户和用户组
groupadd oinstall
groupadd dba
useradd -g oinstall -G dba oracle
passwd oracle
#[root@bogon software]# id oracle
#uid=1001(oracle) gid=1001(oinstall) groups=1001(oinstall),1002(dba)

# 修改内核参数配置文件
vim /etc/sysctl.conf
#在末尾添加以下内容：
fs.aio-max-nr = 1048576
fs.file-max = 6815744
kernel.shmall = 2097152
kernel.shmmax =1073741824 #2147483648 本机物理内存的一半 Byte
kernel.shmmni = 4096
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 9000 65500
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
#检查
sysctl -p 

# 修改用户的限制文件
vim /etc/security/limits.conf
#在末尾添加以下内容：
oracle           soft    nproc           2047
oracle           hard    nproc           16384
oracle           soft    nofile          1024
oracle           hard    nofile         65536
oracle           soft    stack           10240 

vim /etc/pam.d/login
#在末尾添加以下内容：
session required  /lib64/security/pam_limits.so
session required   pam_limits.so 

vim /etc/profile

#在末尾添加以下内容：
#oracle配置
if [ $USER = "oracle" ]; then
  if [ $SHELL = "/bin/ksh" ]; then
      ulimit -p 16384
      ulimit -n 65536
  else
      ulimit -u 16384 -n 65536
  fi
fi 

# 创建安装目录和设置文件权限
mkdir -p /data/oracle/product/11.2.0
mkdir /data/oracle/oradata
mkdir /data/oracle/inventory
mkdir /data/oracle/fast_recovery_area
chown -R oracle:oinstall /data/oracle
chmod -R 775 /data/oracle

## 以下是oracle用户操作
# 设置oracle用户环境变量 
su -l oracle
vim .bash_profile
#在末尾添加如下内容：
ORACLE_BASE=/data/oracle
ORACLE_HOME=$ORACLE_BASE/product/11.2.0
ORACLE_SID=orcl #此处必须与创建的数据库实例名称一致，否则数据库启动后无法访问。
PATH=$PATH:$ORACLE_HOME/bin
export ORACLE_BASE ORACLE_HOME ORACLE_SID PATH

# 使可用
source .bash_profile

# 编辑静默安装响应文件
#复制安装文件夹response到当前oracle用户的家目录下：
# 先去检查解压的文件是否在/software/database里，而不是/software，（root新建/software/database，并移到到目录）
cp -R /software/database/response/ .
cd response/
vim db_install.rsp
#需要设置的选项如下：
oracle.install.option=INSTALL_DB_SWONLY
ORACLE_HOSTNAME=CentOS # 有问题
UNIX_GROUP_NAME=oinstall
INVENTORY_LOCATION=/data/oracle/inventory
SELECTED_LANGUAGES=en,zh_CN
ORACLE_HOME=/data/oracle/product/11.2.0
ORACLE_BASE=/data/oracle
oracle.install.db.InstallEdition=EE
oracle.install.db.DBA_GROUP=dba
oracle.install.db.OPER_GROUP=dba
DECLINE_SECURITY_UPDATES=true

# 根据响应文件静默安装Oracle11g
cd /software/database/
./runInstaller -silent -responseFile /home/oracle/response/db_install.rsp -ignorePrereq
#出现以下
#[WARNING] [INS-32055]
#问题不大继续回车。。。
#出现以下则为成功
To execute the configuration scripts:
         1. Open a terminal window 
         2. Log in as "root" 
         3. Run the scripts 
         4. Return to this window and hit "Enter" key to continue 

Successfully Setup Software.
# 打开终端，退出到root身份登录，执行脚本：
#oracle退出 exit
exit
# 换回root操作
sh /data/oracle/inventory/orainstRoot.sh
#以下成功
Changing permissions of /data/oracle/inventory.
Adding read,write permissions for group.
Removing read,write,execute permissions for world.

Changing groupname of /data/oracle/inventory to oinstall.
The execution of the script is complete.
# 继续
sh /data/oracle/product/11.2.0/root.sh
#以下成功
Check /data/oracle/product/11.2.0/install/root_iZ2f570bi1k56uZ_2018-05-13_14-25-04.log for the output of root script

# 以静默方式配置监听
# 换回oracle操作
netca /silent /responseFile /home/oracle/response/netca.rsp 
#必须使用/silent /responseFile格式，而不是-silent -responseFile，因为是静默安装
#等待。。
[oracle@bogon ~]$ netca /silent /responseFile /home/oracle/response/netca.rsp

Parsing command line arguments:
    Parameter "silent" = true
    Parameter "responsefile" = /home/oracle/response/netca.rsp
Done parsing command line arguments.
Oracle Net Services Configuration:
Profile configuration complete.
Oracle Net Listener Startup:
    Running Listener Control: 
      /data/oracle/product/11.2.0/bin/lsnrctl start LISTENER
    Listener Control complete.
    Listener started successfully.
Listener configuration complete.
Oracle Net Services configuration successful. The exit code is 0
#成功运行后，在/data/oracle/product/11.2.0/network/admin中生成listener.ora和sqlnet.ora
#通过netstat命令可以查看1521端口正在监听。
[oracle@bogon ~]$ netstat -tnulp | grep 1521
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
tcp6       0      0 :::1521                 :::*                    LISTEN      17510/tnslsnr 

#以静默方式建立新库，同时也建立一个对应的实例
vim /home/oracle/response/dbca.rsp
```

```shell
#修改文件中以下参数：

[GENERAL]

# oracle版本，不能更改
RESPONSEFILE_VERSION = "11.2.0"

# Description   : Type of operation
OPERATION_TYPE = "createDatabase"

[CREATEDATABASE]

# Description   : Global database name of the database
# 全局数据库的名字=SID+主机域名
# 第三方工具链接数据库的时候使用的service名称
GDBNAME = "orcl.test" #GDBNAME = "orcl.bogon" 

# Description   : System identifier (SID) of the database
# 对应的实例名字
SID = "orcl"

# Description   : Name of the template
# 建库用的模板文件
TEMPLATENAME = "General_Purpose.dbc"

# Description   : Password for SYS user
# SYS管理员密码
SYSPASSWORD = "123456"

# Description   : Password for SYSTEM user
# SYSTEM管理员密码
SYSTEMPASSWORD = "123456"

# Description   : Password for SYSMAN user
# SYSMAN管理员密码
SYSMANPASSWORD = "123456"

# Description   : Password for DBSNMP user
# DBSNMP管理员密码
DBSNMPPASSWORD = "123456"

# Description   : Location of the data file's
# 数据文件存放目录
DATAFILEDESTINATION =/data/oracle/oradata

# Description   : Location of the data file's
# 恢复数据存放目录
RECOVERYAREADESTINATION=/data/oracle/fast_recovery_area

# Description   : Character set of the database
# 字符集，重要!!! 建库后一般不能更改，所以建库前要确定清楚。
# (CHARACTERSET = "AL32UTF8" NATIONALCHARACTERSET= "UTF8")
CHARACTERSET = "ZHS16GBK"

# Description   : total memory in MB to allocate to Oracle
# oracle内存1638MB,物理内存2G*80%
TOTALMEMORY = "1638" 
```

```shell
# 进行静默配置
dbca -silent -responseFile /home/oracle/response/dbca.rsp
#等待较长时间
100% complete
Look at the log file "/data/oracle/cfgtoollogs/dbca/orcl/orcl.log" for further details.

# 建库后进行实例进程检查：
ps -ef | grep ora_ | grep -v grep
#如下
[oracle@bogon ~]$ ps -ef | grep ora_ | grep -v grep
oracle    18520      1  0 15:18 ?        00:00:00 ora_pmon_orcl
oracle    18522      1  0 15:18 ?        00:00:01 ora_vktm_orcl
oracle    18526      1  0 15:18 ?        00:00:00 ora_gen0_orcl
oracle    18528      1  0 15:18 ?        00:00:00 ora_diag_orcl
oracle    18530      1  0 15:18 ?        00:00:00 ora_dbrm_orcl
oracle    18532      1  0 15:18 ?        00:00:00 ora_psp0_orcl
oracle    18534      1  0 15:18 ?        00:00:00 ora_dia0_orcl
oracle    18536      1  0 15:18 ?        00:00:00 ora_mman_orcl
oracle    18538      1  0 15:18 ?        00:00:00 ora_dbw0_orcl
oracle    18540      1  0 15:18 ?        00:00:00 ora_dbw1_orcl
oracle    18542      1  0 15:18 ?        00:00:00 ora_lgwr_orcl
oracle    18544      1  0 15:18 ?        00:00:00 ora_ckpt_orcl
oracle    18546      1  0 15:18 ?        00:00:00 ora_smon_orcl
oracle    18548      1  0 15:18 ?        00:00:00 ora_reco_orcl
oracle    18550      1  0 15:18 ?        00:00:00 ora_mmon_orcl
oracle    18552      1  0 15:18 ?        00:00:00 ora_mmnl_orcl
oracle    18554      1  0 15:18 ?        00:00:00 ora_d000_orcl
oracle    18556      1  0 15:18 ?        00:00:00 ora_s000_orcl
oracle    18582      1  0 15:18 ?        00:00:00 ora_qmnc_orcl
oracle    18585      1  0 15:18 ?        00:00:00 ora_q000_orcl
oracle    18587      1  0 15:18 ?        00:00:00 ora_q001_orcl
oracle    18604      1  0 15:19 ?        00:00:00 ora_cjq0_orcl

# 查看监听状态：
lsnrctl status
#如下
[oracle@bogon ~]$ lsnrctl status

LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 02-DEC-2022 15:27:29

Copyright (c) 1991, 2009, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 11.2.0.1.0 - Production
Start Date                02-DEC-2022 14:43:04
Uptime                    0 days 0 hr. 44 min. 50 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /data/oracle/product/11.2.0/network/admin/listener.ora
Listener Log File         /data/oracle/diag/tnslsnr/bogon/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=bogon)(PORT=1521)))
Services Summary...
Service "orcl.bogon" has 1 instance(s).
  Instance "orcl", status READY, has 1 handler(s) for this service...
Service "orclXDB.bogon" has 1 instance(s).
  Instance "orcl", status READY, has 1 handler(s) for this service...
The command completed successfully

#数据库创建完成

# 登录查看实例状态：
sqlplus / as sysdba
```

- 打开防火墙

```shell
#打开SELINX
vim /etc/selinux/config
#设置 SELINUX=enforcing

#开启防火墙
systemctl enable firewalld.service
systemctl restart firewalld.service
systemctl list-unit-files | grep firewalld.service
```

#### 启动实例

**1.启动lsnrctl**

```shell
#查看lsnrctl状态
lsnrctl status
#启动lsnrctl
lsnrctl start
```

**2.启动SID**

```shell
#启动
sqlplus / as sysdba
startup
```

### 19c&amp;Ubuntu20.04LTS
