# 权限管理概述

- sysdba &gt; sysoper（超级权限）：同属于系统权限（system Privileges），Oracle允许拥有该权限的用户在数据库未打开的情况下访问实例、执行重大的数据库操作（数据库启动、关闭等）。

| sysdba可执行任务               | 说明                         |
| ------------------------- | -------------------------- |
| startup、shutdown          | 启动、关闭数据库                   |
| alter database            | 修改数据库<br />打开、装载、备份、改变字符集等 |
| create database           | 创建数据库                      |
| drop database             | 删除数据库                      |
| create spfile             | 创建服务器参数文件                  |
| alter database archivelog | 改变归档模式                     |
| alter database recover    | 执行数据库恢复                    |

```shell
# 以sysdba登录数据库
sqlplus sys/change_on_install[@orcl] as sysdba
```

# 数据库安全性

- 数据库安全性：用户、角色、概要文件。

> 数据库安全性、系统安全性、数据安全性。

## 用户

### 创建用户

- 创建用户需要DBA权限。

```sql
create user user_name
identitied by password;
```

### 用户解锁

```sql
alter user scott  
identitied by tiger 
account unlock;
```

### 用户信息

```sql
-- 查看当前用户名
show user
```

```sql
-- 查看所有用户名 all_users
select *
from all_users
```

### 用户密码

- 可用户自己修改

```sql
alter user user_name
identitied by password;
```

### 切换用户

```sql
connect scott/tiger@orcl
```

## 角色

- 角色可以像用户一样被赋予权限和收回权限，当角色被赋予某个用户时，其权限也被赋予给用户。因此，一个用户的权限=其本身的权限\+其拥有的角色的权限。

### 创建角色

```sql
create role 角色名
```

### 常用角色

| 角色       | 拥有的权限   |
|:-------- |:------- |
| connect  | 连接数据库   |
| resource | 使用数据库资源 |

# 权限管理

1. 不同对象具有不同的对象权限。
2. 对象的拥有者或sysdba/system用户拥有所有的权限。
3. 对象的拥有者可以向外分配权限。

## public 公共用户

- 向public分配/收回权限，相当于向所有用户（包括还未创建的和已经创建的用户）分配/收回权限。

## SQL标准权限

| 权限                | 权限   |
|:----------------- |:---- |
| select            | 查询   |
| insert            | 插入   |
| update            | 更新   |
| delete            | 删除   |
| all \[privilege\] | 以上所有 |

## 权限管理命令

### grant 赋予权限

```sql
grant 权限列表
[on [模式.]关系/视图]
to 用户/角色列表
[with grant option] -- 获得分配权限的能力
[by current_role] -- 通过角色授权，避免级联收权
```

```sql
-- 先设置与当前会话关联的角色（默认空）必须是该授权用户拥有的角色
set role 角色
```

### revoke 收回对象权限

```sql
revoke [grant option for] 权限列表 -- grant option for 仅收回分配权
[on [模式.]关系/视图]
from 用户/角色列表
[restrict] -- 阻止级联收权
```

- restrict阻止级联收权，如果发生级联授权，则使这次收权失败。grant授权时，通常会产生一个授权图。当revoke收回权限时，默认级联收权：即a授权给b，b授权给c时，如果收回b的权限，则c的权限也被收回。

## 行级授权

### VPD Oracle虚拟私有数据库

- VPD（Oracle虚拟私有数据库）将函数和关系相关联，该函数返回一个谓词，并自动将该谓词添加到使用该关系的任何查询。

> 隐患：可能会改变查询的含义。

## 权限分配情况

| 数据库字典                  | 权限描述          |
|:---------------------- |:------------- |
| role\_sys\_privs       | 角色拥有的系统权限     |
| role\_tab\_privs       | 角色拥有的对象权限     |
| user\_role\_privs      | 用户拥有的角色       |
| user\_tab\_privs\_made | 用户分配的关于表对象权限  |
| user\_tab\_privs\_recd | 用户拥有的关于表对象权限  |
| user\_col\_privs\_made | 用户分配的关于列的对象权限 |
| user\_col\_privs\_recd | 用户拥有的关于列的对象权限 |
| user\_sys\_privs       | 用户拥有的系统权限     |
