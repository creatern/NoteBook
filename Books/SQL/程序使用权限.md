# 程序的权限模型

| 权限模型       | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| 定义者权限模型 | 允许具有一个程序执行权限的调用者调用这一程序，但是该调用者在这个程序所访问的对象上可以没有任何权限。（以拥有该程序的用户的权限）<br />要求一个程序的拥有者具有该程序（包括过程、函数和软件包）所引用的对象的所有必须的权限。 |
| 调用者权限模型 | 一个程序是以调用该程序的用户的权限执行的。<br />一个用户以调用者权限运行一个过程时，该用户需要具有这个过程所引用的对象的相应权限。<br />防止权限较低的用户通过调用软件包的方式访问他们不应该访问的对象或进行不应该的操作。 |

> - 在定义者权限模型中，如果hr用户调用scott用户拥有的PL/SQL存储过程get\_emp\_sal，那么get\_emp\_sal过程是以拥有者scott的权限来运行的。
> - 在调用者权限模型中，如果hr用户调用scott用户拥有的PL/SQL存储过程get\_emp\_sal，那么get\_emp\_sal过程是以调用者hr的权限来运行的。

# 设置调用者权限

- PL/SQL默认是authid definer（ 定义者模型）以程序的拥有者的权限执行该子程序。
- 要将一个子程序定义成使用调用者权来执行的子程序，只需要在参数表和is（或as）关键字之间加上`authid current_user`。

```plsql
create function 函数名 
  return 数据类型 
  authid current_user
  is
    声明，函数体;

create procedure 过程名 
  authid current_user
  is
   声明，过程体;

create package 软件包名
  authid current_user
  is
   声明；

create type 类型名 
  authid current_user
  is 
    对象；
```

```plsql
create or replace procedure get_salary
 (
  v_emp_id copy_emp.employee_id%type
 )
 authid current_user
 is
  v_sal number;
  begin
    select salary
    into v_sal
    from copy_emp
    where employee_id = v_emp_id;
    
    dbms_output.put_line('id:'||v_emp_id||' , sal:'||v_sal);
  end;
```
