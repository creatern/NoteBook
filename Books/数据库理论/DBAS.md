# DBAS生命周期模型

- DBAS（DataBase Application System，数据库应用系统）的生命周期由项目规划、需求分析、系统设计、实现与部署、运行与维护五个基本活动组成。

<img src="../../pictures/数据库系统概念-DBAS生命周期.drawio.svg" width="700"/> 

<img src="../../pictures/数据库系统概念-规划与分析的主要工作.drawio.svg" width="500"/> 

# 需求分析

- 需求分析阶段主要的任务是编写需求说明书、构建功能模型（DFD、IDEF0等）、收集各类应用域与问题域的报表等。

- DFD图和IDEF0图的比较：
1. DFD图强调数据流或顺序；而IDEF0图强调数据约束。
2. IDEF模型结构清楚，组成元素简单，更适合大型复杂系统的建模。

## [DFD 数据流图](../MIS/DFD.md)

## [IDEF0](../MIS/IDEF.md)

## [UML的用例模型](../UML/用例视图.md)

# 数据库结构设计

## 概念设计

- 概念设计面向现实世界，通常采用自底向上的方法，通过对需求分析阶段的文档（需求说明书、功能模型DFD/IDEF0等）的分析和理解，抽象出数据的结构、语义、数据之间的相互联系以及数据满足的约束条件，从而构建信息模型，编写数据库概念设计说明书。

### 实体/联系矩阵

- 实体/联系矩阵是标识实体集之间关系的简单方法，如果两个实体集之间存在联系（指的是直接联系），则在矩阵中它们的交叉位置上画叉；若不存在联系，则空白标注。

<img src="../../pictures/数据库系统概念-实体-联系矩阵.drawio.svg" width="300"/> 

### 数据建模方法

#### [E-R 关系数据模型](./数据库设计与应用程序开发.md#E-R模型)

#### [IDEF1X 数据建模方法](../MIS/IDEF.md)

## 逻辑设计

<img src="../../pictures/数据库系统概念-逻辑设计阶段.drawio.svg" width="500"/> 

## 物理设计

### 物理设计概述

- 数据库物理设计的目的是将数据的逻辑描述转换为实现技术规范，其目标是设计数据存储方案，以便提供足够好的性能并确保数据库数据的完整性、安全性和可恢复性。通常，<b>数据库物理设计并不包括文件和数据库的具体实现细节</b>，而是需要了解不同文件组织方式、索引技术及其使用方法。
- 数据库中的应用数据是以文件形式存储在外设存储介质上的，文件在逻辑上组织成记录的序列，文件中的每个逻辑记录被映射到某个特定的磁盘块上。而文件的逻辑记录与磁盘块间的映射关系是由操作系统或DBMS来管理的。
1. 文件的组织
2. 文件的结构
3. 文件的存取
4. 索引技术（Indexing）

### 索引 index

- 索引（index）是记录域（查找码）取值到记录的物理地址间的映射关系。查找码是用于查询的条件所对应的，可以不是主键。索引建立在查找码上。
- 索引加快了数据查询速度，却减慢了数据更新速度（数据更新时需要维护索引），索引本身还会占用一定的存储空间。

#### 索引文件机制

- 索引文件机制（有序索引技术，Ordered Index）利用<b>索引文件（Index File）</b>实现记录域（查找码、排序域）到记录物理地址间的映射关系。（通常情况下，数据库会采用顺序文件结构）
- 索引文件由索引记录（Index Record）组成，每个记录中记载着一个索引项（Index Entry），索引项记录了某个特定的查找码值和具有该值的数据文件记录的物理地址。
- 一个数据库文件上可以建立多个索引文件，数据文件和每个索引文件都根据各自的查找码有序地组织为顺序文件。

##### 聚集索引和非聚集索引

- 对数据文件和它的一个特定的索引文件，如果数据文件中数据记录的排序顺序与索引文件中索引项的排序顺序一致，就称该索引文件为<b>聚集索引（Clustering Index）</b>；否则为<b>非聚集索引（Non-clustering Index）</b>。
- 索引顺序文件（Index-Sequential File）是按照某个查找码组织为顺序文件，且建有聚集索引的数据文件。
- 一个基本表上除了可以建立一个聚集索引外，还可以建立多个非聚集索引。

##### 稠密索引和稀疏索引

- 如果数据文件中的每个查找码值在索引文件中都对应一个索引记录，则该索引被称为<b>稠密索引（Dense Index）</b>；如果只有一部分对应，则称为<b>稀疏索引（Sparse Index）</b>。

##### 主索引和辅索引

- 在数据文件的主码属性集上建立的索引被称为<b>主索引（Primary Key）</b>，而在其他属性集上建立的索引被称为<b>辅索引（Secondary Key）</b>。
- 在RDBMS中，通常按照主码值的顺序将元组有序存储在数据文件中，并以主码作为查找码建立索引文件（即是主索引，也是聚集索引）。

##### 唯一索引

- 唯一索引可以确保索引列不包含重复的值。在多列唯一索引的情况下，可以确保索引列中的每个值的组合都是唯一的。

##### 单层索引和多层索引

- 单层索引（线性索引）根据键值在索引文件中顺序排列，组织成一堆线性结构，每个索引项直接指向数据文件的数据记录。（之前的索引都是单层索引）
- 多层索引是对索引文件中的索引项本身再建立一级稀疏索引。

#### 哈希索引机制

- 哈希(Hash)索引机制（散列技术）利用<b>散列函数（Hash Function）</b>实现记录域（查找码、散列域、排序域）到记录物理地址间的直接映射关系。
- 当需要访问数据文件中查找码值为s<sub>i</sub>的某个或某些目标记录时，将s<sub>i</sub>作为散列函数h的输入，计算得出的散列函数输出值h(s<sub>i</sub>)就是目标记录在数据文件中的物理地址。

### 物理设计内容

- 数据库物理设计主要包括以下环节，每个环节包含若干设计内容：数据库逻辑模式描述、文件组织与存取设计、数据分布设计、确定系统配置、物理模式评估。最终形成<b>数据库物理设计文档</b>。

#### 数据库逻辑模式描述

- 数据库物理设计需要根据数据库逻辑结构信息设计目标DBMS平台可支持的关系表（基本表）的模式信息，代表了所要开发的具体目标数据库的结构。
1. 面向目标数据库描述基本表和视图。不同的RDBMS提供的建立数据库及其数据库对象的语言各不相同（SQL Plus、PL/SQL）。
2. 设计基本表业务规则（完整性约束）。

#### DB文件组织与存取设计

- 根据事务数据访问特性分析结果，可以对基本表设计成更加有效的文件组织和索引方式。

##### 事务-基本表交叉引用矩阵

- 事务-基本表交叉引用矩阵，分析系统内（部分重要的）数据库事务对各个基本表的访问情况，确定事务访问了哪些基本表，对这些基本表执行何种操作，并进一步分析各操作涉及的基本表属性。

<img src="../../pictures/2024-03-20_20-38.png" width="600"/> 

##### 事务的执行频率

1. 估计各事务的执行频率，并分析事务上的每个数据访问操作对各个基本表中的相关属性的操作频率。
2. 对每张基本表，汇总所有作用于该表上的各事务的操作频率信息，得到相关的数据访问估计信息。

##### 选择文件结构的原则

- 为基本表选择合适的文件结构的原则：
1. 如果数据库中的一个基本表中的数据量很少，并且插入、删除、更新等操作非常频繁，则该基本表可以采用<b>堆文件组织方式</b>。

2. <b>顺序文件</b>支持基于查找码的顺序访问，也支持快速的二分查找。

3. 如果用户查询是基于散列域值的等值匹配，特别是如果访问顺序是随机的，则<b>散列文件</b>比较合适。
   
   - 散列文件组织不适合的情况：
   1. 基于散列域值的非精确查询。
   2. 基于非散列域进行的查询。

4. <b>B-树和B<sup>+</sup>树</b>属于动态索引，是实际数据库系统中使用非常广泛的索引文件结构。适合于定义在大数据量基本表、基于查找码的等值查询、范围查询、模糊查询和部分查询。

5. 某些频繁执行且需要进行多表连接操作的查询，可以将这些基本表组织为<b>聚集文件</b>。

##### 设计存取路径以及建立索引的原则

- 设计存取路径的内容包括为数据库文件设计合理的物理存储位置和为基本表设计索引。
- 为基本表建立索引的原则：对于经常需要进行查询、连接、统计操作，且数据量大的基本表可考虑建立索引；而经常执行插入、删除、更新操作或小数据量的基本表应尽量避免建立索引。
- 对于基本表，可考虑在下面一些属性上建立索引：
1. 表的主码，大部分RDBMS会自动为主码建立唯一索引。
2. 在WHERE子句中引用率较高的属性。
3. 参与连接操作的属性。
4. 在ORDER BY子句、GROUP BY子句中出现的属性。
5. 在某一范围内频繁搜索的属性，但只有当使用索引的查询的结果不超过记录总数的20%时，索引才会有明显的效果。
6. 如果在WHERE子句中同时包含一个表中的多个属性，则可以考虑在这些属性上建立多属性索引。如果数据库文件需要频繁执行精确匹配查询，则可考虑建立散列索引；而B<sup>+</sup>树等有序索引更适合于范围查询。
7. 当一个属性有相对较多的不同值时，使用索引有明显的作用；当一个属性的不同值很少时，使用索引没有好处。
8. 对包含大量空值的属性建立索引时需要谨慎考虑，因为大多数的DBMS中的索引不引用具有空值的行，对空值的查找需要使用全表扫描来实现。

#### 数据分布设计

##### 不同类型数据的物理分布

- 不同类型数据的物理分布：各种数据在系统中的作用不同，使用的频率也不同，应根据实际使用情况存放在合适的物理介质，以优化系统I/O性能。
1. 数据库备份数据、日志文件备份数据用于故障恢复，使用频率低，而且数据量大，可以存储在磁带中。

2. 应用数据、索引和日志则使用频繁，要求的响应时间短，必须放在支持直接存取（Direct Access）的磁盘存储介质上。
- 当使用RAID等多磁盘存储系统时，可以将基本表和建立在表上的索引（以及其他可以独立的数据）分别放在不同的磁盘上。这样，存放数据和存放索引的磁盘驱动器并行工作，可以得到较快的文件读写速度。

##### 应用数据的划分与分布

- 可以将一些较大的基本表划分为若干分区，各分区数据分别存储在不同位置的磁盘上，并可采用不同的物理组织方式。
1. 根据数据的使用特征划分。频繁使用分区和非频繁使用分区。
2. 根据时间、地点属性划分。
3. 分布式数据库系统（Distributed DataBase System，DDBS）中的数据划分，原则是数据应靠近起使用者。
   1. 水平划分：将一张基本表划分为多张具有系统属性、结构完全相同的子表，子表包含的元组是基本表中元组的子集（可以有公共元组）。
   2. 垂直划分：将一张基本表划分为多张子表，每张子表包含的属性是原基本表的子集。

##### 派生属性数据分布

##### 关系模式的去规范化

#### 确定系统配置

#### 物理模式评估

# DBAS功能设计与实施

## 软件架构与设计过程

### 软件架构

- 软件体系结构（软件架构）= <code>{构件, 连接件, 约束}</code>，是一种可预制和可重构的软件框架结构。

<table>
    <tr>
        <td width="30%">构件 Component</td>
        <td width="70%">组成系统的具有一定独立功能的不同粒度的程序模块</td>
    </tr>
    <tr>
        <td>连接件 Connector</td>
        <td>将不同的构件连接起来，表示了构件之间的相互作用（通信、调用等）</td>
    </tr>
    <tr>
        <td>约束 Constraint</td>
        <td>一般为对象连接时的规则，或指明了构件连接的条件</td>
    </tr>
</table>

###  软件设计过程

<table>
    <tr>
        <td width="30%">总体结构设计<br/>Architectural Design</td>
        <td width="70%">旨在确定组成软件系统的各主要部件及其相互间关系</td>
    </tr>
    <tr>
        <td>过程设计<br/>Procedural Design</td>
        <td>完成对每一部件的过程化描述</td>
    </tr>
    <tr>
        <td>数据定义<br/>Data Design</td>
        <td>定义了为实现软件所需要的数据结构</td>
    </tr>
</table>
- 从工程管理的角度，软件设计可分为概要设计和详细设计两大步骤。

## DBAS总体设计

- DBAS设计包括结构设计、过程设计、数据设计三个方面，依据自上而下、循序渐进、逐步求精的原则。

### DBAS体系结构设计

- 确定DBAS体系结构是指将系统从功能、层次/结构、地理分布等角度进行分解，划分为多个子系统，定义各子系统应实现的功能；设计系统的全局控制，明确各子系统间的交互和接口关系。

### DBAS软件总体设计

- DBAS软件包括操作系统、数据库管理系统、开发环境、中间件、应用软件（数据库事务和应用程序）。
- 应用软件总体设计从需求分析阶段得到的数据流图、事务规范、业务规则需求分析出发，得到的系统总体结构和分层模块结构可以用<b>模块结构图</b>来表示。
- 在应用软件总体之后的设计工作，数据库事务和应用程序的概要设计和详细设计，均属于数据库应用系统功能设计范畴。

#### [模块结构图](../MIS/模块结构图.md)

### 软硬件选型与配置设计

### 业务规则初步设计

- 数据库应用软件的动态行为体现为各个系统元素相互间的组合、控制和信息传递，可表示为一系列实现系统功能的业务流程和运行控制。这种动态行为实现了应用领域特定的业务规则。

#### [业务流程图 TFD](../MIS/TFD.md)

-  通常DBAS的各项作业活动具有逻辑上的先后关系，因此可表示成一个操作序列，并用业务流程图的形式展示。

## 功能概要设计

### DBAS软件4层架构

<table>
    <caption>DBAS软件4层架构</caption>
    <tr>
        <td rowspan="4" width="40%"><img src="../../pictures/数据库系统概念-DBAS软件4层架构.drawio.svg" width="100%"/></td>
        <td width="15%">表示层</td>
        <td width="45%"></td>
    </tr>
    <tr>
        <td>业务逻辑层</td>
        <td>高内聚、松耦合</td>
    </tr>
    <tr>
        <td>数据访问层</td>
        <td><b>事务概要设计</b>，采用面向数据流的程序设计方法（结构设计方法，SD方法），内容包括事务名称、事务所访问的关系表及关系属性、事务处理逻辑、事务用户（使用、启动、调用该事务的软件模块或系统）</td>
    </tr>
    <tr>
        <td>数据持久层</td>
        <td></td>
    </tr>
</table>

### 事务概要设计

<img src="../../pictures/2024-03-21_09-46.png" width="600"/> 

- 根据事务概要设计的结果，检查关系表对数据库事务的支持性。

1. 对每一个事务，根据需求分析阶段的事务分析，列出该事务所访问的各个数据项。
2. 列出事务访问的数据项所在的关系表和对应的关系属性。
3. 如果事务访问的数据项同时出现在多个表中，检查这些关系表间的关联关系，如主码/外码关联。
4. 检查是否存在某些事务，这些事务所访问的一些数据项未出现在任何关系表中。对这些事务，需要重新修改数据库的概念模型或逻辑结构，或者重新设计事务，以保证DB能够支持所有的数据库事务。

## 功能详细设计